var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,c,b){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(c.call(b,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in b||(b[e]={});b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};
$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,c){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:c})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(b){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(b||"")+"_"+c++,b)}var c=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,d={next:function(){if(b<a.length){var e=b++;return{value:c(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
var startloop=!1,simRec=[],json={},hashes,names,newindex=[],steps=[],timestep=0,pausesim=!0,stepIncrement=1,endsim,code={},teams={},ajaxcall=null,istep;
$(document).ready(function(){function a(a){var b=0;!0===a&&(b=1);3==Object.keys(code).length&&$(".dz-preview.error").length==b?$("#add-team").removeAttr("disabled"):$("#add-team").attr("disabled")||$("#add-team").attr("disabled",!0)}$("#canvas-container").hide();$("#footer-wrapper").addClass("white");var c=new Dropzone("#code-box",{url:"back_upload.php",paramName:"file",maxFilesize:1,maxFiles:3,clickable:"#dz-add",createImageThumbnails:!1,addRemoveLinks:!0,acceptedFiles:".c,.cpp",dictFileTooBig:"O arquivo \u00e9 muito grande ({{filesize}}MB). Tamanho m\u00e1ximo {{maxFilesize}}MB.",
dictInvalidFileType:"Voc\u00ea s\u00f3 pode enviar c\u00f3digos escritos na linguagem C (extens\u00f5es .c e .cpp).",dictCancelUpload:"Cancelar envio",dictUploadCanceled:"Envio cancelado",dictRemoveFile:"Remover arquivo",dictMaxFilesExceeded:"A equipe \u00e9 composta de {{maxFiles}} gladiadores",previewTemplate:"<div class='dz-preview glad-preview'></div>",accept:function(a,b){b()},init:function(){this.on("addedfile",function(a){$("#code-box").append($(a.previewElement))})},success:function(b,d){var e=
b.upload.uuid;code[e]=filter_response(b,d);for(var f in code)f!=e&&code[f].name==code[e].name&&(code[e].error={message:"Cada gladiador em uma mesma equipe precisa possuir nomes diferentes"});code[e].error?(create_errorPreview($(b.previewElement),b,code[e].error),$(b.previewElement).click(function(){$(b.previewElement).fadeOut(function(){c.removeFile(b);a()})}),a()):$(b.previewElement).load("../dz-tournment-template.html",function(){$(".dz-preview").index($(this));$(this).find(".name span").html(code[e].file.name);
$(this).find(".size span").html(code[e].file.size);$(this).find(".glad span").html(code[e].name);$(this).find(".str span").html(code[e].STR);$(this).find(".agi span").html(code[e].AGI);$(this).find(".int span").html(code[e].INT);appendCanvas($(this).find(".image"),code[e].code);a();$(this).find(".delete").click(function(){$(this).parents(".dz-preview").fadeOut(function(){c.removeFile(b)})})})},error:function(b,d){var e=[];e.message=d;e.link=null;3<$(".dz-preview").length?c.removeFile(b):(create_errorPreview($(b.previewElement),
b,e),$(b.previewElement).click(function(){$(b.previewElement).fadeOut(function(){c.removeFile(b);a()})}));a()},removedfile:function(b){delete code[b.upload.uuid];$(b.previewElement).remove();$(b.previewElement).hasClass("error")?a(!0):a();3<=$(".dz-preview").length?$("#dz-add").hide():$("#dz-add").show()},complete:function(a){3<=$(".dz-preview").length?$("#dz-add").hide():$("#dz-add").show()}});$("#add-team").click(function(a){ajaxcall&&ajaxcall.abort();$("body").append("<div id='fog'><div id='team-name-window'><p>Informe o nome da equipe</p><input type='text' class='input' placeholder='Nome da equipe'><div class='button-container'><button id='btn-ok' class='button'>OK</button><button id='btn-cancel' class='button'>CANCELAR</button></div></div></div>");
$("#team-name-window").hide().fadeIn();$("#team-name-window input").focus();$("#team-name-window input").keypress(function(a){13==a.which&&$("#team-name-window #btn-ok").click()});$("#team-name-window #btn-cancel").click(function(){$("#fog").remove()});var b=!1;$("#team-name-window #btn-ok").click(function(){if(4<=$("#team-name-window input").val().length){b=!0;var a=$("#team-name-window input").val();$("#fog").remove()}else $("#team-name-window").addClass("error"),$("#team-name-window p").html("Nome muito curto."),
$("#team-name-window input").focus();if(b){var c=new progressButton($("#add-team"),["Testando gladiadores...","Aguardando resposta do servidor"]),d=[],e=0,f;for(f in code)getGladFromCode(code[f].code).then(function(a){d.push(a);e++});var h=setInterval(function(){e==Object.keys(code).length&&(clearInterval(h),runSimulation(d).then(function(b){"ERROR"!=b&&insertTeam(a);c.kill()}))},10)}})});var b=4,d=[-10,-5,-2,-1,1,2,5,10];$("#back-step").click(function(){pausesim?(0<stepIncrement?stepIncrement=-1:
0<timestep&&(stepIncrement*=1.15),timestep+=Math.round(stepIncrement),$("#fowd-step .speed").html(""),$("#back-step .speed").html(Math.round(stepIncrement))):(0<b&&b--,stepIncrement=d[b],3>=b?($("#fowd-step .speed").html(""),$("#back-step .speed").html(d[b]+"x")):($("#back-step .speed").html(""),$("#fowd-step .speed").html(d[b]+"x")))});$("#fowd-step").click(function(){pausesim?(0>stepIncrement?stepIncrement=1:timestep<$("#time").slider("option","max")-1&&(stepIncrement*=1.15),timestep+=Math.round(stepIncrement),
$("#back-step .speed").html(""),$("#fowd-step .speed").html("+"+Math.round(stepIncrement))):(b<d.length-1&&b++,stepIncrement=d[b],3>=b?($("#fowd-step .speed").html(""),$("#back-step .speed").html(d[b]+"x")):($("#back-step .speed").html(""),$("#fowd-step .speed").html(d[b]+"x")))});$("#pause").click(function(){stepIncrement=1;b=4;pausesim?(pausesim=!1,$("#pause #img-play").hide(),$("#pause #img-pause").show(),$("#back-step .speed").html("-1x"),$("#fowd-step .speed").html("1x")):(pausesim=!0,$("#pause #img-pause").hide(),
$("#pause #img-play").show(),stepIncrement=1,b=4,$("#back-step .speed").html("-1"),$("#fowd-step .speed").html("+1"))});$("#fullscreen").click(function(){setFullScreen(!isFullScreen())});$("#time").slider({range:"min",min:0,max:0,value:timestep,create:function(a,b){$(this).append("<div class='ui-slider-time'></div>")},change:function(a,b){a=Math.floor(b.value/600);b=Math.floor(b.value/10)%60;10>b&&(b="0"+b);b=a+":"+b;$(this).find(".ui-slider-time").html(b);$(this).find(".ui-slider-time").css("left",
$(this).find(".ui-slider-handle").css("left"))},slide:function(a,b){timestep=b.value}})});function isFullScreen(){return document.fullscreenElement&&null!==document.fullscreenElement||document.webkitFullscreenElement&&null!==document.webkitFullscreenElement||document.mozFullScreenElement&&null!==document.mozFullScreenElement||document.msFullscreenElement&&null!==document.msFullscreenElement?!0:!1}
function setFullScreen(a){a?(a=document.getElementById("canvas-container"),a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()):document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}
function insertTeam(a){$("#team-name-window input").val("");$("#added-teams").hasClass("empty")&&$("#added-teams").removeClass("empty");$("#added-teams").show("slow").append("<div class='team-name added'><div class='delete' title='Remove a equipe cadastrada'>X</div><span>"+a+"</span></div>");$("#fog").remove();teams[a]=[];teams[a]=code;code=[];$(".dz-preview").slideUp("fast",function(){$("#code-box .delete").click()});$("#added-teams .team-name.added").last().hide().fadeIn();$("#added-teams .team-name.added").last().find(".delete").click(function(){var a=
$(this).parents(".team-name.added");a.fadeOut(function(){a.remove();0==$("#added-teams .team-name.added").length&&$("#added-teams").addClass("empty")});teams[a.find("span").html()]&&delete teams[a.find("span").html()];1>=Object.keys(teams).length&&$("#t-start").prop("disabled",!0)});1<Object.keys(teams).length&&$("#t-start").removeProp("disabled")}
function createTerminal(a,c){$("body").append("<div id='fog'><div id='code-window'><div id='title'><span>"+a+"</span><div id='close'></div></div><pre></pre></div></div>");$("#code-window #close").click(function(){$("#fog").remove()});$("#code-window pre").html(c)}var show_final_score=!0;
function start_timer(a){istep=setInterval(function(){if(startloop){0>timestep&&(timestep=0);if(timestep>a.length-1){timestep=a.length-1;for(i in a[timestep].glads)if(0<a[timestep].glads[i].hp&&!$(".ui-glad").eq(i).hasClass("dead")&&(!e||b<a[timestep].glads[i].hp)){var c=a[timestep].glads[i].name;var b=a[timestep].glads[i].hp;var d=a[timestep].glads[i].user;var e=i}if(!$("#end-message").length&&show_final_score){e||(c="Empate",d="");$("#canvas-container").append("<div id='fog'><div id='end-message'><div id='victory'>VIT\u00d3RIA</div><div id='image-container'><div id='image'></div><div id='name-team-container'><span id='name'>"+
c+"</span><span id='team'>"+d+"</span></div></div><div id='button-container'><button id='link' class='button' title='Cria um link para assistir a batalha mais tarde'>LINK</button><button id='continuar' class='button' title='Continuar o torneio'>TORNEIO</button><button class='button' id='retornar' title='Retornar para a batalha'>OK</button></div></div></div>");$("#end-message #continuar").click(function(){setFullScreen(!1);show_final_score=!1;$("#fog").remove();$("#canvas-container").hide();$("#code-selection").show();
clearInterval(istep);if(tier_select>=tiers.length){tier_select=0;var a=remakeTiers();1<a?tournmentStatus():tournmentEnd(a)}else chooseGlads()});$("#end-message #retornar").click(function(){show_final_score=!1;$("#fog").remove()});var f=null,g=new Image;g.src="res/ellipsis.svg";$("#end-message #link").click(function(){if(!f){var a=[],b;for(b in hashes)a[b]=hashes[newindex[b]];$.post("back_log.php",{log:JSON.stringify(exportjson),spritesheets:JSON.stringify(a)}).done(function(a){f=a;$("#url #hash").html(a)})}$("#end-message").hide();
$("#fog").append("<div id='url'><span id='site'>https://gladcode.tk/playback.php?log=</span><span id='hash'></span></div>");f?$("#url #hash").html(f):$("#url #hash").html($(g));$("#url").click(function(){f&&(copyToClipboard("https://gladcode.tk/playback.php?log="+$("#url #hash").html()),$("#url").html("Link copiado"),$("#url").addClass("clicked"),setTimeout(function(){$("#url").remove();$("#end-message").fadeIn(500)},1E3))})});e&&getAvatar(e,$("#end-message #image"));$("#end-message").hide();$("#end-message").fadeIn(1E3);
music.pause();victory.play()}}else show_final_score||($("#fog").remove(),show_final_score=!0,music&&music.resume());phaser_update(a[timestep]);pausesim||(timestep+=stepIncrement)}},100)}function copyToClipboard(a){$("body").append("<input type='text' id='icopy' value='"+a+"'>");$("#icopy").select();document.execCommand("copy");$("#icopy").remove()}
function getAvatar(a,c){var b=document.createElement("canvas");b.setAttribute("width",64);b.setAttribute("height",64);var d=b.getContext("2d");d.clearRect(0,0,b.width,b.height);img=new Image;""==hashes[newindex[a]]?(img.src="../res/glad.png",d.drawImage(img,0,640,64,64,0,0,64,64)):(img.src="../spritesheet/"+hashes[newindex[a]]+".png",d.drawImage(img,64,1984,64,64,0,0,64,64));c.append(b)}function getFoldername(){var a,c="";for(a=0;10>a;a++)c+=(9*Math.random()).toFixed(0).toString();return c}
function create_ui(a){$("#ui-container").html("");for(i=0;i<a;i++)$("#ui-container").append("<div class='ui-glad'></div>"),$(".ui-glad").last().load("../ui_template.html",function(){})}var spritesheets={};function appendCanvas(a,c,b){function d(a,c){var d="walk",e="down";"dead"==b&&(d="die",e="up");a.append(getSpriteThumb(c,d,e))}spritesheets[c]?d(a,spritesheets[c]):getGladFromCode(c).then(function(b){fetchSpritesheet(JSON.parse(b.skin)).then(function(b){spritesheets[c]=b;d(a,b)})})}
function getGladFromCode(a,c){var b=$.Deferred();$.post("back_glad.php",{action:"FILE",code:a}).done(function(a){a=JSON.parse(a);a.skin&&(a.skin=JSON.stringify(a.skin));c&&(a.user=c);return b.resolve(a)});return b.promise()}
function filter_response(a,c){c=c.replace(/(\/\/[\w\W]*?\n)/g,"//comment\n");c=c.replace(/(\/\*[\w\W]*?\*\/)/g,"//comment\n");var b=[];b.code=c;b.file=a;a=[];if(/setName\([\w\W]*?\);|mudaNome\([\w\W]*?\);/g.exec(c))if(/setName\("([\w \u00c0-\u00fa]{3,20}?)"\);|mudaNome\("([\w \u00c0-\u00fa]{3,20}?)"\);/g.exec(c))if(/setSTR\([\w\W]*?\);|mudaFOR\([\w\W]*?\);/g.exec(c))if(/setSTR\((\d{1,2})\);|mudaFOR\((\d{1,2})\);/g.exec(c))if(/setAGI\([\w\W]*?\);|mudaAGI\([\w\W]*?\);/g.exec(c))if(/setAGI\((\d{1,2})\);|mudaAGI\((\d{1,2})\);/g.exec(c)){if(/setINT\([\w\W]*?\);|mudaINT\([\w\W]*?\);/g.exec(c)){if(/setINT\((\d{1,2})\);|mudaINT\((\d{1,2})\);/g.exec(c))return b.name=/setName\("([\w \u00c0-\u00fa]+?)"\);|mudaNome\("([\w \u00c0-\u00fa]+?)"\);/g.exec(c),
b.STR=/setSTR\((\d{1,2})\);|mudaFOR\((\d{1,2})\);/g.exec(c),b.AGI=/setAGI\((\d{1,2})\);|mudaAGI\((\d{1,2})\);/g.exec(c),b.INT=/setINT\((\d{1,2})\);|mudaINT\((\d{1,2})\);/g.exec(c),b.name[1]?b.name=b.name[1]:b.name[2]&&(b.name=b.name[2]),b.STR[1]?b.STR=b.STR[1]:b.STR[2]&&(b.STR=b.STR[2]),b.AGI[1]?b.AGI=b.AGI[1]:b.AGI[2]&&(b.AGI=b.AGI[2]),b.INT[1]?b.INT=b.INT[1]:b.INT[2]&&(b.INT=b.INT[2]),/setSpritesheet\("(\w{32})"\);|mudaAparencia\("(\w{32})"\);/g.exec(c)?(b.sprite=/setSpritesheet\("(\w{32})"\);|mudaAparencia\("(\w{32})"\);/g.exec(c),
b.sprite[1]?b.sprite=b.sprite[1]:b.sprite[2]&&(b.sprite=b.sprite[2])):b.sprite="",console.log(b),25!=calcPointCost(b.STR)+calcPointCost(b.AGI)+calcPointCost(b.INT)&&(a.message="O somat\u00f3rio do custo dos pontos de atributos do gladiador \u00e9 diferente de 25.",a.link="https://gladcode.tk/manual.php#nav-atrib",b.error=a),b;a.message="A intelig\u00eancia do gladiador precisa ser um n\u00famero inteiro entre 0 e 10."}else a.message="Fun\u00e7\u00e3o setINT (intelig\u00eancia do gladiador) n\u00e3o encontrada ou com erro.";
a.link="https://gladcode.tk/function.php?f=setint"}else a.message="A agilidade do gladiador precisa ser um n\u00famero inteiro entre 0 e 10.",a.link="https://gladcode.tk/function.php?f=setagi";else a.message="Fun\u00e7\u00e3o setAGI (agilidade do gladiador) n\u00e3o encontrada ou com erro.",a.link="https://gladcode.tk/function.php?f=setagi";else a.message="A for\u00e7a do gladiador precisa ser um n\u00famero inteiro entre 0 e 10.",a.link="https://gladcode.tk/function.php?f=setstr";else a.message=
"Fun\u00e7\u00e3o setSTR (for\u00e7a do gladiador) n\u00e3o encontrada ou com erro.",a.link="https://gladcode.tk/function.php?f=setstr";else a.message="O nome do gladiador precisa ser composto de caracteres alfanum\u00e9ricos e possuir tamanho entre 3 e 20.",a.link="https://gladcode.tk/function.php?f=setname";else a.message="Fun\u00e7\u00e3o setName (nome do gladiador) n\u00e3o encontrada ou com erro.",a.link="https://gladcode.tk/function.php?f=setname";b.error=a;return b}
function create_errorPreview(a,c,b){a.addClass("error");a.html("<div class='row file'><div class='name'>Arquivo:<span></span></div><div class='size'>Tamanho:<span></span>B</div></div><div class='row message'>Erro:<span></span></div><div class='row link'>Para saber mais acesse:<span></span></div>");a.find(".message span").html(b.message);b.link?a.find(".link span").html("<a target='_blank' href='"+b.link+"'>"+b.link+"</a>"):a.find(".link").remove();a.find(".name span").html(c.name);a.find(".size span").html(c.size);
a.click(function(){})}function calcPointCost(a){a=parseInt(a);return 0==a?0:Math.ceil(a/3)+calcPointCost(a-1)};
