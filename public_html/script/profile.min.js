var user;
$(document).ready(function(){function e(){$.post("back_notification.php",{}).done(function(a){try{a=JSON.parse(a)}catch(k){console.log(k);var d=k}if(!d){$("#profile-ui #lvl span").html(a.user.lvl);d=130*(4.5*parseInt(a.user.lvl)-2);var c=parseInt(a.user.xp);$("#profile-ui #xp #filled").width(c/d*100+"%");$("#messages .notification").html(a.messages);0==parseInt(a.messages)?$("#messages .notification").addClass("empty"):$("#messages .notification").removeClass("empty");d=parseInt(a.friends);$("#friends .notification").html(d);
0==d?$("#friends .notification").addClass("empty"):$("#friends .notification").removeClass("empty");d=parseInt(a.glads.remaining);c=parseInt(a.glads.obsolete);$("#glads .notification").html(d+c);0==d+c?$("#glads .notification").addClass("empty"):$("#glads .notification").removeClass("empty");a=parseInt(a.reports)+parseInt(a.duels);10<=a?$("#battle .notification").html("..."):$("#battle .notification").html(a);0==a?$("#battle .notification").addClass("empty"):$("#battle .notification").removeClass("empty")}setTimeout(function(){e()},
1E4)})}function f(){function a(){$("#battle-container #page-title span").eq(0).html(d);$("#battle-container #page-title span").eq(1).html(c);$("#battle-container #page-title span").eq(2).html(k);1==d?$("#battle-container #prev").prop("disabled",!0):$("#battle-container #prev").removeProp("disabled");c==k?$("#battle-container #next").prop("disabled",!0):$("#battle-container #next").removeProp("disabled")}var d,c,k;"Batalhas"==$("#bhist-container .tab.selected").html()?$.post("back_report.php",{action:"GET",
read:!0,page:l.battles}).done(function(b){try{b=JSON.parse(b)}catch(u){var m=u}if(m||0==b.length)$("#bhist-container").hide();else{d=b.start;c=b.end;k=b.total;b=b.reports;a();$("#bhist-container .table").html("<div class='row head'><div class='cell'>Gladiador</div><div class='cell reward'>Renome</div><div class='cell time'>Data</div></div>");for(var h in b)$("#bhist-container .table").append("<div class='row'><div class='cell glad'>"+b[h].gladiator+"</div><div class='cell reward'>"+parseFloat(b[h].reward).toFixed(1)+
"</div><div class='cell time' title='"+getMessageTime(b[h].time,!0)+"'>"+getMessageTime(b[h].time)+"</div><div class='playback' title='Visualizar batalha'><a target='_blank' href='playback.php?log="+b[h].hash+"'><img src='icon/eye.png'></a></div></div>"),"0"==b[h].isread?$("#bhist-container .table .row").last().addClass("unread"):$("#bhist-container .table .row").last().removeClass("unread"),0>b[h].reward?$("#bhist-container .table .reward").last().addClass("red"):0<b[h].reward&&(m=$("#bhist-container .table .reward").last(),
m.addClass("green"),m.html("+"+m.html()))}}):"Duelos"==$("#bhist-container .tab.selected").html()&&$.post("back_duel.php",{action:"REPORT",page:l.duels}).done(function(b){try{b=JSON.parse(b)}catch(u){console.log(u);var m=u}if(m||0==b.length)$("#bhist-container").hide();else{d=b.start;c=b.end;k=b.total;a();b=b.output;$("#bhist-container .table").html("<div class='row head'><div class='cell'>Gladiador</div><div class='cell'>Oponente</div><div class='cell'>Mestre</div><div class='cell time'>Data</div></div>");
for(var h in b)$("#bhist-container .table").append("<div class='row'><div class='cell glad'>"+b[h].glad+"</div><div class='cell'>"+b[h].enemy+"</div><div class='cell'>"+b[h].user+"</div><div class='cell time' title='"+getMessageTime(b[h].time,!0)+"'>"+getMessageTime(b[h].time)+"</div><div class='playback' title='Visualizar batalha'><a target='_blank' href='playback.php?log="+b[h].log+"'><img src='icon/eye.png'></a></div></div>"),"0"==b[h].isread?$("#bhist-container .table .row").last().addClass("unread"):
$("#bhist-container .table .row").last().removeClass("unread")}})}function g(){$.post("back_rank.php",{page:n}).done(function(a){try{a=JSON.parse(a)}catch(u){console.log(u)}$("#ranking-container .table").html("<div class='row head'><div class='cell position'></div><div class='cell'>Gladiador</div><div class='cell'>Mestre</div><div class='cell mmr'>Renome</div></div>");var d=a.start,c=a.end,k=a.total;n=a.page;a=a.glads;for(var b in a){var m=parseInt(b)+d,h="";1==m?h="gold":2==m?h="silver":3==m&&(h=
"bronze");$("#ranking-container .table").append("<div class='row "+h+"'><div class='cell position'>"+m+"\u00ba</div><div class='cell'>"+a[b].glad+"</div><div class='cell'>"+a[b].user+"</div><div class='cell mmr'><span class='change24'>"+Math.abs(parseInt(a[b].change24))+"</span>"+parseInt(a[b].mmr)+"</div></div>");user.apelido==a[b].user&&$("#ranking-container .table .row").last().addClass("mine");0<parseInt(a[b].change24)?($("#ranking-container .table .mmr .change24").last().addClass("green"),$("#ranking-container .table .mmr .change24").last().prepend("<img src='icon/arrow-up-green.png'>")):
0>parseInt(a[b].change24)&&($("#ranking-container .table .mmr .change24").last().addClass("red"),$("#ranking-container .table .mmr .change24").last().prepend("<img src='icon/arrow-up-green.png'>"))}$("#ranking-container #page-title span").eq(0).html(d);$("#ranking-container #page-title span").eq(1).html(c);$("#ranking-container #page-title span").eq(2).html(k);1==d?$("#ranking-container #prev").prop("disabled",!0):$("#ranking-container #prev").removeProp("disabled");c==k?$("#ranking-container #next").prop("disabled",
!0):$("#ranking-container #next").removeProp("disabled")})}function p(){var a=$("#friend-panel #friends .button-open.open"),d=$("#friend-panel #friends .options");d.removeClass("open");a.removeClass("open");d.removeProp("style")}function r(a){var d=a.parents(".row").data("user");a=a.parents(".row").data("nick");showTextArea("Mensagem para <span class='highlight'>"+a+"</span>:","Ol\u00e1...",2048).then(function(a){a&&$.post("back_message.php",{action:"SEND",id:d,message:a}).done(function(c){showMessage("Mensagem enviada");
$.post("back_sendmail.php",{action:"MESSAGE",receiver:d,message:a}).done(function(a){console.log(a)})})})}$("#header-container").addClass("small-profile");fill_assets();var q=["friend","message","update","duel"];$.post("back_login.php",{action:"GET"}).done(function(a){user=JSON.parse(a);$("#tab").length?(a=$("#tab").html(),$("#"+a).click(),$("#tab").remove()):$("#menu #profile").click();$("#profile-ui #picture img").attr("src",user.foto);$("#profile-ui #nickname").html(user.apelido);e();$.post("back_glad.php",
{action:"GET"}).done(function(a){0==JSON.parse(a).length&&showDialog("Voc\u00ea ainda n\u00e3o possui nenhum gladiador cadastrado. Deseja ir para o editor de gladiadores?",["Sim","N\u00e3o, obrigado"]).then(function(a){"Sim"==a&&(window.location.href="editor.php")})})});$("#menu .item").click(function(){if(!$(this).hasClass("disabled")){var a=$(this);$("#panel .content").removeClass("open");$.each($("#panel").find(".content"),function(){$(this).data("menu")==a.attr("id")&&$(this).addClass("open")});
$("#menu .item").removeClass("here");$(this).addClass("here")}});$("#menu #profile").click(function(){$("#nickname .input").val(user.apelido);for(var a in q)"1"==user.preferences[q[a]]&&$("#email #pref-"+q[a]+" input.checkslider").prop("checked",!0)});$("#profile-panel .button").click(function(){$("#profile-panel .button").prop("disabled",!0);for(var a in q)$("#email #pref-"+q[a]+" input.checkslider").prop("checked")?user.preferences[q[a]]="1":user.preferences[q[a]]="0";$.post("back_login.php",{action:"UPDATE",
nickname:$("#nickname .input").val(),picture:user.foto,preferences:JSON.stringify(user.preferences)}).done(function(a){showMessage("Informa\u00e7\u00f5es atualizadas");$("#profile-panel .button").removeProp("disabled");user.apelido=$("#nickname .input").val();$("#profile-ui #nickname").html(user.apelido);$("#profile-ui #picture img").attr("src",user.foto)})});$("#menu #glads").click(function(){$.post("back_glad.php",{action:"GET"}).done(function(a){a=JSON.parse(a);var d=$("<div id='template'></div>").load("glad-card-template.html",
function(){$("#glads-container .glad-preview").remove();0<a.length&&$("#menu #battle").removeClass("disabled");for(var b in a)$("#glads-container .glad-card-container").append("<div class='glad-preview'></div>");$("#glads-container .glad-card-container .glad-preview").html(d);for(b in a)setGladImage($("#glads-container"),b,a[b].skin),$("#glads-container .glad-preview .info .glad span").eq(b).html(a[b].name),$("#glads-container .glad-preview .info .attr .str span").eq(b).html(a[b].vstr),$("#glads-container .glad-preview .info .attr .agi span").eq(b).html(a[b].vagi),
$("#glads-container .glad-preview .info .attr .int span").eq(b).html(a[b].vint),$("#glads-container .glad-preview").eq(b).data("id",a[b].id),$("#glads-container .glad-preview").eq(b).data("code",a[b].code),a[b].oldversion&&($("#glads-container .glad-preview").eq(b).addClass("old"),$("#glads-container .glad-preview .code .button").eq(b).html("{'atualizar'}")),$("#glads-container .glad-preview .delete").eq(b).click(function(){var a=$(this).parents(".glad-preview");showDialog("Deseja excluir o gladiador <span class='highlight'>"+
a.find(".glad span").html()+"</span>?",["Sim","N\u00e3o"]).then(function(b){"Sim"==b&&(a.fadeOut(function(){a.remove()}),$.post("back_glad.php",{action:"DELETE",id:a.data("id")}).done(function(a){$("#glads-container .glad-preview").last().after("<div class='glad-add'><div class='image'></div><div class='info'>Clique para criar um novo gladiador</div></div>");$("#glads-container .glad-add").first().click(function(){window.location.href="editor.php"})}))})}),$("#glads-container .glad-preview .code .button").eq(b).click(function(){var a=
$(this).parents(".glad-preview");if($(this).parents(".glad-preview").hasClass("old")){var b=$(this).parents(".info").find(".glad span").html();showDialog("A simula\u00e7\u00e3o da gladCode foi atualizada, e o c\u00f3digo do gladiador <span class='highlight'>"+b+"</span> precisa ser testado e salvo novamente para que ele volte a participar das batalhas. Clique no bot\u00e3o para abrir o editor",["Cancelar","OK"]).then(function(b){"OK"==b&&window.open("editor.php?g="+a.data("id"))})}else b=a.data("code"),
$("body").append("<div id='fog'><div id='code-box'><div class='close'>X</div><pre class='line-numbers language-c'><code class='language-c'>"+b+"</code></pre><div id='button-container'><button id='editor' class='button'>Abrir no editor</button></div></div></div>"),Prism.highlightElement($("code")[0]),$("#fog").click(function(){$(this).remove()}),$("#code-box").click(function(a){a.stopPropagation()}),$("#code-box .close").click(function(a){$("#fog").click()}),$("#editor").click(function(){window.open("editor.php?g="+
a.data("id"));$("#fog").click()})})});$("#glads-container .glad-add").remove();for(var c=a.length;6>c;c++)if($("#glads-container .glad-card-container").append("<div class='glad-add'><div class='image'></div><div class='info'></div></div>"),c<1+Math.floor(user.lvl/10))$("#glads-container .glad-add .info").last().html("Clique para criar um novo gladiador"),$("#glads-container .glad-add").last().click(function(){window.location.href="editor.php"});else{var k=10*(c-1+1);$("#glads-container .glad-add .info").last().html("Atinja o n\u00edvel "+
k+" de mestre para desbloquear este gladiador");$("#glads-container .glad-add").last().addClass("inactive")}})});$("#battle-container .tab").click(function(){$("#battle-container .tab").removeClass("selected");$(this).addClass("selected");f()});var l={battles:1,duels:1,favorites:1};$("#battle-container #prev").click(function(){l.battles--;f()});$("#battle-container #next").click(function(){l.battles++;f()});$("#menu #battle").click(function(){$("#match-find").prop("disabled",!0);$(this).hasClass("disabled")||
($.post("back_glad.php",{action:"GET"}).done(function(a){a=JSON.parse(a);var d=$("<div id='template'></div>").load("glad-card-template.html",function(){$("#battle-container .glad-preview").remove();for(var c in a)$("#battle-container .glad-card-container").append("<div class='glad-preview'></div>");$("#battle-container .glad-card-container .glad-preview").html(d);for(c in a)setGladImage($("#battle-container"),c,a[c].skin),$("#battle-container .glad-preview .info .glad span").eq(c).html(a[c].name),
$("#battle-container .glad-preview .info .attr .str span").eq(c).html(a[c].vstr),$("#battle-container .glad-preview .info .attr .agi span").eq(c).html(a[c].vagi),$("#battle-container .glad-preview .info .attr .int span").eq(c).html(a[c].vint),$("#battle-container .glad-preview").eq(c).data("id",a[c].id),$("#battle-container .glad-preview").eq(c).data("code",a[c].code),$("#battle-container .glad-preview").eq(c).data("name",a[c].name),$("#battle-container .glad-preview").eq(c).data("skin",a[c].skin),
$("#battle-container .glad-preview").eq(c).data("user",a[c].user),$("#battle-container .glad-preview").eq(c).data("vstr",a[c].vstr),$("#battle-container .glad-preview").eq(c).data("vagi",a[c].vagi),$("#battle-container .glad-preview").eq(c).data("vint",a[c].vint),$("#battle-container .glad-preview").eq(c).data("mmr",a[c].mmr),$("#battle-container .glad-preview .info .glad").eq(c).after("<div class='row mmr' title='Renome'><span>"+parseInt(a[c].mmr)+"</span><img src='icon/winner-icon.png'></div>"),
a[c].oldversion&&$("#battle-container .glad-preview").eq(c).addClass("old");$(".glad-preview .delete").remove();$(".glad-preview .code").remove();$("#battle-container .glad-preview").click(function(){$(this).hasClass("old")||($("#battle-container .glad-preview").removeClass("selected"),$(this).addClass("selected"),$("#match-find").removeProp("disabled"))})})}),f());$.post("back_duel.php",{action:"GET"}).done(function(a){a=JSON.parse(a);$("#duel-challenge").addClass("hidden");1<=a.length&&$("#duel-challenge").removeClass("hidden");
$("#duel-challenge .table").html("");for(var d in a){var c=a[d].nick,k=a[d].time,b=a[d].lvl,m=a[d].picture;$("#duel-challenge .table").append("<div class='row'><div class='cell lvl-container'><img src='res/star.png' title='N\u00edvel'><span>"+b+"</span></div><div class='cell image-container'><img src='"+m+"'></div><div class='cell user'>"+c+"</div><div class='cell time' title='"+getMessageTime(k,!0)+"'>"+getMessageTime(k,!1)+"</div><div class='button-container'><div class='accept' title='Aceitar desafio'></div><div class='refuse' title='Recusar desafio'></div></div></div>");
$("#duel-challenge .table .row").last().data("id",a[d].id)}$("#duel-challenge .table .refuse").click(function(){var a=$(this).parents(".row"),b=a.data("id");$.post("back_duel.php",{action:"DELETE",id:b}).done(function(b){"OK"==b&&(a.remove(),0==$("#duel-challenge .table .row").length&&$("#duel-challenge").addClass("hidden"))})});$("#duel-challenge .table .accept").click(function(){var a=$(this).parents(".row"),b=a.find(".user").html(),c=a.data("id");a="<div id='fog'><div id='duel-box'><div id='title'>Escolha o gladiador que duelar\u00e1 contra <span class='highlight'>"+
b+"</span> em nome da sua honra</div><div class='glad-card-container'></div><div id='button-container'><button id='cancel' class='button'>Cancelar</button><button id='duel' class='button' disabled>DUELAR</button></div></div></div>";$("body").append(a);var d=$("<div id='template'></div>").load("glad-card-template.html",function(){});$.post("back_glad.php",{action:"GET"}).done(function(a){a=JSON.parse(a);for(var b in a)$("#fog .glad-card-container").append("<div class='glad-preview'></div>");$("#fog .glad-card-container .glad-preview").html(d);
for(b in a)setGladImage($("#fog .glad-card-container"),b,a[b].skin),$("#fog .glad-preview .info .glad span").eq(b).html(a[b].name),$("#fog .glad-preview .info .attr .str span").eq(b).html(a[b].vstr),$("#fog .glad-preview .info .attr .agi span").eq(b).html(a[b].vagi),$("#fog .glad-preview .info .attr .int span").eq(b).html(a[b].vint),$("#fog .glad-preview").eq(b).data("id",a[b].id);$("#fog .glad-preview .code .button").remove();$("#fog .glad-preview .delete-container").remove();$("#fog .glad-preview").click(function(){$("#fog #btn-glad-open").removeProp("disabled");
$("#fog .glad-preview").removeClass("selected");$(this).addClass("selected");$("#duel-box #duel").removeProp("disabled")});$("#fog .glad-preview").dblclick(function(){$("#fog #duel-box #duel").click()})});$("#fog #duel-box #duel").click(function(){var a=$("#fog .glad-preview.selected").data("id"),b=new progressButton($(this),["Executando batalha...","Aguardando resposta do servidor"]);runSimulation({duel:c,glads:a}).then(function(a){b.kill();$("#fog").remove();showMessage("Duelo conclu\u00eddo. Clique para visualizar a batalha.").then(function(){window.open("playback.php?log="+
a)});$("#battle").click()})});$("#fog #duel-box #cancel").click(function(){$("#fog").remove()})})})});$.post("back_glad.php",{action:"GET"}).done(function(a){0==JSON.parse(a).length&&$("#menu #battle").addClass("disabled")});$("#battle-container #match-find").click(function(){var a=new progressButton($(this),["Executando batalha...","Aguardando resposta do servidor"]),d=$("#battle-container .glad-preview.selected"),c={id:d.data("id"),name:d.data("name"),skin:d.data("skin"),code:d.data("code"),user:d.data("user"),
vstr:d.data("vstr"),vagi:d.data("vagi"),vint:d.data("vint"),mmr:d.data("mmr")};$.post("back_match.php",{action:"MATCH",id:c.id}).done(function(d){d=JSON.parse(d);d.push(c);var b=preBattleShow(d);runSimulation({ranked:!0}).then(function(c){"ERROR"!=c&&(save_stats(c),$("#pre-battle-show #tips").html("Batalha conclu\u00edda. Clique para visualizar"),clearInterval(b),$("#pre-battle-show").addClass("complete"),$("#pre-battle-show").click(function(){window.open("playback.php?log="+c);$("#fog").remove();
$("#menu #battle").click()}));a.kill()})})});var n=1;$("#ranking-container #prev").click(function(){n--;g()});$("#ranking-container #next").click(function(){n++;g()});$("#menu #ranking").click(function(){g()});$("#menu #messages").click(function(){$("#message-panel #full-message").remove();$("#message-panel .table").show();$.post("back_message.php",{action:"GET"}).done(function(a){a=JSON.parse(a);$("#message-panel .table").html("");for(var d in a)$("#message-panel .table").append("<div class='row'><div class='cell user'>"+
a[d].nick+"</div><div class='cell message'>"+a[d].message+"</div><div class='cell time'>"+getMessageTime(a[d].time)+"</div></div>"),"0"==a[d].isread&&$("#message-panel .table .row").last().addClass("unread");$("#message-panel .table .row").click(function(){var c=$("#message-panel .table .row").index($(this)),d=a[c].id,b=a[c].message,m=getMessageTime(a[c].time,!0),h=a[c].nick;c=a[c].picture;$("#message-panel").append("<div id='full-message'><div class='row head'><div class='image'><img src='"+c+"'></div><div class='user'>"+
h+"</div><div class='time'>"+m+"</div></div><div class='row body'><div class='message'>"+b+"</div></div><div class='row buttons'><button class='button' id='back'><img src='icon/back.png'><span>Retornar</span></button><button class='button' id='reply'><img src='icon/reply.png'><span>Responder</span></button><button class='button' id='unread'><img src='icon/unread.png'><span>Marcar n\u00e3o lido</span></button><button class='button' id='delete'><img src='icon/delete2.png'><span>Excluir</span></button></div></div>");
$("#message-panel #full-message").hide();$("#message-panel .table").fadeOut(function(){$("#message-panel #full-message").toggle("scale")});$.post("back_message.php",{action:"READ",id:d,value:1});$("#message-panel #back").click(function(){$("#menu #messages").click()});$("#message-panel #reply").click(function(){$("#message-panel #full-message .row.buttons").hide();$("#message-panel #full-message").append("<div class='row reply'><textarea class='input'></textarea><div class='row buttons'><button class='button' id='send'><img src='icon/reply.png'><span>Enviar</span></button><button class='button' id='cancel'><img src='icon/delete2.png'><span>Descartar</span></button></div></div>");
$("#message-panel #full-message .reply").hide().fadeIn();$("#message-panel #full-message .input").focus();$("#message-panel #full-message .input").on("input",function(){var a=this.offsetHeight-this.clientHeight;300<=$(this).height()?$(this).height(300):$(this).css("height","auto").css("height",this.scrollHeight+a)});$("#message-panel #full-message #send").click(function(){var a=$("#message-panel #full-message .input").val();$.post("back_message.php",{action:"REPLY",replyid:d,message:a}).done(function(){$("#menu #messages").click();
$.post("back_sendmail.php",{action:"MESSAGE",replyid:d,message:a}).done(function(a){})})});$("#message-panel #full-message #cancel").click(function(){$("#message-panel #full-message .row.reply").remove();$("#message-panel #full-message .row.buttons").show()})});$("#message-panel #unread").click(function(){$.post("back_message.php",{action:"READ",id:d,value:0}).done(function(){$("#menu #messages").click()})});$("#message-panel #delete").click(function(){$.post("back_message.php",{action:"DELETE",id:d}).done(function(){$("#menu #messages").click()})})})})});
$("#friend-panel #request, #friend-panel #friends").addClass("hidden");$("#menu #friends").click(function(){$.post("back_friends.php",{action:"GET"}).done(function(a){a=JSON.parse(a);0<a.pending.length&&$("#friend-panel #request").removeClass("hidden");0<a.confirmed.length&&$("#friend-panel #friends").removeClass("hidden");$("#friend-panel #request .table").html("");for(var d in a.pending){var c=a.pending[d].nick,k=a.pending[d].id,b=a.pending[d].picture,m=a.pending[d].lvl;$("#friend-panel #request .table").append("<div class='row'><div class='cell lvl-container'><img title='N\u00edvel' src='res/star.png'><span>"+
m+"</span></div><div class='cell image-container'><img src='"+b+"'></div><div class='cell user'>"+c+"</div><div class='button-container'><div class='check' title='Aceitar solicita\u00e7\u00e3o'></div><div class='close' title='Recusar solicita\u00e7\u00e3o'></div></div></div>");$("#friend-panel #request .table .row").last().data("id",k)}$("#friend-panel #friends .table").html("");for(d in a.confirmed){c=a.confirmed[d].nick;var h=a.confirmed[d].user;m=a.confirmed[d].lvl;k=a.confirmed[d].id;b=a.confirmed[d].picture;
var e=last_active_string(a.confirmed[d].active);$("#friend-panel #friends .table").append("<div class='row'><div class='cell lvl-container'><img title='N\u00edvel' src='res/star.png'><span>"+m+"</span></div><div class='cell image-container'><img src='"+b+"'></div><div class='cell'>"+c+"</div><div class='cell last-active'><span class='label'>\u00daltima atividade</span><span>"+e+"</span></div><div class='button-open'></div></div>");$("#friend-panel #friends .table .row").last().data({id:k,user:h,nick:c})}$("#friend-panel .check, #friend-panel .close").click(function(){var a=
"NO";$(this).hasClass("check")&&(a="YES");$.post("back_friends.php",{action:"REQUEST",answer:a,id:$(this).parents(".row").data("id")}).done(function(a){$("#menu #friends").click()})});$("#friend-panel #friends .button-open").click(function(){p();var a=$(this);$("#friend-panel #friends .button-open").removeClass("open");$(this).addClass("open");var b=$("#friend-panel #friends .options");b.css({top:a.position().top,left:a.position().left+a.width()}).hide().animate({height:"toggle",width:"toggle",left:a.position().left-
b.width()+a.width()},500,function(){b.addClass("open")})})})});$(window).click(function(a){$("#friend-panel #friends .options").hasClass("open")&&p()});$("#friend-panel #friends .unfriend").click(function(){var a=$("#friend-panel #friends .button-open.open"),d=a.parents(".row"),c=a.parents(".row").data("id");a=a.parents(".row").data("nick");showDialog("Deseja remover <span class='highlight'>"+a+"</span> da sua lista de amigos?",["Sim","N\u00e3o"]).then(function(a){"Sim"==a&&$.post("back_friends.php",
{action:"DELETE",user:c}).done(function(a){d.remove()})})});$("#friend-panel #friends .message").click(function(){var a=$("#friend-panel #friends .button-open.open");r(a)});$("#friend-panel #friends .duel").click(function(){var a=$("#friend-panel #friends .button-open.open"),d=a.parents(".row").data("nick"),c=a.parents(".row").data("user");a="<div id='fog'><div id='duel-box'><div id='title'>Escolha o gladiador que duelar\u00e1 contra <span class='highlight'>"+d+"</span> em nome da sua honra</div><div class='glad-card-container'></div><div id='button-container'><button id='cancel' class='button'>Cancelar</button><button id='invite' class='button' disabled>DESAFIAR</button></div></div></div>";
$("body").append(a);var k=$("<div id='template'></div>").load("glad-card-template.html",function(){});$.post("back_glad.php",{action:"GET"}).done(function(a){a=JSON.parse(a);for(var b in a)$("#fog .glad-card-container").append("<div class='glad-preview'></div>");$("#fog .glad-card-container .glad-preview").html(k);for(b in a)setGladImage($("#fog .glad-card-container"),b,a[b].skin),$("#fog .glad-preview .info .glad span").eq(b).html(a[b].name),$("#fog .glad-preview .info .attr .str span").eq(b).html(a[b].vstr),
$("#fog .glad-preview .info .attr .agi span").eq(b).html(a[b].vagi),$("#fog .glad-preview .info .attr .int span").eq(b).html(a[b].vint),$("#fog .glad-preview").eq(b).data("id",a[b].id);$("#fog .glad-preview .code .button").remove();$("#fog .glad-preview .delete-container").remove();$("#fog .glad-preview").click(function(){$("#fog #btn-glad-open").removeProp("disabled");$("#fog .glad-preview").removeClass("selected");$(this).addClass("selected");$("#duel-box #invite").removeProp("disabled")});$("#fog .glad-preview").dblclick(function(){$("#fog #duel-box #invite").click()})});
$("#duel-box #cancel").click(function(){$("#fog").remove()});$("#duel-box #invite").click(function(){var a=$("#fog .glad-preview.selected").data("id"),k=$("#fog .glad-preview.selected .info .glad span").html();$.post("back_duel.php",{action:"CHALLENGE",glad:a,friend:c}).done(function(a){$("#fog").remove();"EXISTS"==a?showMessage("J\u00e1 existe um desafio de duelo para <span class='highlight'>"+d+"</span> usando o gladiador <span class='highlight'>"+k+"</span>."):"OK"==a?(showMessage("Desafio enviado para <span class='highlight'>"+
d+"</span>. Assim que uma resposta for dada voc\u00ea ser\u00e1 notificado."),$.post("back_sendmail.php",{action:"DUEL",friend:c}).done(function(a){})):console.log(a)})})});$("#friend-panel input").on("input",function(){var a=$(this).val();$.post("back_friends.php",{action:"SEARCH",text:a}).done(function(a){a=JSON.parse(a);$("#friend-panel #search .table").html("");for(var c in a){var d=a[c].nick,b=a[c].user;$("#friend-panel #search .table").append("<div class='row'><div class='cell'>"+d+"</div><div class='cell button-container'><div class='send-message' title='Enviar mensagem'></div><div class='add-friend' title='Enviar convite de amizade'></div></div></div>");
$("#friend-panel #search .table .row").last().data({user:b,nick:d})}$("#friend-panel #search .add-friend").click(function(){var a=$(this).parents(".row").data("nick"),b=$(this).parents(".row").data("user");$.post("back_friends.php",{action:"ADD",user:b}).done(function(c){"EXISTS"==c?showMessage("O usu\u00e1rio <span class='highlight'>"+a+"</span> j\u00e1 est\u00e9 em sua lista de amigos"):(showMessage("Convite enviado para <span class='highlight'>"+a+"</span>"),$.post("back_sendmail.php",{action:"FRIEND",
friend:b}).done(function(a){}))})});$("#friend-panel #search .send-message").click(function(){r($(this))})})});$("#menu #logout").click(function(){googleLogout().then(function(){window.location.href="index.php"})});$("#img-preview-container").hide();$("#img-upload").dropzone({url:"#",acceptedFiles:"image/*",previewTemplate:"<div class='dz-preview'></div>",accept:function(a,d){d()},init:function(){this.on("addedfile",function(a){$(".dz-preview").remove();$("#img-preview-container").append($(a.previewElement));
$("#img-preview-container").fadeIn()})},success:function(a,d){var c=new Image;c.src=a.dataURL;c.onload=function(){$(".dz-preview").html("<button id='crop-image' class='button'>RECORTAR IMAGEM</button><img src='"+c.src+"'>");var a=new Croppie($(".dz-preview img")[0],{viewport:{width:150,height:150},boundary:{width:300,height:300}});$(".cr-slider").addClass("slider");$("#crop-image").on("click",function(){a.result("base64").then(function(a){$("#img-upload").css({"background-image":"url("+a+")","background-size":"cover"});
user.foto=a;$("#img-preview-container").hide()})})}},error:function(a,d){},removedfile:function(a){},complete:function(a){}})});
function preBattleShow(e){$("#fog").remove();$("body").append("<div id='fog'><div id='pre-battle-show'><div class='glad-card-container'></div></div></div>");$("#fog").hide();for(var f in e)$("#pre-battle-show .glad-card-container").append("<div class='glad-preview'></div>");var g=$("<div id='template'></div>").load("glad-card-template.html",function(){$("#pre-battle-show .glad-card-container .glad-preview").html(g);for(var l in e)setGladImage($("#pre-battle-show"),l,e[l].skin),$("#pre-battle-show .glad-preview .info .glad span").eq(l).html(e[l].name),
$("#pre-battle-show .glad-preview .info .glad").eq(l).after("<div class='row user'><span>"+e[l].user+"</span></div>"),$("#pre-battle-show .glad-preview .info .user").eq(l).after("<div class='row mmr'><span>"+parseInt(e[l].mmr)+"</span><img src='icon/winner-icon.png'></div>"),$("#pre-battle-show .glad-preview .info .attr .str span").eq(l).html(e[l].vstr),$("#pre-battle-show .glad-preview .info .attr .agi span").eq(l).html(e[l].vagi),$("#pre-battle-show .glad-preview .info .attr .int span").eq(l).html(e[l].vint);
$("#pre-battle-show .glad-preview .delete-container").remove();$("#pre-battle-show .glad-preview .row.code").remove();$("#pre-battle-show").append("<div id='tips'><span></span></div><div id='progress'></div>");$("#pre-battle-show #tips").html(p[parseInt(Math.random()*p.length)]);$("#fog").fadeIn()}),p="Obrigado por fazer parte da vers\u00e3o beta da gladCode;Enquanto seu gladiador tiver menos de 1000 de renome, ele perder\u00e1 menos renome;Se voc\u00ea for o vencedor de uma batalha, seu gladiador ganhar\u00e1 muito renome;Mesmo quando perder uma batalha, o gladiador pode ganhar renome, dependendo do tempo que ficou vivo;Ser um dos primeiros a morrer \u00e9 a receita para perder grandes quantidades de renome;Se estiver enfrentando gladiadores mais fortes, o seu tende a ganhar mais renome;Gladiadores de renome semelhante s\u00e3o automaticamente selecionados para se enfrentar;Observe o comportamento de seus inimigos, e tente adaptar a l\u00f3gica do seu gladiador para derrot\u00e1-los;Quando voc\u00ea est\u00e1 offline, seus gladiadores podem ser desafiados. Eles podem subir ou descer no ranking;Voc\u00ea pode ver as \u00faltimas batalhas que seus gladiadores participaram no menu BATALHA;Voc\u00ea pode procurar por usu\u00e1rios ou enviar mensagens para seus amigos no menu AMIGOS;Participar de batalhas concede experi\u00eancia para o mestre, que lhe concede uma s\u00e9rie de benef\u00edcios;Est\u00e1 com d\u00favida em algo? pergunte na p\u00e1gina do facebook ou comunidade do reddit da gladCode;Seja um membro ativo da comunidade comentando e dando sua opini\u00e3o no facebook ou reddit;Assista o replay de suas batalhas, assim voc\u00ea entende melhor o comportamentos de seus gladiadores;A documenta\u00e7\u00e3o \u00e9 a melhor maneira de compreender como uma fun\u00e7\u00e3o funciona. Tem exemplos!;N\u00e3o entendeu algo sobre o funcionamento da gladCode? O manual da simula\u00e7\u00e3o est\u00e1 ali \u00e0 sua disposi\u00e7\u00e3o".split(";"),
r=0,q=setInterval(function(){var e=$("#battle-container #match-find").width();e=$("#battle-container #match-find #bar").width()/e;var f=$("#pre-battle-show").height()*e;$("#pre-battle-show #progress").css({height:f,"margin-top":-f});1<=e&&clearInterval(q);0==r/100%4&&(e=parseInt(Math.random()*p.length),$("#pre-battle-show #tips").html(p[e]));r++},10);return q}
function setGladImage(e,f,g){fetchSpritesheet(g).then(function(g){e.find(".glad-preview .image").eq(f).html(getSpriteThumb(g,"walk","down"))})}function getImage(e){for(var f in images)if(images[f].id==e)return images[f];return!1}
function getSpriteThumb(e,f,g){var p={walk:8,cast:0,thrust:4,slash:12,shoot:16,up:0,left:1,down:2,right:3};f=p[f]+p[g];g=document.createElement("canvas");g.setAttribute("width",64);g.setAttribute("height",64);g.getContext("2d").drawImage(e,64,192*f+64,64,64,0,0,64,64);return g}
function fetchSpritesheet(e){var f=$.Deferred(),g={walk:{sprites:9,line:8},cast:{sprites:7,line:0},thrust:{sprites:8,line:4},slash:{sprites:6,line:12},shoot:{sprites:13,line:16}},p=!1;try{e=JSON.parse(e)}catch(k){p=!0,e={}}var r=document.createElement("canvas");r.setAttribute("width",2496);r.setAttribute("height",4032);var q=r.getContext("2d"),l=0,n=[],a;for(a in e)getImage(e[a])&&n.push(getImage(e[a]));validate_skin(n)||(p=!0);if(p)c=new Image,c.src="res/glad.png",c.onload=function(){for(var a=0;21>
a;a++)for(var b=0;13>b;b++)q.drawImage(c,64*b,64*a,64,64,64+192*b,64+192*a,64,64);return f.resolve(r)};else{var d=function(){for(var a=0;a<n.length;a++)if(c[a])if(n[a].oversize)for(var b=g[n[a].move].line,d=g[n[a].move].sprites,e=0;4>e;e++)for(var f=0;f<d;f++)q.drawImage(c[a],192*f,192*e,192,192,192*f,192*b+192*e,192,192);else for(e=0;21>e;e++)for(f=0;13>f;f++)q.drawImage(c[a],64*f,64*e,64,64,64+192*f,64+192*e,64,64)};n.sort(function(a,b){if(null==a.layer)return-1;if(null==b.layer)return 1;"object"===
typeof a.layer&&(a.layer=a.layer.down);"object"===typeof b.layer&&(b.layer=b.layer.down);return a.layer-b.layer});q.clearRect(0,0,r.width,r.height);var c=[];for(a=0;a<n.length;a++)if(n[a]&&""!=n[a].path&&!n[a].png)c[a]=new Image,c[a].src="sprite/Universal-LPC-spritesheet/"+n[a].path,c[a].onload=function(){l++;if(l==n.length)return d(),f.resolve(r)};else if(l++,l==n.length)return d(),f.resolve(r)}return f.promise()}
function last_active_string(e){e=parseInt(e);var f=parseInt(e/60);e%=60;var g=parseInt(f/24);f%=24;var p=parseInt(g/30);g%=30;return 0<p?p+" meses":0<g?g+" dias":0<f?f+" horas":e+" minutos"}
function getMessageTime(e,f){if(f)return t=new Date(e),t.getDate()+" de "+"jan fev mar abr mai jun jul ago set out nov dez".split(" ")[t.getMonth()]+" de "+t.getFullYear()+" \u00e0s "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2);var g=new Date;e=new Date(e);g=Math.round(g.getTime()/1E3);var p=Math.round(e.getTime()/1E3);return last_active_string((g-p)/60)}function validate_skin(e){for(var f in e)if("shape"==e[f].parent)return!0;return!1};