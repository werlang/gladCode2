async function checkNotifications(){return $.post("back_notification.php",{action:"GET"}).done(function(e){try{e=JSON.parse(e)}catch(e){console.log(e)}$("#profile-ui #lvl span").html(e.user.lvl),user.lvl=e.user.lvl;var a=getXpToNextLvl(),t=parseInt(e.user.xp);user.xp=e.user.xp,$("#profile-ui #xp #filled").width(t/a*100+"%"),$("#currencies #silver span").html(e.user.silver),user.silver=e.user.silver,$("#messages .notification").html(e.messages),0==parseInt(e.messages)?$("#messages .notification").addClass("empty"):$("#messages .notification").removeClass("empty");var n=parseInt(e.news);$("#news .notification").html(n),0==n?$("#news .notification").addClass("empty"):$("#news .notification").removeClass("empty");var i=parseInt(e.friends);$("#friends .notification").html(i),0==i?$("#friends .notification").addClass("empty"):$("#friends .notification").removeClass("empty");var s=parseInt(e.glads.remaining),o=parseInt(e.glads.obsolete);$("#glads .notification").html(s+o),s+o==0?$("#glads .notification").addClass("empty"):$("#glads .notification").removeClass("empty");let l=parseInt(e.duels);$("#battle .notification").html(l).addClass("empty"),$("#battle-container #duel .notification").html(l).addClass("empty"),$("#battle-container #duel-challenge .table .row").length!=l&&check_challenges(),l>0&&($("#battle .notification").html(l).removeClass("empty"),$("#battle-container #duel .notification").html(l).removeClass("empty"));let r={ranked:parseInt(e.reports.ranked),duel:parseInt(e.reports.duel)};r.total=r.ranked+r.duel,$("#report .notification").html(r.total),$("#report .notification").addClass("empty"),$("#report-container #ranked.tab .notification").addClass("empty"),$("#report-container #duel.tab .notification").addClass("empty"),r.total>0&&($("#report .notification").removeClass("empty"),r.ranked>0&&$("#report-container #ranked.tab .notification").removeClass("empty"),r.duel>0&&$("#report-container #duel.tab .notification").removeClass("empty"))})}function afterBattleShow(e,a){$("#fog").remove(),$("body").append("<div id='fog'>\n        <div id='after-battle'>\n            <div class='row'>\n                <div class='col'>\n                    <div class='glad-card-container'></div>\n                    <div id='bonus'>\n                        <div>Bônus <i class='fas fa-coins silver'></i> (<span id='nbattles'>0</span>/20)</div>\n                        <div>Próximo em: <span id='nextbonus'>00:00:00</span></div>\n                    </div>\n                </div>\n                <div class='col'>\n                    <h2>Batalha concluída</h2>\n                    <div class='row group'>\n                        <div class='col'>\n                            <span>Seu nível</span>\n                            <div id='lvl'><span class='value'></span><span id='plusone' class='hidden'>(+1)</span></div>\n                        </div>\n                        <div class='col'>\n                            <span>Experiência</span>\n                            <div id='xp-text'><span id='xp-now'></span><span id='xp-increase'></span>/<span id='xp-total'></span></div>\n                            <div id='xp-bar-container'>\n                                <div id='xp-bar'><div id='filled'></div></div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class='row group'>\n                        <div class='col'>\n                            <span>Renome</span>\n                            <div id='renown-now' class='skip-translation'><span class='svg hidden'>icon/crown.svg</span><span class='value'></span></div>\n                            <span id='renown-total'></span>\n                        </div>\n                        <div class='col'>\n                            <span>Prata</span>\n                            <div id='silver-now' class='skip-translation'><span class='svg hidden'>icon/coin.svg</span><span class='value'></span></div>\n                            <span id='silver-total'></span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div id='button-container'>\n                <button id='code'><i class='fas fa-code'></i><span>EDITAR GLADIADOR</span></button>\n                <button id='close'><i class='fas fa-times'></i><span>FECHAR JANELA</span></button>\n                <button id='watch'><i class='fas fa-eye'></i><span>VISUALIZAR BATALHA</span></button>\n            </div>\n        </div>\n    </div>"),translator.translate($("#after-battle")),$("#fog #after-battle span.svg").each(function(){load_svg($(this))}),post("back_notification.php",{action:"SUMMARY",hash:e}).then(e=>{$("#fog #after-battle #lvl .value").html(e.lvl);let t=e.xp-a.xp.value;a.lvl!=e.lvl&&($("#fog #after-battle #lvl #plusone").removeClass("hidden"),t=(parseFloat(e.xp)+parseFloat(a.xp.total)-parseFloat(a.xp.value)).toFixed(0));let n=1500,i=100;new valueAnimator({time:n,steps:i,start:0,end:t,onStep:e=>{0!=e&&$("#fog #after-battle #xp-increase").html(`(+${parseInt(e)})`)}}).run(),new valueAnimator({time:n,steps:i,start:a.xp.value,end:e.xp,onStep:e=>{$("#fog #after-battle #xp-now").html(parseInt(e))}}).run(),new valueAnimator({time:n,steps:i,start:a.xp.value/a.xp.total*100,end:e.xp/getXpToNextLvl()*100,onStep:e=>{$("#fog #after-battle #xp-bar #filled").css("width",`${e}%`)}}).run(),$("#fog #after-battle #xp-total").html(parseInt(getXpToNextLvl())),new valueAnimator({time:n,steps:i,start:0,end:e.silver-a.silver,onStep:e=>{$("#fog #after-battle #silver-now .value").html(`+${parseInt(e)}`)}}).run(),new valueAnimator({time:n,steps:i,start:a.silver,end:e.silver,onStep:e=>{$("#fog #after-battle #silver-total").html(e.toFixed(0))}}).run();let s=parseInt(e.glad.mmr)-parseInt(a.mmr);s>0?$("#fog #after-battle #renown-now .value").addClass("green"):s<0&&$("#fog #after-battle #renown-now .value").addClass("red"),new valueAnimator({time:n,steps:i,start:0,end:s,onStep:e=>{e=s>0?`+${parseInt(e)}`:parseInt(e),$("#fog #after-battle #renown-now .value").html(e)}}).run(),new valueAnimator({time:n,steps:i,start:a.mmr,end:e.glad.mmr,onStep:e=>{$("#fog #after-battle #renown-total").html(parseInt(e))}}).run(),load_glad_cards($("#fog #after-battle .glad-card-container"),{customLoad:[e.glad]}),$("#fog #after-battle #nbattles").text(20-e.battles.total),20==e.battles.total&&$("#fog #after-battle #nbattles").addClass("red"),timeCounter($("#fog #after-battle #nextbonus"),e.battles.next),$("#fog #after-battle #code").click(()=>{window.open(`glad-${e.glad.id}`)})}),$("#fog #after-battle #close").click(()=>{$("#fog").remove()}),$("#fog #after-battle #watch").click(()=>{window.open(`play/${e}`)})}function timeCounter(e,a){function t(){setTimeout(function(){let n=parseInt(parseInt(a)/60),i=parseInt(a)%60,s=parseInt(n/60);n%=60,s<10&&(s=`0${s}`),n<10&&(n=`0${n}`),i<10&&(i=`0${i}`),a--,a>0&&e.length&&(e.text(`${s}:${n}:${i}`),t())},1e3)}t()}async function preBattleShow(e){for(var a in $("#fog").remove(),$("body").append("<div id='fog'><div id='pre-battle-show'><div class='glad-card-container'></div></div></div>"),$("#fog").hide(),e)$("#pre-battle-show .glad-card-container").append("<div class='glad-preview'></div>");var t=$("<div id='template'></div>").load("glad-card-template.html",function(){for(var a in $("#pre-battle-show .glad-card-container .glad-preview").html(t),translator.translate($(".glad-card-container")),e)setGladImage($("#pre-battle-show"),a,e[a].skin),$("#pre-battle-show .glad-preview .info .glad span").eq(a).html(e[a].name),$("#pre-battle-show .glad-preview .info .glad").eq(a).after("<div class='row user'><span>"+e[a].user+"</span></div>"),$("#pre-battle-show .glad-preview .info .user").eq(a).after("<div class='row mmr'><span>"+parseInt(e[a].mmr)+"</span><img src='icon/winner-icon.png'></div>"),$("#pre-battle-show .glad-preview .info .attr .str span").eq(a).html(e[a].vstr),$("#pre-battle-show .glad-preview .info .attr .agi span").eq(a).html(e[a].vagi),$("#pre-battle-show .glad-preview .info .attr .int span").eq(a).html(e[a].vint);$("#pre-battle-show .glad-preview .delete-container").remove(),$("#pre-battle-show .glad-preview .row.code").remove(),$("#pre-battle-show").append("<div id='tips'><span></span></div><div id='progress'></div>"),$("#pre-battle-show #tips").html(tipArray[parseInt(Math.random()*tipArray.length)]),$("#fog").fadeIn()}),n=0,i=setInterval(function(){var e=$("#battle-container #match-find").width(),a=$("#battle-container #match-find #bar").width(),t=a/e,s=$("#pre-battle-show").height()*t;$("#pre-battle-show #progress").css({height:s,"margin-top":-s}),t>=1&&clearInterval(i);var o=10;if(n/100%o==0){var l=parseInt(Math.random()*tipArray.length);$("#pre-battle-show #tips").html(tipArray[l])}n++},10);return i}function last_active_string(e){e=parseInt(e);var a=parseInt(e/60);e%=60;var t=parseInt(a/24);a%=24;var n=parseInt(t/30);return t%=30,n>0?n+" "+translator.getTranslated("meses",dom=!1):t>0?t+" "+translator.getTranslated("dias",dom=!1):a>0?a+" "+translator.getTranslated("horas",dom=!1):e+" "+translator.getTranslated("minutos",dom=!1)}function getMessageTime(e,a){var n=!1,i=!1;if(a&&(a.short&&(n=!0),a.month_full&&(i=!0)),n){var s=new Date;e=new Date(e);var o=Math.round(s.getTime()/1e3),l=Math.round(e.getTime()/1e3),r=(o-l)/60;return last_active_string(r)}var d=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];if(!i)for(let e in d)d[e]=d[e].toLowerCase().slice(0,3);t=new Date(e);var c=t.getDate()+" de "+d[t.getMonth()]+" de "+t.getFullYear()+" às "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2);return c}function validate_skin(e){for(var a in e)if("shape"==e[a].parent)return!0;return!1}async function check_challenges(){let e=await post("back_duel.php",{action:"GET"});if("SUCCESS"==e.status){for(var a in e=e.duels,$("#duel-challenge").addClass("hidden"),e.length>=1&&$("#duel-challenge").removeClass("hidden"),$("#duel-challenge .table").html(""),e){var t=e[a].nick,n=e[a].time,i=e[a].lvl,s=e[a].picture;$("#duel-challenge .table").append(`<div class='row'>\n                <div class='cell lvl-container'>\n                    <img src='res/star.png' title='Nível'><span>${i}</span>\n                </div>\n                <div class='cell image-container'><img src='${s}'></div>\n                <div class='cell user'>${t}</div>\n                <div class='cell time' title='${getMessageTime(n)}'>${getMessageTime(n,{short:!0})}</div>\n                <div class='button-container'>\n                    <div class='accept' title='Aceitar desafio'></div>\n                    <div class='refuse' title='Recusar desafio'></div>\n                </div>\n            </div>`),$("#duel-challenge .table .row").last().data("id",e[a].id)}$("#duel-challenge .table .refuse").click(function(){var e=$(this).parents(".row"),a=e.data("id");$.post("back_duel.php",{action:"DELETE",id:a}).done(function(a){a=JSON.parse(a),"OK"==a.status&&(new Message({message:"Desafio recusado"}).show(),e.remove(),0==$("#duel-challenge .table .row").length&&$("#duel-challenge").addClass("hidden"))})}),$("#duel-challenge .table .accept").click(function(){var e=$(this).parents(".row"),a=e.find(".user").html(),t=e.data("id"),n="<div id='fog'><div id='duel-box'><div id='title'>Escolha o gladiador que duelará contra <span class='highlight'>"+a+"</span> em nome da sua honra</div><div class='glad-card-container'></div><div id='button-container'><button id='cancel' class='button'>Cancelar</button><button id='duel' class='button' disabled>DUELAR</button></div></div></div>";$("body").append(n),load_glad_cards($("#fog .glad-card-container"),{clickHandler:function(){$(this).hasClass("old")||($("#fog #btn-glad-open").removeAttr("disabled"),$("#fog .glad-preview").removeClass("selected"),$(this).addClass("selected"),$("#duel-box #duel").removeAttr("disabled"))},dblClickHandler:function(){$("#fog .glad-card-container .selected").length&&$("#fog #duel-box #duel").click()}}),$("#fog #duel-box #duel").click(function(){var e=$("#fog .glad-preview.selected").data("id"),a=new progressButton($(this),["Executando batalha...","Aguardando resposta do servidor"]);runSimulation({duel:t,glads:e,origin:"duel"}).then(function(e){a.kill(),$("#fog").remove();var t=e;new Message({message:"Duelo concluído. Clique para visualizar a batalha."}).show().click("ok",function(){window.open(`play/${t}`)}),$("#battle").click()})}),$("#fog #duel-box #cancel").click(function(){$("#fog").remove()})})}}function getXpToNextLvl(){return 130*(1.9*parseInt(user.lvl)+1)}function load_svg(e){$.get(e.html(),null,null,"text").then(a=>e.removeClass("hidden").html(a))}var tipArray=["Obrigado por fazer parte da versão beta da gladCode","Enquanto seu gladiador tiver menos de 1000 de renome, ele perderá menos renome","Se você for o vencedor de uma batalha, seu gladiador ganhará muito renome","Mesmo quando perder uma batalha, o gladiador pode ganhar renome, dependendo do tempo que ficou vivo","Ser um dos primeiros a morrer é a receita para perder grandes quantidades de renome","Se estiver enfrentando gladiadores mais fortes, o seu tende a ganhar mais renome","Gladiadores de renome semelhante são automaticamente selecionados para se enfrentar","Observe o comportamento de seus inimigos, e tente adaptar a lógica do seu gladiador para derrotá-los","Quando você está offline, seus gladiadores podem ser desafiados. Eles podem subir ou descer no ranking","Você pode ver as últimas batalhas que seus gladiadores participaram no menu HISTÓRICO","Você pode procurar por usuários ou enviar mensagens para seus amigos no menu AMIGOS","Participar de batalhas concede experiência para o mestre, que lhe permite recrutar mais gladiadores","Está com dúvida em algo? pergunte na página do facebook ou comunidade do reddit da gladCode","Quer conversar com outros mestres? Interaja de WhatsApp ou chat da gladCode","Assista o replay de suas batalhas, assim você entende melhor o comportamentos de seus gladiadores","A documentação é a melhor maneira de compreender como uma função funciona. Tem exemplos!","Não entendeu algo sobre o funcionamento da gladCode? O manual da simulação está ali à sua disposição","Ali no menu BATALHA, Você pode desafiar seus amigos para duelos de 1x1 para ver quem é o melhor","No menu BATALHA, você pode criar ou participar de um torneio. Junte seus amigos e convide-os","O chat da gladCode é o meio mais prático de compartilhar código e conhecer outros mestres. Experimente","Já viu que têm um botão de preferências nas batalhas, que te permite ajustar várias coisas legais?","A habilidade FIREBALL é efetiva no longo prazo, pois queima o inimigo aos poucos","A habilidade TELEPORT te envia para qualquer lugar. Mas cuide o gás tóxico","A habilidade CHARGE é ótima para se aproximar dos inimigos e causa um bom dano pela distância percorrida","A habilidade BLOCK é menos efetiva quando você leva dano pelas costas","A habilidade ASSASSINATE causa muito dano se você conseguir pegar o oponente desprevinido","A habilidade AMBUSH é ótima tanto para se livrar de perigos como para iniciar um combate","Cuide para nunca ficar na zona do gás tóxico. Mesmo o gladiador mais forte sucumbe nela rapidamente","É bom garantir o centro da arena, mas cuidado para não virar alvo de vários inimigos","Fugir das batalhas te mantém vivo, mas te deixa atrasado no poder que os níveis te concede","Cada um dos três atributos te concede características essenciais para todo tipo de gladiador","Sem FORÇA, um gladiador tem pouca vida, e morre rapidamente","Sem AGILIDADE, um gladiador é lento, tanto em seus ataques como em seus movimentos","Sem INTELIGÊNCIA, um gladiador não consegue lançar muitas habilidades","Com uma boa estratégia, você pode criar gladiadores híbridos que se beneficiam de várias habilidades","Se você tem pouca vida, jamais deixe um inimigo chegar muito perto de você","Se você é um mago, não fique parado. Ser atordoado pode te custar a vida","Se você é um guerreiro, abuse do BLOCK, ele é a ferramenta que te deixará vivo","Uma FIREBALL arremessada em uma área com mais de um inimigo fará todos levarem dano de queimadura","Ganhe moedas de prata por iniciar batalhas ranqueadas","As primeiras 20 batalhas no intervalo de 24 horas rendem mais moedas de prata","No menu POÇÕES você pode acessar todos itens disponíveis no apotecário","Aumente o nível do seu apotecário para ganhar acesso a mais e melhores itens","Os itens encomendados no apotecário ficam disponíveis para uso em todas suas batalhas","Aumente seu nível de mestre para desbloquear mais espeços para encomandar poções","Use a poção de vitalidade para impedir que seu gladiador morra","Use a poção de concentração quando seu gladiador necessitar com urgência de pontos de habilidade","Quer dar uma melhorada em algum de seus atributos? O tônico fortificate é o que você precisa","Você tira melhor proveito do elixir da sabedoria quando usa ele assim que seu gladiador ganha um nível"];$(document).ready(function(){function e(e){$.post("back_friends.php",{action:"FILTER",text:e}).done(function(e){e=JSON.parse(e),$("#panel #duel.wrapper #table-friends").html("");for(let t in e){var a="<div class='row'><div class='cell image'><img src='"+e[t].picture+"'></div><div class='cell nick'>"+e[t].nick+"</div></div>";$("#panel #duel.wrapper #table-friends").append(a),$("#panel #duel.wrapper #table-friends .row").last().data("user",e[t].user)}$("#panel #duel.wrapper #table-friends .row").click(function(){$("#panel #duel.wrapper #table-friends .row").removeClass("selected"),$(this).addClass("selected"),$("#panel #duel.wrapper #challenge").removeAttr("disabled")})})}function a(){$("#message-panel #full-message").remove(),$("#message-panel .table").show(),$.post("back_message.php",{action:"GET",page:o}).done(function(e){try{e=JSON.parse(e)}catch(e){console.log(e)}var a=e.meta;if(e=e.info,0==a.total)$("#message-panel .table").html("Você ainda não possui mensagens");else{for(var t in $("#message-panel #page-title span").eq(0).html(a.start),$("#message-panel #page-title span").eq(1).html(a.end),$("#message-panel #page-title span").eq(2).html(a.total),1==a.page?$("#message-panel #prev").prop("disabled",!0):$("#message-panel #prev").removeAttr("disabled"),a.end==a.total?$("#message-panel #next").prop("disabled",!0):$("#message-panel #next").removeAttr("disabled"),$("#message-panel .table").html(""),e)$("#message-panel .table").append("<div class='row'><div class='cell user'>"+e[t].nick+"</div><div class='cell message'>"+e[t].message+"</div><div class='cell time'>"+getMessageTime(e[t].time,{short:!0})+"</div></div>"),"0"==e[t].isread&&$("#message-panel .table .row").last().addClass("unread");$("#message-panel .table .row").click(function(){var a=$("#message-panel .table .row").index($(this)),t=e[a].id,n=e[a].message,i=getMessageTime(e[a].time),s=e[a].nick,o=e[a].picture;$("#message-panel").append("<div id='full-message'><div class='row head'><div class='image'><img src='"+o+"'></div><div class='user'>"+s+"</div><div class='time'>"+i+"</div></div><div class='row body'><div class='message'>"+n+"</div></div><div class='row buttons'><button class='button' id='back'><img src='icon/back.png'><span>Retornar</span></button><button class='button' id='reply'><img src='icon/reply.png'><span>Responder</span></button><button class='button' id='unread'><img src='icon/unread.png'><span>Marcar não lido</span></button><button class='button' id='delete'><img src='icon/delete2.png'><span>Excluir</span></button></div></div>"),$("#message-panel #full-message").hide(),$("#message-panel .table").fadeOut(function(){$("#message-panel #full-message").toggle("scale")}),$.post("back_message.php",{action:"READ",id:t,value:1}),$("#message-panel #back").click(function(){$("#menu #messages").click()}),$("#message-panel #reply").click(function(){$("#message-panel #full-message .row.buttons").hide(),$("#message-panel #full-message").append("<div class='row reply'><textarea class='input'></textarea><div class='row buttons'><button class='button' id='send'><img src='icon/reply.png'><span>Enviar</span></button><button class='button' id='cancel'><img src='icon/delete2.png'><span>Descartar</span></button></div></div>"),$("#message-panel #full-message .reply").hide().fadeIn(),$("#message-panel #full-message .input").focus(),$("#message-panel #full-message .input").on("input",function(){var e=this.offsetHeight-this.clientHeight;$(this).height()>=300?$(this).height(300):$(this).css("height","auto").css("height",this.scrollHeight+e)}),$("#message-panel #full-message #send").click(function(){var e=$("#message-panel #full-message .input").val();$.post("back_message.php",{action:"REPLY",replyid:t,message:e}).done(function(){$("#menu #messages").click(),$.post("back_sendmail.php",{action:"MESSAGE",replyid:t,message:e}).done(function(e){})})}),$("#message-panel #full-message #cancel").click(function(){$("#message-panel #full-message .row.reply").remove(),$("#message-panel #full-message .row.buttons").show()})}),$("#message-panel #unread").click(function(){$.post("back_message.php",{action:"READ",id:t,value:0}).done(function(){$("#menu #messages").click()})}),$("#message-panel #delete").click(function(){$.post("back_message.php",{action:"DELETE",id:t}).done(function(){$("#menu #messages").click()})})})}})}function t(){var e=$("#friend-panel #friends .button-open.open"),a=$("#friend-panel #friends .options");a.removeClass("open"),e.removeClass("open"),a.removeAttr("style")}function n(e,a){var t=`<div id='fog'>\n            <div id='duel-box'>\n                <div id='title'>Escolha o gladiador que duelará contra <span class='highlight'>${e}</span> em nome da sua honra</div>\n                <div class='glad-card-container'></div>\n                <div id='button-container'>\n                    <button id='cancel' class='button'>Cancelar</button><button id='invite' class='button' disabled>DESAFIAR</button>\n                </div>\n            </div>\n        </div>`;$("body").append(t),translator.translate($("#fog")),load_glad_cards($("#fog .glad-card-container"),{clickHandler:function(){$("#fog #btn-glad-open").removeAttr("disabled"),$("#fog .glad-preview").removeClass("selected"),$(this).addClass("selected"),$("#duel-box #invite").removeAttr("disabled")},dblClickHandler:function(){$("#fog #duel-box #invite").click()}}),$("#duel-box #cancel").click(function(){$("#fog").remove()}),$("#duel-box #invite").click(function(){var t=$("#fog .glad-preview.selected").data("id"),n=$("#fog .glad-preview.selected .info .glad span").html();$.post("back_duel.php",{action:"CHALLENGE",glad:t,friend:a}).done(function(t){t=JSON.parse(t),$("#fog").remove(),"EXISTS"==t.status?new Message({message:`Já existe um desafio de duelo contra <b>${e}</b> usando o gladiador <b>${n}</b>.`}).show():"OK"==t.status&&(new Message({message:`Desafio enviado para <b>${e}</b>. Assim que uma resposta for dada você será notificado.`}).show(),$.post("back_sendmail.php",{action:"DUEL",friend:a}).done(function(e){}))})})}function i(e){var a=e.parents(".row").data("user"),t=e.parents(".row").data("nick");new Message({message:`${translator.getTranslated("Mensagem para")} <b>${t}</b>:`,buttons:{cancel:translator.getTranslated("CANCELAR"),ok:translator.getTranslated("OK")},translate:!1,textarea:{placeholder:translator.getTranslated("Olá...",dom=!1)}}).show().click("ok",e=>{if(e){var t=e;$.post("back_message.php",{action:"SEND",id:a,message:t}).done(function(e){new Message({message:"Mensagem enviada"}).show(),$.post("back_sendmail.php",{action:"MESSAGE",receiver:a,message:t}).done(function(e){})})}})}$("#header-container").addClass("small-profile"),$("#header-profile").addClass("here"),fill_assets();var s=["friend","message","update","duel","tourn","translation"];if(waitLogged().then(e=>{if($("#tab").length){var a=$("#tab").html();$("#"+a).click(),$("#tab").remove()}else $("#menu #profile").click();$("#profile-ui #picture img").attr("src",e.foto),$("#profile-ui #nickname").html(e.apelido),$("#menu #currencies #money").remove(),$("#menu #currencies").removeClass("hidden"),$("#menu #currencies #silver span").html(parseInt(e.silver));var t=$("#profile-panel #language select");t.selectmenu().val(e.language).selectmenu("refresh"),checkNotifications(),socket_ready().then(()=>{socket.on("profile notification",e=>{checkNotifications()})}),$.post("back_glad.php",{action:"GET"}).done(function(e){0==JSON.parse(e).length&&showDialog("Você ainda não possui nenhum gladiador cadastrado. Deseja ir para o editor de gladiadores?",["Sim","Não, obrigado"]).then(function(e){"Sim"==e&&(window.location.href="editor")})}),translator.translate(tipArray).then(e=>{tipArray=e}),translator.translate(["meses","dias","horas","minutos","RECORTAR IMAGEM","Nenhuma batalha para mostrar","Gladiador","Renome","Data","Nenhum item neste espaço","de","Deseja excluir o gladiador","Sim","Não","SIM","NÃO","Última atividade","Aceitar solicitação","Recusar solicitação","Enviar mensagem","Enviar convite de amizade","Mensagem para","Olá...","CANCELAR"]).then(e=>{$("#tourn .title #offset .of").html(translator.getTranslated("de"))}),$("#panel").hide(),translator.translate([$("#menu"),$("#panel")]).then(()=>{$("#panel").show()})}),$("#menu .item").click(function(){if(!$(this).hasClass("disabled")){var e=$(this);$("#panel .content").removeClass("open"),$.each($("#panel").find(".content"),function(){$(this).data("menu")==e.attr("id")&&$(this).addClass("open")}),$("#menu .item").removeClass("here"),$(this).addClass("here")}}),$("#menu #news").click(function(){$.post("back_news.php",{action:"READ",page:0}).done(function(e){e=JSON.parse(e),$("#panel #news-container").html("");for(let a in e.posts)$("#panel #news-container").append(`<div class='post'>\n                    <div class='share' title='Compartilhar'><i class='fas fa-share-alt'></i></div>\n                    <div class='title'>${e.posts[a].title}</div>\n                    <div class='time'>Publicado em ${getMessageTime(e.posts[a].time,{month_full:!0})}</div>\n                    <div class='body'>${e.posts[a].post}</div>\n                </div>`),$("#panel #news-container .share").last().click(()=>{$("body").append(`<div id='fog'>\n                        <div id='link-box'>\n                            <h3>Link da publicação</h3>\n                            <input value='https://gladcode.dev/post/${e.posts[a].id}' readonly>\n                            <button>COPIAR</button>\n                        </div>\n                    </div>`),translator.translate($("#fog")),$("#fog").hide().fadeIn(),$("#fog").click(()=>{$("#fog").remove()}),$("#link-box").click(e=>{e.stopPropagation()}),$("#link-box button").click(()=>{$("#link-box input").select(),document.execCommand("copy"),create_toast("Link da publicação copiado para área de transferência","success")})});translator.translate($("#panel #news-container"))})}),$("#menu #profile").click(function(){for(var e in $("#nickname .input").val(user.apelido),s)"1"==user.preferences[s[e]]&&$("#profile-panel #pref-"+s[e]+" input.checkslider").prop("checked",!0)}),$("#profile-panel #pref-translation input.checkslider").click(function(){$("#profile-panel #pref-translation input.checkslider").prop("checked")?$("#profile-panel #translation-tip").slideDown():$("#profile-panel #translation-tip").fadeOut()}),$("#profile-panel .button").click(function(){for(var e in $("#profile-panel .button").prop("disabled",!0),s)$("#profile-panel #pref-"+s[e]+" input.checkslider").prop("checked")?user.preferences[s[e]]="1":user.preferences[s[e]]="0";$.post("back_login.php",{action:"UPDATE",nickname:$("#nickname .input").val(),picture:user.foto,preferences:JSON.stringify(user.preferences),language:$("#language select").val()}).done(function(e){e=JSON.parse(e),"SUCCESS"==e.status?(new Message({message:"Informações atualizadas"}).show(),$("#profile-panel .button").removeAttr("disabled"),user.apelido=$("#nickname .input").val(),$("#profile-ui #nickname").html(user.apelido),$("#profile-ui #picture img").attr("src",user.foto)):"EXISTS"==e.status&&(new Message({message:"Outro usuário já escolheu este nome"}).show().click("ok",function(){$("#nickname .input").focus().select()}),$("#profile-panel .button").removeAttr("disabled"))})}),$("#menu #glads").click(function(){$.post("back_glad.php",{action:"GET"}).done(function(e){e=JSON.parse(e);var a=$("<div id='template'></div>").load("glad-card-template.html",function(){for(var t in $("#glads-container .glad-preview").remove(),e.length>0&&$("#menu #battle").removeClass("disabled"),e)$("#glads-container .glad-card-container").append("<div class='glad-preview'></div>");for(var t in $("#glads-container .glad-card-container .glad-preview").html(a),translator.translate($(".glad-card-container")),e)setGladImage($("#glads-container"),t,e[t].skin),$("#glads-container .glad-preview .info .glad span").eq(t).html(e[t].name),$("#glads-container .glad-preview .info .attr .str span").eq(t).html(e[t].vstr),$("#glads-container .glad-preview .info .attr .agi span").eq(t).html(e[t].vagi),$("#glads-container .glad-preview .info .attr .int span").eq(t).html(e[t].vint),$("#glads-container .glad-preview").eq(t).data("id",e[t].id),$("#glads-container .glad-preview").eq(t).data("code",e[t].code),$("#glads-container .glad-preview").eq(t).data("blocks",e[t].blocks),e[t].oldversion&&($("#glads-container .glad-preview").eq(t).addClass("old"),$("#glads-container .glad-preview .code .button").eq(t).html("{'atualizar'}")),$("#glads-container .glad-preview .delete").eq(t).click(function(){var e=$(this).parents(".glad-preview");new Message({message:`${translator.getTranslated("Deseja excluir o gladiador")} <b>${e.find(".glad span").html()}</b>?`,buttons:{yes:translator.getTranslated("Sim"),no:translator.getTranslated("Não")},translate:!1}).show().click("yes",()=>{e.fadeOut(function(){e.remove()}),$.post("back_glad.php",{action:"DELETE",id:e.data("id")}).done(function(e){$("#glads-container .glad-preview").last().after("<div class='glad-add'><div class='image'></div><div class='info'>Clique para criar um novo gladiador</div></div>"),$("#glads-container .glad-add").first().click(function(){window.location.href="newglad"})})})}),$("#glads-container .glad-preview .code .button").eq(t).click(async function(){var e=$(this).parents(".glad-preview");if($(this).parents(".glad-preview").hasClass("old")){var a=$(this).parents(".info").find(".glad span").html();showDialog("A simulação da gladCode foi atualizada, e o código do gladiador <span class='highlight'>"+a+"</span> precisa ser testado e salvo novamente para que ele volte a participar das batalhas. Clique em <span class='highlight'>OK</span> para abrir o editor",["Cancelar","OK"]).then(function(a){"OK"==a&&window.open("glad-"+e.data("id"))})}else{if(e.data("blocks")){let a=decodeHTML(e.data("blocks"));$("body").append("<div id='fog'><div id='code-box'><div class='close'>X</div><div id='code-ws'></div><div id='button-container'><button id='editor' class='button'>Abrir no editor</button></div></div></div>");let t=Blockly.inject("code-ws",{scrollbars:!0,readOnly:!0});xmlDom=Blockly.Xml.textToDom(a),Blockly.Xml.domToWorkspace(xmlDom,t)}else{var t=e.data("code");let a="c";-1!=t.indexOf("def loop():")&&(a="python"),$("body").append(`<div id='fog'><div id='code-box'><div class='close'>X</div><pre class='line-numbers language-${a}'><code class='language-${a}'>${t}</code></pre><div id='button-container'><button id='editor' class='button'>Abrir no editor\n                                </button></div></div></div>`),Prism.highlightElement($("code")[0])}translator.translate(["Abrir no editor"]).then(e=>{$("#fog #code-box button").html(e)}),$("#fog").click(function(){$(this).remove()}),$("#code-box").click(function(e){e.stopPropagation()}),$("#code-box .close").click(function(e){$("#fog").click()}),$("#editor").click(function(){window.open("glad-"+e.data("id")),$("#fog").click()})}})}),t=1,n=10,i=6;$("#glads-container .glad-add").remove()
;for(var s=e.length;s<i;s++)if($("#glads-container .glad-card-container").append("<div class='glad-add'><div class='image'></div><div class='info'></div></div>"),s<t+Math.floor(user.lvl/n))$("#glads-container .glad-add .info").last().html("Clique para criar um novo gladiador"),$("#glads-container .glad-add").last().click(function(){window.location.href="newglad"});else{var o=(s-t+1)*n;$("#glads-container .glad-add .info").last().html("Atinja o nível "+o+" de mestre para desbloquear este gladiador"),$("#glads-container .glad-add").last().addClass("inactive")}translator.translate($("#glads-container .glad-card-container .glad-add"))})}),$("#menu #battle").click(function(){$("#match-find").prop("disabled",!0),$(this).hasClass("disabled")||$.post("back_glad.php",{action:"GET"}).done(function(e){e=JSON.parse(e);var a=$("<div id='template'></div>").load("glad-card-template.html",async function(){for(var t in $("#battle-container .glad-preview").remove(),e)$("#battle-container .glad-card-container").append("<div class='glad-preview'></div>");$("#battle-container .glad-card-container .glad-preview").html(a);let n=await translator.translate([$(".glad-card-container"),"Renome"]);for(var t in e)setGladImage($("#battle-container"),t,e[t].skin),$("#battle-container .glad-preview .info .glad span").eq(t).html(e[t].name),$("#battle-container .glad-preview .info .attr .str span").eq(t).html(e[t].vstr),$("#battle-container .glad-preview .info .attr .agi span").eq(t).html(e[t].vagi),$("#battle-container .glad-preview .info .attr .int span").eq(t).html(e[t].vint),$("#battle-container .glad-preview").eq(t).data("id",e[t].id),$("#battle-container .glad-preview").eq(t).data("code",e[t].code),$("#battle-container .glad-preview").eq(t).data("name",e[t].name),$("#battle-container .glad-preview").eq(t).data("skin",e[t].skin),$("#battle-container .glad-preview").eq(t).data("user",e[t].user),$("#battle-container .glad-preview").eq(t).data("vstr",e[t].vstr),$("#battle-container .glad-preview").eq(t).data("vagi",e[t].vagi),$("#battle-container .glad-preview").eq(t).data("vint",e[t].vint),$("#battle-container .glad-preview").eq(t).data("mmr",e[t].mmr),$("#battle-container .glad-preview .info .master").eq(t).after(`<div class='row mmr' title='${n}'><span>${parseInt(e[t].mmr)}</span><img src='icon/winner-icon.png'></div>`),e[t].oldversion&&$("#battle-container .glad-preview").eq(t).addClass("old");$(".glad-preview .delete").remove(),$(".glad-preview .code").remove(),$("#battle-container .glad-preview").click(function(){var e=$(this);$(this).hasClass("old")?showDialog("Este gladiador precisa ser atualizado. Deseja abri-lo no editor?",["Sim","Não"]).then(function(a){"Sim"==a&&window.open(`glad-${e.data("id")}`)}):($("#battle-container .glad-preview").removeClass("selected"),$(this).addClass("selected"),$("#match-find").removeAttr("disabled"))})})}),check_challenges()}),$("#panel #battle-mode .button").click(function(){$("#panel #battle-mode .button").removeClass("selected"),$(this).addClass("selected")}),$("#panel #battle-mode #ranked.button").click(function(){$("#panel #battle-container .wrapper").hide();var e=$("#panel #battle-container #ranked.wrapper");"none"==e.css("display")&&e.fadeIn()}),$("#panel #battle-mode #duel.button").click(function(){$("#panel #battle-container .wrapper").hide();var e=$("#panel #battle-container #duel.wrapper");"none"==e.css("display")&&e.fadeIn()}),$("#panel #duel.wrapper .input").on("input",function(){var a=$("#panel #duel.wrapper .input").val();e(a)}),e(""),$("#panel #duel.wrapper #challenge").click(function(){var e=$("#panel #duel.wrapper #table-friends .row.selected").data("user"),a=$("#panel #duel.wrapper #table-friends .row.selected .cell.nick").text();n(a,e)}),$("#panel #battle-mode #tourn.button").click(async function(){$("#panel #battle-container .wrapper").hide();var e=$("#panel #battle-container #tourn.wrapper");"none"==e.css("display")&&e.fadeIn(),refresh_tourn_list()}),$("#panel #battle-mode #train.button").click(function(){$("#panel #battle-container .wrapper").hide();var e=$("#panel #battle-container #train.wrapper");"none"==e.css("display")&&e.fadeIn(),trainList.refresh()}),$("#subtab").length){let e=$("#subtab").html();$("#subtab").remove(),$(`#panel #battle-mode #${e}.button`).click()}$.post("back_glad.php",{action:"GET"}).done(function(e){0==JSON.parse(e).length&&$("#menu #battle").addClass("disabled")}),$("#battle-container #match-find").click(async function(){var e=new progressButton($(this),await translator.translate(["Executando batalha...","Aguardando resposta do servidor"])),a=$("#battle-container .glad-preview.selected"),t={id:a.data("id"),name:a.data("name"),skin:a.data("skin"),code:a.data("code"),user:a.data("user"),vstr:a.data("vstr"),vagi:a.data("vagi"),vint:a.data("vint"),mmr:a.data("mmr")};let n={lvl:user.lvl,xp:{value:parseFloat(user.xp),total:getXpToNextLvl()},silver:user.silver,mmr:t.mmr,glad:t.id};$.post("back_match.php",{action:"MATCH",id:t.id}).done(function(a){var i,s=JSON.parse(a);s.push(t),preBattleShow(s).then(e=>i=e),new Simulation({ranked:!0,origin:"ranked",terminal:!0}).run().then(function(a){if(a.error)e.kill(),window.location.reload();else{let t=a.simulation;save_stats(t),clearInterval(i),e.kill(),$("#fog").remove(),$("#menu #battle").click(),afterBattleShow(t,n)}})})});var o=1;$("#message-panel #prev").click(function(){o--,a()}),$("#message-panel #next").click(function(){o++,a()}),$("#menu #messages").click(function(){a()}),$("#friend-panel #request, #friend-panel #friends").addClass("hidden"),$("#menu #friends").click(function(){$.post("back_friends.php",{action:"GET"}).done(async function(e){for(var a in e=JSON.parse(e),e.pending.length>0&&$("#friend-panel #request").removeClass("hidden"),e.confirmed.length>0&&$("#friend-panel #friends").removeClass("hidden"),$("#friend-panel #request .table").html(""),e.pending){var n=e.pending[a].nick,i=e.pending[a].id,s=e.pending[a].picture,o=e.pending[a].lvl;$("#friend-panel #request .table").append(`<div class='row'>\n                    <div class='cell lvl-container'>\n                        <img title='Nível' src='res/star.png'><span>${o}</span>\n                    </div>\n                    <div class='cell image-container'>\n                        <img src='${s}'>\n                    </div>\n                    <div class='cell user'>${n}</div>\n                    <div class='button-container'>\n                        <div class='check' title='${translator.getTranslated("Aceitar solicitação",dom=!1)}'></div>\n                        <div class='close' title='${translator.getTranslated("Recusar solicitação",dom=!1)}'></div>\n                    </div>\n                </div>`),$("#friend-panel #request .table .row").last().data("id",i)}for(var a in $("#friend-panel #friends .table").html(""),e.confirmed){n=e.confirmed[a].nick;var l=e.confirmed[a].user,r=(o=e.confirmed[a].lvl,i=e.confirmed[a].id,s=e.confirmed[a].picture,last_active_string(e.confirmed[a].active));$("#friend-panel #friends .table").append(`<div class='row'>\n                    <div class='cell lvl-container'>\n                        <img title='Nível' src='res/star.png'><span>${o}</span>\n                    </div>\n                    <div class='cell image-container'>\n                        <img src='${s}'>\n                    </div>\n                    <div class='cell'>${n}</div>\n                    <div class='cell last-active'>\n                        <span class='label'>${translator.getTranslated("Última atividade")}</span>\n                        <span>${r}</span>\n                    </div>\n                    <div class='button-open'></div>\n                </div>`),$("#friend-panel #friends .table .row").last().data({id:i,user:l,nick:n})}$("#friend-panel .check, #friend-panel .close").click(function(){var e="NO";$(this).hasClass("check")&&(e="YES"),$.post("back_friends.php",{action:"REQUEST",answer:e,id:$(this).parents(".row").data("id")}).done(function(e){$("#menu #friends").click()})}),$("#friend-panel #friends .button-open").click(function(){t();var e=$(this);$("#friend-panel #friends .button-open").removeClass("open"),$(this).addClass("open");var a=$("#friend-panel #friends .options");a.css({top:e.position().top,left:e.position().left+e.width()}).hide().animate({height:"toggle",width:"toggle",left:e.position().left-a.width()+e.width()},500,function(){a.addClass("open")})})})}),$(window).click(function(e){var a=$("#friend-panel #friends .options");a.hasClass("open")&&t()}),$("#friend-panel #friends .unfriend").click(function(){var e=$("#friend-panel #friends .button-open.open"),a=e.parents(".row"),t=e.parents(".row").data("id"),n=e.parents(".row").data("nick");new Message({message:`Deseja remover <b>${n}</b> da sua lista de amigos?`,buttons:{yes:"Sim",no:"Não"}}).show().click("yes",()=>{post("back_friends.php",{action:"DELETE",user:t}).then(e=>{a.remove()})})}),$("#friend-panel #friends .message").click(function(){var e=$("#friend-panel #friends .button-open.open");i(e)}),$("#friend-panel #friends .duel").click(function(){var e=$("#friend-panel #friends .button-open.open"),a=e.parents(".row").data("nick"),t=e.parents(".row").data("user");n(a,t)}),$("#friend-panel input").on("input",function(){var e=$(this).val();$.post("back_friends.php",{action:"SEARCH",text:e}).done(function(e){for(var a in e=JSON.parse(e),$("#friend-panel #search .table").html(""),e){var t=e[a].nick,n=e[a].user,s=e[a].email;$("#friend-panel #search .table").append(`<div class='row'>\n                    <div class='cell'>${t}</div>\n                    <div class='cell button-container'>\n                        <div class='send-message' title='${translator.getTranslated("Enviar mensagem",dom=!1)}'></div>\n                        <div class='add-friend' title='${translator.getTranslated("Enviar convite de amizade",dom=!1)}'></div>\n                    </div>\n                </div>`),$("#friend-panel #search .table .row").last().data({user:n,nick:t,email:s})}$("#friend-panel #search .add-friend").click(function(){var e=$(this).parents(".row").data("nick"),a=$(this).parents(".row").data("email"),t=$(this).parents(".row").data("user");$.post("back_friends.php",{action:"ADD",user:t}).done(function(t){"EXISTS"==t?new Message({message:`O usuário <b>${e}</b> já está em sua lista de amigos`}).show():(new Message({message:`Convite enviado para <b>${e}</b>`}).show(),$.post("back_sendmail.php",{action:"FRIEND",friend:a}).done(function(e){}))})}),$("#friend-panel #search .send-message").click(function(){i($(this))})})}),$("#menu #logout").click(function(){googleLogout().then(function(){window.location.href="index"})}),$("#img-preview-container").hide(),$("#img-upload").dropzone({url:"#",acceptedFiles:"image/*",previewTemplate:"<div class='dz-preview'></div>",accept:function(e,a){a()},init:function(){this.on("addedfile",function(e){$(".dz-preview").remove(),$("#img-preview-container").append($(e.previewElement)),$("#img-preview-container").fadeIn()})},success:function(e,a){var t=new Image;t.src=e.dataURL,t.onload=function(){$(".dz-preview").html(`<button id='crop-image' class='button'>RECORTAR IMAGEM</button><img src='${t.src}'>`),translator.translate($(".dz-preview"));var e=new Croppie($(".dz-preview img")[0],{viewport:{width:150,height:150},boundary:{width:300,height:300}});$(".cr-slider").addClass("slider"),$("#crop-image").on("click",function(){e.result("base64").then(function(e){$("#img-upload").css({"background-image":"url("+e+")","background-size":"cover"}),user.foto=e,$("#img-preview-container").hide()})})}},error:function(e,a){},removedfile:function(e){},complete:function(e){}}),init_chat($("#chat-panel"),{full:!1})});class valueAnimator{constructor(e){this.time=e.time?e.time:1e3,this.steps=e.steps?e.steps:100,this.start=e.start?parseFloat(e.start):0,this.end=e.end?parseFloat(e.end):0,this.value=this.start,this.onStep=e.onStep?e.onStep:null}run(){return new Promise((e,a)=>{function t(a,n,i){let s=new Date;setTimeout(()=>{a.value+=i,a.onStep&&a.onStep(a.value),a.value<a.end&&a.start<a.end||a.value>a.end&&a.start>a.end?t(a,n,i):e(!0)},n-(new Date-s))}let n=this.time/this.steps,i=(this.end-this.start)/this.steps;t(this,n,i)})}}