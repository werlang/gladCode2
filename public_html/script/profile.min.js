var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,d,f){b instanceof String&&(b=String(b));for(var g=b.length,l=0;l<g;l++){var u=b[l];if(d.call(f,u,l,b))return{i:l,v:u}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,d,f){b!=Array.prototype&&b!=Object.prototype&&(b[d]=f.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,d,f,g){if(d){f=$jscomp.global;b=b.split(".");for(g=0;g<b.length-1;g++){var l=b[g];l in f||(f[l]={});f=f[l]}b=b[b.length-1];g=f[b];d=d(g);d!=g&&null!=d&&$jscomp.defineProperty(f,b,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,f){return $jscomp.findInternal(this,b,f).v}},"es6","es3");var user;
$(document).ready(function(){function b(){$.post("back_notification.php",{}).done(function(a){try{a=JSON.parse(a)}catch(x){console.log(x);var e=x}if(!e){$("#profile-ui #lvl span").html(a.user.lvl);e=130*(4.5*parseInt(a.user.lvl)-2);var h=parseInt(a.user.xp);$("#profile-ui #xp #filled").width(h/e*100+"%");$("#messages .notification").html(a.messages);0==parseInt(a.messages)?$("#messages .notification").addClass("empty"):$("#messages .notification").removeClass("empty");e=parseInt(a.friends);$("#friends .notification").html(e);
0==e?$("#friends .notification").addClass("empty"):$("#friends .notification").removeClass("empty");e=parseInt(a.glads.remaining);h=parseInt(a.glads.obsolete);$("#glads .notification").html(e+h);0==e+h?$("#glads .notification").addClass("empty"):$("#glads .notification").removeClass("empty");a=parseInt(a.reports)+parseInt(a.duels);10<=a?$("#battle .notification").html("..."):$("#battle .notification").html(a);0==a?$("#battle .notification").addClass("empty"):$("#battle .notification").removeClass("empty")}setTimeout(function(){b()},
1E4)})}function d(){function a(){$("#battle-container #page-title span").eq(0).html(e);$("#battle-container #page-title span").eq(1).html(h);$("#battle-container #page-title span").eq(2).html(b);1==e?$("#battle-container #prev").prop("disabled",!0):$("#battle-container #prev").removeProp("disabled");h==b?$("#battle-container #next").prop("disabled",!0):$("#battle-container #next").removeProp("disabled")}var e,h,b;"Batalhas"==$("#bhist-container .tab.selected").html()?$.post("back_report.php",{action:"GET",
read:!0,page:m.battles}).done(function(c){try{c=JSON.parse(c)}catch(v){var p=v}if(p||0==c.length)$("#bhist-container").hide();else{e=c.start;h=c.end;b=c.total;c=c.reports;a();$("#bhist-container .table").html("<div class='row head'><div class='cell'>Gladiador</div><div class='cell reward'>Renome</div><div class='cell time'>Data</div></div>");for(var k in c)$("#bhist-container .table").append("<div class='row'><div class='cell glad'>"+c[k].gladiator+"</div><div class='cell reward'>"+parseFloat(c[k].reward).toFixed(1)+
"</div><div class='cell time' title='"+getMessageTime(c[k].time,!0)+"'>"+getMessageTime(c[k].time)+"</div><div class='playback' title='Visualizar batalha'><a target='_blank' href='play/"+c[k].hash+"'><img src='icon/eye.png'></a></div></div>"),"0"==c[k].isread?$("#bhist-container .table .row").last().addClass("unread"):$("#bhist-container .table .row").last().removeClass("unread"),0>c[k].reward?$("#bhist-container .table .reward").last().addClass("red"):0<c[k].reward&&(p=$("#bhist-container .table .reward").last(),
p.addClass("green"),p.html("+"+p.html()))}}):"Duelos"==$("#bhist-container .tab.selected").html()&&$.post("back_duel.php",{action:"REPORT",page:m.duels}).done(function(c){try{c=JSON.parse(c)}catch(v){console.log(v);var p=v}if(p||0==c.length)$("#bhist-container").hide();else{e=c.start;h=c.end;b=c.total;a();c=c.output;$("#bhist-container .table").html("<div class='row head'><div class='cell'>Gladiador</div><div class='cell'>Oponente</div><div class='cell'>Mestre</div><div class='cell time'>Data</div></div>");
for(var k in c)$("#bhist-container .table").append("<div class='row'><div class='cell glad'>"+c[k].glad+"</div><div class='cell enemy'>"+c[k].enemy+"</div><div class='cell'>"+c[k].user+"</div><div class='cell time' title='"+getMessageTime(c[k].time,!0)+"'>"+getMessageTime(c[k].time)+"</div><div class='playback' title='Visualizar batalha'><a target='_blank' href='play/"+c[k].log+"'><img src='icon/eye.png'></a></div></div>"),"0"==c[k].isread?$("#bhist-container .table .row").last().addClass("unread"):
$("#bhist-container .table .row").last().removeClass("unread"),null==c[k].glad&&$("#bhist-container .table .row .glad").last().html("Gladiador Esquecido").addClass("forgotten"),null==c[k].enemy&&(null==c[k].log?($("#bhist-container .table .row .enemy").last().html("???"),$("#bhist-container .table .row").last().find(".playback").remove(),$("#bhist-container .table .row").last().append("<div class='remove' title='Cancelar desafio'>X</div>"),$("#bhist-container .table .row").last().find(".remove").data("id",
c[k].id).click(function(){var a=$(this).data("id");$.post("back_duel.php",{action:"DELETE",id:a}).done(function(a){showMessage("Desafio cancelado");d()})})):$("#bhist-container .table .row .enemy").last().html("Gladiador Esquecido").addClass("forgotten"))}})}function f(){$.post("back_rank.php",{page:n,search:w}).done(function(a){try{a=JSON.parse(a)}catch(v){console.log(v)}$("#ranking-container .table").html("<div class='row head'><div class='cell position'></div><div class='cell'>Gladiador</div><div class='cell'>Mestre</div><div class='cell mmr'>Renome</div></div>");
var e=a.start,h=a.end,b=a.total;n=a.page;a=a.glads;for(var c in a){var p=a[c].rank,k="";1==p?k="gold":2==p?k="silver":3==p&&(k="bronze");$("#ranking-container .table").append("<div class='row "+k+"'><div class='cell position'>"+p+"\u00ba</div><div class='cell'>"+a[c].glad+"</div><div class='cell'>"+a[c].user+"</div><div class='cell mmr'><span class='change24'>"+Math.abs(parseInt(a[c].change24))+"</span>"+parseInt(a[c].mmr)+"</div></div>");user.apelido==a[c].user&&$("#ranking-container .table .row").last().addClass("mine");
0<parseInt(a[c].change24)?($("#ranking-container .table .mmr .change24").last().addClass("green"),$("#ranking-container .table .mmr .change24").last().prepend("<img src='icon/arrow-up-green.png'>")):0>parseInt(a[c].change24)&&($("#ranking-container .table .mmr .change24").last().addClass("red"),$("#ranking-container .table .mmr .change24").last().prepend("<img src='icon/arrow-up-green.png'>"))}$("#ranking-container #page-title span").eq(0).html(e);$("#ranking-container #page-title span").eq(1).html(h);
$("#ranking-container #page-title span").eq(2).html(b);1==e?$("#ranking-container #prev").prop("disabled",!0):$("#ranking-container #prev").removeProp("disabled");h==b?$("#ranking-container #next").prop("disabled",!0):$("#ranking-container #next").removeProp("disabled")})}function g(){$("#message-panel #full-message").remove();$("#message-panel .table").show();$.post("back_message.php",{action:"GET",page:q}).done(function(a){try{a=JSON.parse(a)}catch(x){console.log(x)}var e=a.meta;a=a.info;$("#message-panel #page-title span").eq(0).html(e.start);
$("#message-panel #page-title span").eq(1).html(e.end);$("#message-panel #page-title span").eq(2).html(e.total);1==e.page?$("#message-panel #prev").prop("disabled",!0):$("#message-panel #prev").removeProp("disabled");e.end==e.total?$("#message-panel #next").prop("disabled",!0):$("#message-panel #next").removeProp("disabled");$("#message-panel .table").html("");for(var h in a)$("#message-panel .table").append("<div class='row'><div class='cell user'>"+a[h].nick+"</div><div class='cell message'>"+a[h].message+
"</div><div class='cell time'>"+getMessageTime(a[h].time)+"</div></div>"),"0"==a[h].isread&&$("#message-panel .table .row").last().addClass("unread");$("#message-panel .table .row").click(function(){var e=$("#message-panel .table .row").index($(this)),c=a[e].id,h=a[e].message,b=getMessageTime(a[e].time,!0),d=a[e].nick;e=a[e].picture;$("#message-panel").append("<div id='full-message'><div class='row head'><div class='image'><img src='"+e+"'></div><div class='user'>"+d+"</div><div class='time'>"+b+
"</div></div><div class='row body'><div class='message'>"+h+"</div></div><div class='row buttons'><button class='button' id='back'><img src='icon/back.png'><span>Retornar</span></button><button class='button' id='reply'><img src='icon/reply.png'><span>Responder</span></button><button class='button' id='unread'><img src='icon/unread.png'><span>Marcar n\u00e3o lido</span></button><button class='button' id='delete'><img src='icon/delete2.png'><span>Excluir</span></button></div></div>");$("#message-panel #full-message").hide();
$("#message-panel .table").fadeOut(function(){$("#message-panel #full-message").toggle("scale")});$.post("back_message.php",{action:"READ",id:c,value:1});$("#message-panel #back").click(function(){$("#menu #messages").click()});$("#message-panel #reply").click(function(){$("#message-panel #full-message .row.buttons").hide();$("#message-panel #full-message").append("<div class='row reply'><textarea class='input'></textarea><div class='row buttons'><button class='button' id='send'><img src='icon/reply.png'><span>Enviar</span></button><button class='button' id='cancel'><img src='icon/delete2.png'><span>Descartar</span></button></div></div>");
$("#message-panel #full-message .reply").hide().fadeIn();$("#message-panel #full-message .input").focus();$("#message-panel #full-message .input").on("input",function(){var a=this.offsetHeight-this.clientHeight;300<=$(this).height()?$(this).height(300):$(this).css("height","auto").css("height",this.scrollHeight+a)});$("#message-panel #full-message #send").click(function(){var a=$("#message-panel #full-message .input").val();$.post("back_message.php",{action:"REPLY",replyid:c,message:a}).done(function(){$("#menu #messages").click();
$.post("back_sendmail.php",{action:"MESSAGE",replyid:c,message:a}).done(function(a){})})});$("#message-panel #full-message #cancel").click(function(){$("#message-panel #full-message .row.reply").remove();$("#message-panel #full-message .row.buttons").show()})});$("#message-panel #unread").click(function(){$.post("back_message.php",{action:"READ",id:c,value:0}).done(function(){$("#menu #messages").click()})});$("#message-panel #delete").click(function(){$.post("back_message.php",{action:"DELETE",id:c}).done(function(){$("#menu #messages").click()})})})})}
function l(){var a=$("#friend-panel #friends .button-open.open"),e=$("#friend-panel #friends .options");e.removeClass("open");a.removeClass("open");e.removeProp("style")}function u(a){var e=a.parents(".row").data("user");a=a.parents(".row").data("nick");showTextArea("Mensagem para <span class='highlight'>"+a+"</span>:","Ol\u00e1...",2048).then(function(a){a&&$.post("back_message.php",{action:"SEND",id:e,message:a}).done(function(h){showMessage("Mensagem enviada");$.post("back_sendmail.php",{action:"MESSAGE",
receiver:e,message:a}).done(function(a){console.log(a)})})})}$("#header-container").addClass("small-profile");$("#header-profile").addClass("here");fill_assets();var r=["friend","message","update","duel"];$.post("back_login.php",{action:"GET"}).done(function(a){user=JSON.parse(a);$("#tab").length?(a=$("#tab").html(),$("#"+a).click(),$("#tab").remove()):$("#menu #profile").click();$("#profile-ui #picture img").attr("src",user.foto);$("#profile-ui #nickname").html(user.apelido);b();$.post("back_glad.php",
{action:"GET"}).done(function(a){0==JSON.parse(a).length&&showDialog("Voc\u00ea ainda n\u00e3o possui nenhum gladiador cadastrado. Deseja ir para o editor de gladiadores?",["Sim","N\u00e3o, obrigado"]).then(function(a){"Sim"==a&&(window.location.href="editor")})})});$("#menu .item").click(function(){if(!$(this).hasClass("disabled")){var a=$(this);$("#panel .content").removeClass("open");$.each($("#panel").find(".content"),function(){$(this).data("menu")==a.attr("id")&&$(this).addClass("open")});$("#menu .item").removeClass("here");
$(this).addClass("here")}});$("#menu #profile").click(function(){$("#nickname .input").val(user.apelido);for(var a in r)"1"==user.preferences[r[a]]&&$("#email #pref-"+r[a]+" input.checkslider").prop("checked",!0)});$("#profile-panel .button").click(function(){$("#profile-panel .button").prop("disabled",!0);for(var a in r)$("#email #pref-"+r[a]+" input.checkslider").prop("checked")?user.preferences[r[a]]="1":user.preferences[r[a]]="0";$.post("back_login.php",{action:"UPDATE",nickname:$("#nickname .input").val(),
picture:user.foto,preferences:JSON.stringify(user.preferences)}).done(function(a){"DONE"==a?(showMessage("Informa\u00e7\u00f5es atualizadas"),$("#profile-panel .button").removeProp("disabled"),user.apelido=$("#nickname .input").val(),$("#profile-ui #nickname").html(user.apelido),$("#profile-ui #picture img").attr("src",user.foto)):"EXISTS"==a&&(showMessage("Outro usu\u00e1rio j\u00e1 escolheu este nome").then(function(){$("#nickname .input").focus().select()}),$("#profile-panel .button").removeProp("disabled"))})});
$("#menu #glads").click(function(){$.post("back_glad.php",{action:"GET"}).done(function(a){a=JSON.parse(a);var e=$("<div id='template'></div>").load("glad-card-template.html",function(){$("#glads-container .glad-preview").remove();0<a.length&&$("#menu #battle").removeClass("disabled");for(var c in a)$("#glads-container .glad-card-container").append("<div class='glad-preview'></div>");$("#glads-container .glad-card-container .glad-preview").html(e);for(c in a)setGladImage($("#glads-container"),c,a[c].skin),
$("#glads-container .glad-preview .info .glad span").eq(c).html(a[c].name),$("#glads-container .glad-preview .info .attr .str span").eq(c).html(a[c].vstr),$("#glads-container .glad-preview .info .attr .agi span").eq(c).html(a[c].vagi),$("#glads-container .glad-preview .info .attr .int span").eq(c).html(a[c].vint),$("#glads-container .glad-preview").eq(c).data("id",a[c].id),$("#glads-container .glad-preview").eq(c).data("code",a[c].code),a[c].oldversion&&($("#glads-container .glad-preview").eq(c).addClass("old"),
$("#glads-container .glad-preview .code .button").eq(c).html("{'atualizar'}")),$("#glads-container .glad-preview .delete").eq(c).click(function(){var a=$(this).parents(".glad-preview");showDialog("Deseja excluir o gladiador <span class='highlight'>"+a.find(".glad span").html()+"</span>?",["Sim","N\u00e3o"]).then(function(c){"Sim"==c&&(a.fadeOut(function(){a.remove()}),$.post("back_glad.php",{action:"DELETE",id:a.data("id")}).done(function(a){$("#glads-container .glad-preview").last().after("<div class='glad-add'><div class='image'></div><div class='info'>Clique para criar um novo gladiador</div></div>");
$("#glads-container .glad-add").first().click(function(){window.location.href="editor"})}))})}),$("#glads-container .glad-preview .code .button").eq(c).click(function(){var a=$(this).parents(".glad-preview");if($(this).parents(".glad-preview").hasClass("old")){var c=$(this).parents(".info").find(".glad span").html();showDialog("A simula\u00e7\u00e3o da gladCode foi atualizada, e o c\u00f3digo do gladiador <span class='highlight'>"+c+"</span> precisa ser testado e salvo novamente para que ele volte a participar das batalhas. Clique no bot\u00e3o para abrir o editor",
["Cancelar","OK"]).then(function(c){"OK"==c&&window.open("glad-"+a.data("id"))})}else c=a.data("code"),$("body").append("<div id='fog'><div id='code-box'><div class='close'>X</div><pre class='line-numbers language-c'><code class='language-c'>"+c+"</code></pre><div id='button-container'><button id='editor' class='button'>Abrir no editor</button></div></div></div>"),Prism.highlightElement($("code")[0]),$("#fog").click(function(){$(this).remove()}),$("#code-box").click(function(a){a.stopPropagation()}),
$("#code-box .close").click(function(a){$("#fog").click()}),$("#editor").click(function(){window.open("glad-"+a.data("id"));$("#fog").click()})})});$("#glads-container .glad-add").remove();for(var h=a.length;6>h;h++)if($("#glads-container .glad-card-container").append("<div class='glad-add'><div class='image'></div><div class='info'></div></div>"),h<1+Math.floor(user.lvl/10))$("#glads-container .glad-add .info").last().html("Clique para criar um novo gladiador"),$("#glads-container .glad-add").last().click(function(){window.location.href=
"editor"});else{var b=10*(h-1+1);$("#glads-container .glad-add .info").last().html("Atinja o n\u00edvel "+b+" de mestre para desbloquear este gladiador");$("#glads-container .glad-add").last().addClass("inactive")}})});$("#battle-container .tab").click(function(){$("#battle-container .tab").removeClass("selected");$(this).addClass("selected");d()});var m={battles:1,duels:1,favorites:1};$("#battle-container #prev").click(function(){"Batalhas"==$("#bhist-container .tab.selected").html()?m.battles--:
"Duelos"==$("#bhist-container .tab.selected").html()&&m.duels--;d()});$("#battle-container #next").click(function(){"Batalhas"==$("#bhist-container .tab.selected").html()?m.battles++:"Duelos"==$("#bhist-container .tab.selected").html()&&m.duels++;d()});$("#menu #battle").click(function(){$("#match-find").prop("disabled",!0);$(this).hasClass("disabled")||($.post("back_glad.php",{action:"GET"}).done(function(a){a=JSON.parse(a);var e=$("<div id='template'></div>").load("glad-card-template.html",function(){$("#battle-container .glad-preview").remove();
for(var b in a)$("#battle-container .glad-card-container").append("<div class='glad-preview'></div>");$("#battle-container .glad-card-container .glad-preview").html(e);for(b in a)setGladImage($("#battle-container"),b,a[b].skin),$("#battle-container .glad-preview .info .glad span").eq(b).html(a[b].name),$("#battle-container .glad-preview .info .attr .str span").eq(b).html(a[b].vstr),$("#battle-container .glad-preview .info .attr .agi span").eq(b).html(a[b].vagi),$("#battle-container .glad-preview .info .attr .int span").eq(b).html(a[b].vint),
$("#battle-container .glad-preview").eq(b).data("id",a[b].id),$("#battle-container .glad-preview").eq(b).data("code",a[b].code),$("#battle-container .glad-preview").eq(b).data("name",a[b].name),$("#battle-container .glad-preview").eq(b).data("skin",a[b].skin),$("#battle-container .glad-preview").eq(b).data("user",a[b].user),$("#battle-container .glad-preview").eq(b).data("vstr",a[b].vstr),$("#battle-container .glad-preview").eq(b).data("vagi",a[b].vagi),$("#battle-container .glad-preview").eq(b).data("vint",
a[b].vint),$("#battle-container .glad-preview").eq(b).data("mmr",a[b].mmr),$("#battle-container .glad-preview .info .glad").eq(b).after("<div class='row mmr' title='Renome'><span>"+parseInt(a[b].mmr)+"</span><img src='icon/winner-icon.png'></div>"),a[b].oldversion&&$("#battle-container .glad-preview").eq(b).addClass("old");$(".glad-preview .delete").remove();$(".glad-preview .code").remove();$("#battle-container .glad-preview").click(function(){$(this).hasClass("old")||($("#battle-container .glad-preview").removeClass("selected"),
$(this).addClass("selected"),$("#match-find").removeProp("disabled"))})})}),d());$.post("back_duel.php",{action:"GET"}).done(function(a){a=JSON.parse(a);$("#duel-challenge").addClass("hidden");1<=a.length&&$("#duel-challenge").removeClass("hidden");$("#duel-challenge .table").html("");for(var b in a){var h=a[b].nick,d=a[b].time,c=a[b].lvl,p=a[b].picture;$("#duel-challenge .table").append("<div class='row'><div class='cell lvl-container'><img src='res/star.png' title='N\u00edvel'><span>"+c+"</span></div><div class='cell image-container'><img src='"+
p+"'></div><div class='cell user'>"+h+"</div><div class='cell time' title='"+getMessageTime(d,!0)+"'>"+getMessageTime(d,!1)+"</div><div class='button-container'><div class='accept' title='Aceitar desafio'></div><div class='refuse' title='Recusar desafio'></div></div></div>");$("#duel-challenge .table .row").last().data("id",a[b].id)}$("#duel-challenge .table .refuse").click(function(){var a=$(this).parents(".row"),b=a.data("id");$.post("back_duel.php",{action:"DELETE",id:b}).done(function(b){"OK"==
b&&(a.remove(),0==$("#duel-challenge .table .row").length&&$("#duel-challenge").addClass("hidden"))})});$("#duel-challenge .table .accept").click(function(){var a=$(this).parents(".row"),b=a.find(".user").html(),c=a.data("id");a="<div id='fog'><div id='duel-box'><div id='title'>Escolha o gladiador que duelar\u00e1 contra <span class='highlight'>"+b+"</span> em nome da sua honra</div><div class='glad-card-container'></div><div id='button-container'><button id='cancel' class='button'>Cancelar</button><button id='duel' class='button' disabled>DUELAR</button></div></div></div>";
$("body").append(a);var e=$("<div id='template'></div>").load("glad-card-template.html",function(){});$.post("back_glad.php",{action:"GET"}).done(function(a){a=JSON.parse(a);for(var b in a)$("#fog .glad-card-container").append("<div class='glad-preview'></div>");$("#fog .glad-card-container .glad-preview").html(e);for(b in a)setGladImage($("#fog .glad-card-container"),b,a[b].skin),$("#fog .glad-preview .info .glad span").eq(b).html(a[b].name),$("#fog .glad-preview .info .attr .str span").eq(b).html(a[b].vstr),
$("#fog .glad-preview .info .attr .agi span").eq(b).html(a[b].vagi),$("#fog .glad-preview .info .attr .int span").eq(b).html(a[b].vint),$("#fog .glad-preview").eq(b).data("id",a[b].id);$("#fog .glad-preview .code .button").remove();$("#fog .glad-preview .delete-container").remove();$("#fog .glad-preview").click(function(){$("#fog #btn-glad-open").removeProp("disabled");$("#fog .glad-preview").removeClass("selected");$(this).addClass("selected");$("#duel-box #duel").removeProp("disabled")});$("#fog .glad-preview").dblclick(function(){$("#fog #duel-box #duel").click()})});
$("#fog #duel-box #duel").click(function(){var a=$("#fog .glad-preview.selected").data("id"),b=new progressButton($(this),["Executando batalha...","Aguardando resposta do servidor"]);runSimulation({duel:c,glads:a}).then(function(a){b.kill();$("#fog").remove();showMessage("Duelo conclu\u00eddo. Clique para visualizar a batalha.").then(function(){window.open("play/"+a)});$("#battle").click()})});$("#fog #duel-box #cancel").click(function(){$("#fog").remove()})})})});$.post("back_glad.php",{action:"GET"}).done(function(a){0==
JSON.parse(a).length&&$("#menu #battle").addClass("disabled")});$("#battle-container #match-find").click(function(){var a=new progressButton($(this),["Executando batalha...","Aguardando resposta do servidor"]),b=$("#battle-container .glad-preview.selected"),d={id:b.data("id"),name:b.data("name"),skin:b.data("skin"),code:b.data("code"),user:b.data("user"),vstr:b.data("vstr"),vagi:b.data("vagi"),vint:b.data("vint"),mmr:b.data("mmr")};$.post("back_match.php",{action:"MATCH",id:d.id}).done(function(b){b=
JSON.parse(b);b.push(d);var c=preBattleShow(b);runSimulation({ranked:!0}).then(function(b){"ERROR"!=b&&(save_stats(b),$("#pre-battle-show #tips").html("Batalha conclu\u00edda. Clique para visualizar"),clearInterval(c),$("#pre-battle-show").addClass("complete"),$("#pre-battle-show").click(function(){window.open("play/"+b);$("#fog").remove();$("#menu #battle").click()}));a.kill()})})});var n=1,w="";$("#ranking-container #prev").click(function(){n--;f()});$("#ranking-container #next").click(function(){n++;
f()});$("#menu #ranking").click(function(){f()});$("#ranking-container #search .input").on("input",function(a){w=$(this).val();n=1;f()});var q=1;$("#message-panel #prev").click(function(){q--;g()});$("#message-panel #next").click(function(){q++;g()});$("#menu #messages").click(function(){g()});$("#friend-panel #request, #friend-panel #friends").addClass("hidden");$("#menu #friends").click(function(){$.post("back_friends.php",{action:"GET"}).done(function(a){a=JSON.parse(a);0<a.pending.length&&$("#friend-panel #request").removeClass("hidden");
0<a.confirmed.length&&$("#friend-panel #friends").removeClass("hidden");$("#friend-panel #request .table").html("");for(var b in a.pending){var d=a.pending[b].nick,f=a.pending[b].id,c=a.pending[b].picture,p=a.pending[b].lvl;$("#friend-panel #request .table").append("<div class='row'><div class='cell lvl-container'><img title='N\u00edvel' src='res/star.png'><span>"+p+"</span></div><div class='cell image-container'><img src='"+c+"'></div><div class='cell user'>"+d+"</div><div class='button-container'><div class='check' title='Aceitar solicita\u00e7\u00e3o'></div><div class='close' title='Recusar solicita\u00e7\u00e3o'></div></div></div>");
$("#friend-panel #request .table .row").last().data("id",f)}$("#friend-panel #friends .table").html("");for(b in a.confirmed){d=a.confirmed[b].nick;var r=a.confirmed[b].user;p=a.confirmed[b].lvl;f=a.confirmed[b].id;c=a.confirmed[b].picture;var g=last_active_string(a.confirmed[b].active);$("#friend-panel #friends .table").append("<div class='row'><div class='cell lvl-container'><img title='N\u00edvel' src='res/star.png'><span>"+p+"</span></div><div class='cell image-container'><img src='"+c+"'></div><div class='cell'>"+
d+"</div><div class='cell last-active'><span class='label'>\u00daltima atividade</span><span>"+g+"</span></div><div class='button-open'></div></div>");$("#friend-panel #friends .table .row").last().data({id:f,user:r,nick:d})}$("#friend-panel .check, #friend-panel .close").click(function(){var a="NO";$(this).hasClass("check")&&(a="YES");$.post("back_friends.php",{action:"REQUEST",answer:a,id:$(this).parents(".row").data("id")}).done(function(a){$("#menu #friends").click()})});$("#friend-panel #friends .button-open").click(function(){l();
var a=$(this);$("#friend-panel #friends .button-open").removeClass("open");$(this).addClass("open");var b=$("#friend-panel #friends .options");b.css({top:a.position().top,left:a.position().left+a.width()}).hide().animate({height:"toggle",width:"toggle",left:a.position().left-b.width()+a.width()},500,function(){b.addClass("open")})})})});$(window).click(function(a){$("#friend-panel #friends .options").hasClass("open")&&l()});$("#friend-panel #friends .unfriend").click(function(){var a=$("#friend-panel #friends .button-open.open"),
b=a.parents(".row"),d=a.parents(".row").data("id");a=a.parents(".row").data("nick");showDialog("Deseja remover <span class='highlight'>"+a+"</span> da sua lista de amigos?",["Sim","N\u00e3o"]).then(function(a){"Sim"==a&&$.post("back_friends.php",{action:"DELETE",user:d}).done(function(a){b.remove()})})});$("#friend-panel #friends .message").click(function(){var a=$("#friend-panel #friends .button-open.open");u(a)});$("#friend-panel #friends .duel").click(function(){var a=$("#friend-panel #friends .button-open.open"),
b=a.parents(".row").data("nick"),d=a.parents(".row").data("user");a="<div id='fog'><div id='duel-box'><div id='title'>Escolha o gladiador que duelar\u00e1 contra <span class='highlight'>"+b+"</span> em nome da sua honra</div><div class='glad-card-container'></div><div id='button-container'><button id='cancel' class='button'>Cancelar</button><button id='invite' class='button' disabled>DESAFIAR</button></div></div></div>";$("body").append(a);var f=$("<div id='template'></div>").load("glad-card-template.html",
function(){});$.post("back_glad.php",{action:"GET"}).done(function(a){a=JSON.parse(a);for(var b in a)$("#fog .glad-card-container").append("<div class='glad-preview'></div>");$("#fog .glad-card-container .glad-preview").html(f);for(b in a)setGladImage($("#fog .glad-card-container"),b,a[b].skin),$("#fog .glad-preview .info .glad span").eq(b).html(a[b].name),$("#fog .glad-preview .info .attr .str span").eq(b).html(a[b].vstr),$("#fog .glad-preview .info .attr .agi span").eq(b).html(a[b].vagi),$("#fog .glad-preview .info .attr .int span").eq(b).html(a[b].vint),
$("#fog .glad-preview").eq(b).data("id",a[b].id);$("#fog .glad-preview .code .button").remove();$("#fog .glad-preview .delete-container").remove();$("#fog .glad-preview").click(function(){$("#fog #btn-glad-open").removeProp("disabled");$("#fog .glad-preview").removeClass("selected");$(this).addClass("selected");$("#duel-box #invite").removeProp("disabled")});$("#fog .glad-preview").dblclick(function(){$("#fog #duel-box #invite").click()})});$("#duel-box #cancel").click(function(){$("#fog").remove()});
$("#duel-box #invite").click(function(){var a=$("#fog .glad-preview.selected").data("id"),e=$("#fog .glad-preview.selected .info .glad span").html();$.post("back_duel.php",{action:"CHALLENGE",glad:a,friend:d}).done(function(a){$("#fog").remove();"EXISTS"==a?showMessage("J\u00e1 existe um desafio de duelo contra <span class='highlight'>"+b+"</span> usando o gladiador <span class='highlight'>"+e+"</span>."):"OK"==a?(showMessage("Desafio enviado para <span class='highlight'>"+b+"</span>. Assim que uma resposta for dada voc\u00ea ser\u00e1 notificado."),
$.post("back_sendmail.php",{action:"DUEL",friend:d}).done(function(a){})):console.log(a)})})});$("#friend-panel input").on("input",function(){var a=$(this).val();$.post("back_friends.php",{action:"SEARCH",text:a}).done(function(a){a=JSON.parse(a);$("#friend-panel #search .table").html("");for(var b in a){var e=a[b].nick,c=a[b].user;$("#friend-panel #search .table").append("<div class='row'><div class='cell'>"+e+"</div><div class='cell button-container'><div class='send-message' title='Enviar mensagem'></div><div class='add-friend' title='Enviar convite de amizade'></div></div></div>");
$("#friend-panel #search .table .row").last().data({user:c,nick:e})}$("#friend-panel #search .add-friend").click(function(){var a=$(this).parents(".row").data("nick"),b=$(this).parents(".row").data("user");$.post("back_friends.php",{action:"ADD",user:b}).done(function(c){"EXISTS"==c?showMessage("O usu\u00e1rio <span class='highlight'>"+a+"</span> j\u00e1 est\u00e9 em sua lista de amigos"):(showMessage("Convite enviado para <span class='highlight'>"+a+"</span>"),$.post("back_sendmail.php",{action:"FRIEND",
friend:b}).done(function(a){}))})});$("#friend-panel #search .send-message").click(function(){u($(this))})})});$("#menu #logout").click(function(){googleLogout().then(function(){window.location.href="index"})});$("#img-preview-container").hide();$("#img-upload").dropzone({url:"#",acceptedFiles:"image/*",previewTemplate:"<div class='dz-preview'></div>",accept:function(a,b){b()},init:function(){this.on("addedfile",function(a){$(".dz-preview").remove();$("#img-preview-container").append($(a.previewElement));
$("#img-preview-container").fadeIn()})},success:function(a,b){var e=new Image;e.src=a.dataURL;e.onload=function(){$(".dz-preview").html("<button id='crop-image' class='button'>RECORTAR IMAGEM</button><img src='"+e.src+"'>");var a=new Croppie($(".dz-preview img")[0],{viewport:{width:150,height:150},boundary:{width:300,height:300}});$(".cr-slider").addClass("slider");$("#crop-image").on("click",function(){a.result("base64").then(function(a){$("#img-upload").css({"background-image":"url("+a+")","background-size":"cover"});
user.foto=a;$("#img-preview-container").hide()})})}},error:function(a,b){},removedfile:function(a){},complete:function(a){}})});
function preBattleShow(b){$("#fog").remove();$("body").append("<div id='fog'><div id='pre-battle-show'><div class='glad-card-container'></div></div></div>");$("#fog").hide();for(var d in b)$("#pre-battle-show .glad-card-container").append("<div class='glad-preview'></div>");var f=$("<div id='template'></div>").load("glad-card-template.html",function(){$("#pre-battle-show .glad-card-container .glad-preview").html(f);for(var d in b)setGladImage($("#pre-battle-show"),d,b[d].skin),$("#pre-battle-show .glad-preview .info .glad span").eq(d).html(b[d].name),
$("#pre-battle-show .glad-preview .info .glad").eq(d).after("<div class='row user'><span>"+b[d].user+"</span></div>"),$("#pre-battle-show .glad-preview .info .user").eq(d).after("<div class='row mmr'><span>"+parseInt(b[d].mmr)+"</span><img src='icon/winner-icon.png'></div>"),$("#pre-battle-show .glad-preview .info .attr .str span").eq(d).html(b[d].vstr),$("#pre-battle-show .glad-preview .info .attr .agi span").eq(d).html(b[d].vagi),$("#pre-battle-show .glad-preview .info .attr .int span").eq(d).html(b[d].vint);
$("#pre-battle-show .glad-preview .delete-container").remove();$("#pre-battle-show .glad-preview .row.code").remove();$("#pre-battle-show").append("<div id='tips'><span></span></div><div id='progress'></div>");$("#pre-battle-show #tips").html(g[parseInt(Math.random()*g.length)]);$("#fog").fadeIn()}),g="Obrigado por fazer parte da vers\u00e3o beta da gladCode;Enquanto seu gladiador tiver menos de 1000 de renome, ele perder\u00e1 menos renome;Se voc\u00ea for o vencedor de uma batalha, seu gladiador ganhar\u00e1 muito renome;Mesmo quando perder uma batalha, o gladiador pode ganhar renome, dependendo do tempo que ficou vivo;Ser um dos primeiros a morrer \u00e9 a receita para perder grandes quantidades de renome;Se estiver enfrentando gladiadores mais fortes, o seu tende a ganhar mais renome;Gladiadores de renome semelhante s\u00e3o automaticamente selecionados para se enfrentar;Observe o comportamento de seus inimigos, e tente adaptar a l\u00f3gica do seu gladiador para derrot\u00e1-los;Quando voc\u00ea est\u00e1 offline, seus gladiadores podem ser desafiados. Eles podem subir ou descer no ranking;Voc\u00ea pode ver as \u00faltimas batalhas que seus gladiadores participaram no menu BATALHA;Voc\u00ea pode procurar por usu\u00e1rios ou enviar mensagens para seus amigos no menu AMIGOS;Participar de batalhas concede experi\u00eancia para o mestre, que lhe concede uma s\u00e9rie de benef\u00edcios;Est\u00e1 com d\u00favida em algo? pergunte na p\u00e1gina do facebook ou comunidade do reddit da gladCode;Seja um membro ativo da comunidade comentando e dando sua opini\u00e3o no facebook ou reddit;Assista o replay de suas batalhas, assim voc\u00ea entende melhor o comportamentos de seus gladiadores;A documenta\u00e7\u00e3o \u00e9 a melhor maneira de compreender como uma fun\u00e7\u00e3o funciona. Tem exemplos!;N\u00e3o entendeu algo sobre o funcionamento da gladCode? O manual da simula\u00e7\u00e3o est\u00e1 ali \u00e0 sua disposi\u00e7\u00e3o".split(";"),
l=0,u=setInterval(function(){var b=$("#battle-container #match-find").width();b=$("#battle-container #match-find #bar").width()/b;var d=$("#pre-battle-show").height()*b;$("#pre-battle-show #progress").css({height:d,"margin-top":-d});1<=b&&clearInterval(u);0==l/100%10&&(b=parseInt(Math.random()*g.length),$("#pre-battle-show #tips").html(g[b]));l++},10);return u}
function setGladImage(b,d,f){fetchSpritesheet(f).then(function(f){b.find(".glad-preview .image").eq(d).html(getSpriteThumb(f,"walk","down"))})}function getImage(b){for(var d in images)if(images[d].id==b)return images[d];return!1}
function getSpriteThumb(b,d,f){var g={walk:8,cast:0,thrust:4,slash:12,shoot:16,up:0,left:1,down:2,right:3};d=g[d]+g[f];f=document.createElement("canvas");f.setAttribute("width",64);f.setAttribute("height",64);f.getContext("2d").drawImage(b,64,192*d+64,64,64,0,0,64,64);return f}
function fetchSpritesheet(b){var d=$.Deferred(),f={walk:{sprites:9,line:8},cast:{sprites:7,line:0},thrust:{sprites:8,line:4},slash:{sprites:6,line:12},shoot:{sprites:13,line:16}},g=!1;try{b=JSON.parse(b)}catch(a){g=!0,b={}}var l=document.createElement("canvas");l.setAttribute("width",2496);l.setAttribute("height",4032);var u=l.getContext("2d"),r=0,m=[],n;for(n in b)getImage(b[n])&&m.push(getImage(b[n]));validate_skin(m)||(g=!0);if(g)q=new Image,q.src="res/glad.png",q.onload=function(){for(var a=0;21>
a;a++)for(var b=0;13>b;b++)u.drawImage(q,64*b,64*a,64,64,64+192*b,64+192*a,64,64);return d.resolve(l)};else{var w=function(){for(var a=0;a<m.length;a++)if(q[a])if(m[a].oversize)for(var b=f[m[a].move].line,d=f[m[a].move].sprites,g=0;4>g;g++)for(var c=0;c<d;c++)u.drawImage(q[a],192*c,192*g,192,192,192*c,192*b+192*g,192,192);else for(g=0;21>g;g++)for(c=0;13>c;c++)u.drawImage(q[a],64*c,64*g,64,64,64+192*c,64+192*g,64,64)};m.sort(function(a,b){if(null==a.layer)return-1;if(null==b.layer)return 1;"object"===
typeof a.layer&&(a.layer=a.layer.down);"object"===typeof b.layer&&(b.layer=b.layer.down);return a.layer-b.layer});u.clearRect(0,0,l.width,l.height);var q=[];for(n=0;n<m.length;n++)if(m[n]&&""!=m[n].path&&!m[n].png)q[n]=new Image,q[n].src="sprite/Universal-LPC-spritesheet/"+m[n].path,q[n].onload=function(){r++;if(r==m.length)return w(),d.resolve(l)};else if(r++,r==m.length)return w(),d.resolve(l)}return d.promise()}
function last_active_string(b){b=parseInt(b);var d=parseInt(b/60);b%=60;var f=parseInt(d/24);d%=24;var g=parseInt(f/30);f%=30;return 0<g?g+" meses":0<f?f+" dias":0<d?d+" horas":b+" minutos"}
function getMessageTime(b,d){if(d)return t=new Date(b),t.getDate()+" de "+"jan fev mar abr mai jun jul ago set out nov dez".split(" ")[t.getMonth()]+" de "+t.getFullYear()+" \u00e0s "+("0"+t.getHours()).slice(-2)+":"+("0"+t.getMinutes()).slice(-2);d=new Date;b=new Date(b);d=Math.round(d.getTime()/1E3);b=Math.round(b.getTime()/1E3);return last_active_string((d-b)/60)}function validate_skin(b){for(var d in b)if("shape"==b[d].parent)return!0;return!1};
