var translator={ready:!0,translate:async function(t){let s=user&&user.speak?user.speak:"pt",e=this.translations?this.translations:{};if(t.translate){let s=[];var a=[];for(let e in t.translate)s.push(t.translate[e]),a.push(e);t=s}t=Array.isArray(t)?t:[t];for(let a of t)"string"==typeof a?e[a]||(e[a]={}):a.find("*").contents().each(function(){if(!$(this).hasClass("skip-translation")&&!$(this).parents(".skip-translation").length){if($(this).data("translationTemplate")){let t=$(this).data("translationTemplate");e[t]={template:t}}if("pt"!=s){if(!(3!=this.nodeType||this.textContent.includes("\n")||this.textContent.includes("\t")||$(this).hasClass("translated")||this.textContent.match(/^[\d\s]+$/)||this.textContent.match(/^\W+$/))){let t=this.textContent.replace(/(\w+)/,"$1");t.length&&!e[t]&&(e[t]={}),$(this).parent().addClass("translating")}let t=["title","placeholder"];for(let s of t)this[s]&&this[s].length&&!$(this).hasClass("translated")&&(e[this[s]]||(e[this[s]]={}),$(this).addClass("translating"))}else $(this).removeClass("translating"),$(this).parents().removeClass("translating")}});let n=[];for(let t in e)e[t][s]||n.push(t);if(n.length){let t=await post("back_translation.php",{action:"TRANSLATE",language:s,data:JSON.stringify(n)});for(let a in t.response)e[a][s]=t.response[a]}this.translations={...this.translations,...e};let i=[];for(let a of t)"string"==typeof a?e[a]&&i.push(e[a][s]):a.find("*").contents().each(function(){if(!$(this).hasClass("skip-translation")&&!$(this).parents(".skip-translation").length)if($(this).data("translationTemplate")){let t=$(this).data("translationTemplate");this.textContent=e[t][s],translator.bind($(this))}else if("pt"!=s){3==this.nodeType&&e[this.textContent]&&!$(this).hasClass("translated")&&(this.textContent=` ${e[this.textContent][s]} `,translator.bind($(this).parent()));let t=["title","placeholder"];for(let a of t)this[a]&&e[this[a]]&&(this[a]=`${e[this[a]][s]}`,translator.bind($(this)))}$(this).removeClass("translating")});if(a&&a.length){let t={};for(let s in a)t[a[s]]=i[s];i=t}return i},getTranslated:function(t,s=!0,e=!0){if(!this.translations||!this.translations[t])return t;let a=this.translations[t][user.speak];return s&&(a=`<span class='translating'>${a}</span>`),e&&setTimeout(()=>{translator.bind()},50),a},bind:function(t){function s(t){t.addClass("translated"),t.removeClass("translating"),t.parents().removeClass("translating"),user.preferences&&"1"==user.preferences.translation&&(t.hover(function(s){$(".improve-box").remove(),t.append(`<div class='improve-box' data-time='${(new Date).getTime()}'><i class='fas fa-language'></i></div>`);let e=2e3;setTimeout(()=>{let s=t.find(".improve-box"),a=parseFloat(s.data("time"))+e<=(new Date).getTime();!s.hasClass("visible")&&a&&(s.css({top:t.position().top,left:t.position().left}),s.addClass("visible"),s.off().click(function(s){s.preventDefault(),s.stopPropagation(),$(this).remove();let e=t.text().trim();$("#dialog-box").parents("#fog").remove(),new Message({message:"Sugira uma tradução melhor para o texto:",input:{default:e},buttons:{ok:"OK",cancel:"Cancelar"}}).show().click("ok",async t=>{let s={old:e,new:t.input};await post("back_translation.php",{action:"SUGGEST",original:s.old,suggestion:s.new,language:user.speak});new Message({message:"Sugestão enviada"}).show()})}))},e)}),t.mouseleave(function(){t.find(".improve-box").remove()}))}t?s(t):$(".translating").each(function(){s($(this))})}};