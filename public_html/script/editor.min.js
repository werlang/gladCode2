var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,d,b){a instanceof String&&(a=String(a));for(var e=a.length,f=0;f<e;f++){var h=a[f];if(d.call(b,h,f,a))return{i:f,v:h}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,b){a!=Array.prototype&&a!=Object.prototype&&(a[d]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,d,b,e){if(d){b=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var f=a[e];f in b||(b[f]={});b=b[f]}a=a[a.length-1];e=b[a];d=d(e);d!=e&&null!=d&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");var editor,saved=!0,tested=!0,gladid,user,nick,hash,pieces,loadGlad=!1,wannaSave=!1,tutoState=0;
$(document).ready(function(){$("#header-editor").addClass("here");$.post("back_login.php",{action:"GET"}).done(function(a){"NULL"!=a?(user=JSON.parse(a),$("#login").html(user.nome),"1"==user.tutor&&showTutorial(),a=new Image,a.src=user.foto,$("#profile-icon img").attr("src",a.src),a.onerror=function(){$("#profile-icon img").attr("src","data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=")},editor.setTheme("ace/theme/"+user.theme),editor.setFontSize(user.font+"px"),$("#newglad").length?($("#newglad").remove(),
$("#fog-skin").fadeIn()):loadGlad||$("#open").click()):$("#fog-skin").fadeIn()});$(".fog").hide();$("#glad-code").length&&(loadGlad={id:$("#glad-code #idglad").html(),name:$("#glad-code #name").html(),user:$("#glad-code #user").html(),code:$("#glad-code #code").html(),vstr:$("#glad-code #vstr").html(),vagi:$("#glad-code #vagi").html(),vint:$("#glad-code #vint").html(),skin:$("#glad-code #skin").html()},nick=$("#glad-code #user").html(),$("#glad-code").remove());load_glad_generator($("#fog-skin"));
$("#header-container").addClass("small");load_editor();editor.focus();$("#float-card .glad-preview").click(function(){$("#skin").click()});$("#panel-left-opener").click(function(){$(this).hasClass("open")?($("#panel-left").width(0),$(this).removeClass("open")):($("#panel-left").width(65),$(this).addClass("open"))});$("#profile-icon").click(function(){user?window.location.href="profile":googleLogin().then(function(a){window.location.href="profile"})});$("#new").click(function(){saved?window.location.href=
"newglad":showDialog("Deseja criar um novo gladiador e perder as altera\u00e7\u00f5es feitas no gladiador atual?",["Sim","N\u00e3o"]).then(function(a){"Sim"==a&&(saved=!0,window.location.href="newglad")})});$("#open").click(function(){if(!$(this).hasClass("disabled"))if(user){$("#fog-glads").fadeIn();$("#fog-glads .glad-preview").remove();$("#fog-glads #btn-glad-open").prop("disabled",!0);var a=$("<div id='template'></div>").load("glad-card-template.html",function(){});$.post("back_glad.php",{action:"GET"}).done(function(f){f=
JSON.parse(f);for(var c in f)$("#fog-glads .glad-card-container").append("<div class='glad-preview'></div>");$("#fog-glads .glad-card-container .glad-preview").html(a);for(c in f)setGladImage(c,f[c].skin),$("#fog-glads .glad-preview .info .glad span").eq(c).html(f[c].name),$("#fog-glads .glad-preview .info .attr .str span").eq(c).html(f[c].vstr),$("#fog-glads .glad-preview .info .attr .agi span").eq(c).html(f[c].vagi),$("#fog-glads .glad-preview .info .attr .int span").eq(c).html(f[c].vint),$("#fog-glads .glad-preview").eq(c).data("id",
f[c].id),$("#fog-glads .glad-preview .delete").eq(c).click(function(){var a=$(this).parents(".glad-preview");showDialog("Deseja excluir o gladiador <span class='highlight'>"+a.find(".glad span").html()+"</span>?",["Sim","N\u00e3o"]).then(function(c){"Sim"==c&&(a.fadeOut(function(){a.remove()}),$.post("back_glad.php",{action:"DELETE",id:a.data("id")}).done(function(a){}))})});$("#fog-glads .glad-preview .code .button").remove();$("#fog-glads .glad-preview").click(function(){$("#fog-glads #btn-glad-open").removeProp("disabled");
$("#fog-glads .glad-preview").removeClass("selected");$(this).addClass("selected")});$("#fog-glads .glad-preview").dblclick(function(){$("#fog-glads #btn-glad-open").click()})})}else showDialog("Voc\u00ea precisa fazer LOGIN no sistema para visualizar seus gladiadores",["Cancelar","LOGIN"]).then(function(a){"LOGIN"==a&&googleLogin().then(function(a){user=a.email;setLoadGlad();$("#login").html(a.nome).off().click(function(){window.location.href="profile"})})})});$("#fog-glads #btn-glad-cancel").click(function(){$("#fog-glads").hide()});
$("#fog-glads #btn-glad-open").click(function(){if(saved){var a=$("#fog-glads .glad-preview.selected").data("id");window.location.href="glad-"+a}else a=$("#fog-glads .glad-preview.selected .glad span").html(),showDialog("Deseja abrir o gladiador <span class='highlight'>"+a+"</span> para edi\u00e7\u00e3o? Todas altera\u00e7\u00f5es no gladiador atual ser\u00e3o perdidas",["Sim","N\u00e3o"]).then(function(a){"Sim"==a&&(saved=!0,a=$("#fog-glads .glad-preview.selected").data("id"),window.location.href=
"glad-"+a)})});$("#save").click(function(){if(!$(this).hasClass("disabled"))if(user)if(setLoadGlad(),tested){var a="INSERT";gladid&&(a="UPDATE");var b=$("#distribuicao #nome").val();$.post("back_glad.php",{action:a,id:gladid,nome:b,vstr:$("#float-card .glad-preview .info .attr .str span").html(),vagi:$("#float-card .glad-preview .info .attr .agi span").html(),vint:$("#float-card .glad-preview .info .attr .int span").html(),skin:JSON.stringify(pieces)}).done(function(c){-1!=c.search("LIMIT")?showMessage("Voc\u00ea n\u00e3o pode possuir mais de <span class='highlight'>"+
JSON.parse(c).LIMIT+"</span> gladiadores simultaneamente. Aumente seu n\u00edvel de mestre para desbloquear mais gladiadores."):"EXISTS"==c?showMessage("O nome <span class='highlight'>"+b+"</span> j\u00e1 est\u00e1 sendo usado por outro gladiador"):"INVALID"==c?showMessage("CHEATER"):-1!=c.search("ID")&&(gladid=JSON.parse(c).ID,"INSERT"==a?showDialog("O gladiador <span class='highlight'>"+b+"</span> foi criado e gravado em seu perfil. Deseja inscrev\u00ea-lo para competir contra outros gladiadores?",
["Sim","Agora n\u00e3o"]).then(function(a){"Sim"==a&&window.open("battle")}):showMessage("Gladiador <span class='highlight'>"+b+"</span> gravado"),saved=!0)})}else showDialog("Voc\u00ea precisar testar o gladiador <span class='highlight'>"+loadGlad.name+"</span> ao menos uma vez antes de salv\u00e1-lo. Deseja fazer isso agora?",["Sim","N\u00e3o"]).then(function(a){"Sim"==a&&($("#test").click(),wannaSave=!0)});else showDialog("Voc\u00ea precisa fazer LOGIN no sistema para salvar seu gladiador",["Cancelar",
"LOGIN"]).then(function(a){"LOGIN"==a&&googleLogin().then(function(a){user=a.email;setLoadGlad();$("#login").html(a.nome).off().click(function(){window.location.href="profile"})})})});$("#skin").click(function(){$("#fog-skin").fadeIn()});$("#test").click(function(){function a(){if(2==tutoState)tutoState=3,showTutorial();else if(9==tutoState||10==tutoState||12==tutoState||14==tutoState||16==tutoState||18==tutoState||20==tutoState||22==tutoState)showTutorial();else if(setLoadGlad(),!$(this).hasClass("disabled")){$("#fog-battle").fadeIn();
var a=$("#float-card .glad-preview .glad span").html();$("#fog-battle h3 span").html(a)}}var b=editor.getValue();-1!=b.search("setup()")?showDialog("A fun\u00e7\u00e3o <span class='highlight'>setup</span> s\u00f3 deve ser usada nos modos de batalha cl\u00e1ssicos (aqueles que voc\u00ea faz upload manual do c\u00f3digo). Posso remover este trecho para voc\u00ea?",["N\u00c3O","Pode"]).then(function(c){"Pode"==c&&(editor.setValue(b.replace(/setup\(\)[\s\n]*?{[\w\W]*?}/g,"")),setTimeout(function(){a()},
300))}):a()});var a={Wanderer:{difficulty:1,filename:"Wanderer"},Runner:{difficulty:1,filename:"Runner"},Blinker:{difficulty:1,filename:"Blinker"},Arch:{difficulty:2,filename:"Arch"},Patient:{difficulty:2,filename:"Patient"},Warrior:{difficulty:2,filename:"Warrior"},Mage:{difficulty:2,filename:"Mage"},Rogue:{difficulty:2,filename:"Rogue"},Archie:{difficulty:3,filename:"Archie"},"War Maker":{difficulty:3,filename:"WarMaker"},Magnus:{difficulty:3,filename:"Magnus"},Rouge:{difficulty:3,filename:"Rouge"}},
d=["","one","two","three"],b;for(b in a)$("#fog-battle #list").append("<div class='glad'><div class='name'></div><div class='diff'><div class='bar'></div><div class='bar'></div><div class='bar'></div></div></div>"),$("#fog-battle #list .glad").last().data("filename",a[b].filename),$("#fog-battle #list .glad .name").last().html(b),$("#fog-battle #list .glad .diff").last().addClass(d[a[b].difficulty]);$("#fog-battle #list .glad").click(function(){var a="samples/gladbots/"+$(this).data("filename")+".c",
b;if($(this).hasClass("selected"))$(this).removeClass("selected"),$("#fog-battle .glad-card-container").html("");else if(4>$("#fog-battle #list .glad.selected").length){$(this).addClass("selected");var c=$("<div id='template'></div>").load("glad-card-template.html",function(){$("#fog-battle .glad-card-container").html("<div class='glad-preview'></div>");$("#fog-battle .glad-card-container .glad-preview").html(c);getGladFromFile(a).then(function(a){fetchSpritesheet(a.skin).then(function(a){$("#fog-battle .glad-preview .image").html(getSpriteThumb(a,
"walk","down"))});$("#fog-battle .glad-preview .info .glad span").html(a.name);$("#fog-battle .glad-preview .info .attr .str span").html(a.vstr);$("#fog-battle .glad-preview .info .attr .agi span").html(a.vagi);$("#fog-battle .glad-preview .info .attr .int span").html(a.vint);b=a.code});$("#fog-battle .glad-preview .delete").remove();$("#fog-battle .glad-preview .code .button").click(function(){$("body").append("<div id='fog'><div id='code-box'><pre class='line-numbers language-c'><code class='language-c'>"+
b+"</code></pre><div id='button-container'><button id='close' class='button'>Fechar</button></div></div></div>");Prism.highlightElement($("code")[0]);$("#code-box #close").click(function(a){$("#fog").remove()})})})}if(0<$("#fog-battle #list .glad.selected").length){var g=$("#fog-battle #list .glad.selected").length;$("#fog-battle #btn-battle").removeProp("disabled");$("#fog-battle #list-title span").html(g+" selecionados")}else $("#fog-battle #btn-battle").prop("disabled",!0),$("#fog-battle #list-title span").html("")});
var e;$("#fog-battle #btn-cancel").click(function(){e&&e.isActive()?(e.kill(),ajaxcall&&ajaxcall.abort()):$("#fog-battle").hide()});$("#fog-battle #btn-battle").click(function(){e=new progressButton($(this),["Executando batalha...","Aguardando resposta do servidor"]);var b=[],d=0;$.each($("#fog-battle #list .glad.selected"),function(){var c="samples/gladbots/"+a[$(this).find(".name").html()].filename+".c";getGladFromFile(c).then(function(a){b.push(a.code);d++})});var c=setInterval(function(){d==$("#fog-battle #list .glad.selected").length&&
(b.push(loadGlad.code),clearInterval(c),runSimulation({glads:b,savecode:!0,single:!0}).then(function(a){"ERROR"!=a&&(showDialog("Deseja visualizar a batalha?",["Sim","N\u00e3o"]).then(function(c){"Sim"==c?window.open("play/"+a):$.post("back_log.php",{action:"DELETE",hash:a});wannaSave&&(showDialog("Gladiador testado com sucesso. Deseja grav\u00e1-lo?",["Sim","N\u00e3o"]).then(function(a){"Sim"==a&&$("#save").click()}),wannaSave=!1);4!=tutoState&&5!=tutoState&&6!=tutoState&&8!=tutoState&&11!=tutoState&&
13!=tutoState&&15!=tutoState&&17!=tutoState&&19!=tutoState&&21!=tutoState&&23!=tutoState||showTutorial()}),tested=!0);e.kill();$("#fog-battle").hide()}))},10)});$("#download").click(function(){if(!$(this).hasClass("disabled")){var a=$("#distribuicao #nome").val(),b=$("#float-card .glad-preview .attr .str span").html(),c=$("#float-card .glad-preview .attr .agi span").html(),d=$("#float-card .glad-preview .attr .int span").html();showInput("Nome do arquivo:",a+".c").then(function(f){f&&$.post("back_skin.php",
{action:"SAVE",skin:JSON.stringify(pieces)}).done(function(l){hash=l;download(f,'setup(){\n    setName("'+a+'");\n    setSTR('+b+");\n    setAGI("+c+");\n    setINT("+d+');\n    setSpritesheet("'+hash+'");\n}\n\n'+editor.getValue())})})}});$("#settings").click(function(){var a="ambiance chaos chrome clouds clouds_midnight cobalt crimson_editor dawn dracula dreamweaver eclipse github gob gruvbox idle_fingers iplastic katzenmilch kr_theme kuroir merbivore merbivore_soft mono_industrial monokai pastel_on_dark solarized_dark solarized_light sqlserver terminal textmate tomorrow tomorrow_night_blue tomorrow_night_bright tomorrow_night_eighties tomorrow_night twilight vibrant_ink xcode".split(" ");
$("body").append("<div id='fog'><div id='settings-window'><div id='title'><h2>Prefer\u00eancias do editor</h2></div><div id='settings-content'><div id='options'><h3>Temas</h3><div id='list'></div><h3>Tamanho da fonte</h3><div id='font-size'><button class='button font-small'><img src='icon/font_minus.png'></button><button class='button font-big'><img src='icon/font_plus.png'></button></div></div><div id='sample'><h3>Visualiza\u00e7\u00e3o</h3><pre id='code-sample'></pre></div></div><div id='button-container'><button class='button' id='cancel'>Cancelar</button><button class='button' id='change'>ALTERAR</button></div></div></div>");
for(var b in a)$("#settings-window #list").append("<div class='theme'>"+a[b]+"</div>"),(user&&user.theme==a[b]||!user&&"dreamweaver"==a[b])&&$("#settings-window #list .theme").last().addClass("selected");var c=ace.edit("code-sample");user&&(c.setTheme("ace/theme/"+user.theme),c.setFontSize(user.font+"px"));c.getSession().setMode("ace/mode/c_cpp");c.setReadOnly(!0);c.setValue("int start = 1;\n\nloop(){\n\tupgradeSTR();\n\tif (getCloseEnemy()){\n\t\tfloat dist = getDist(getTargetX(), getTargetY());\n\t\tif (dist < 0.8 && isTargetVisible()){\n\t\t\tattackMelee();\n\t\t}\n\t\telse\n\t\t\tmoveToTarget();\n\t}\n\telse{\n\t\tif (start){\n\t\t\tif(moveTo(12.5,12.5))\n\t\t\t\tstart = 0;\n\t\t}\n\t\telse\n\t\t\tturnLeft(50);\n\t}\n}",
-1);$("#settings-window #list .theme").click(function(){$("#settings-window #list .theme").removeClass("selected");$(this).addClass("selected");var a=$(this).html();c.setTheme("ace/theme/"+a)});$("#settings-window #font-size .button").click(function(){var a=parseInt(c.getFontSize());$(this).hasClass("font-small")?c.setFontSize(a-2):$(this).hasClass("font-big")&&c.setFontSize(a+2);c.resize()});$("#settings-window #cancel").click(function(){$("#fog").remove()});$("#settings-window #change").click(function(){var a=
c.getTheme().split("/")[2],b=parseInt(c.getFontSize());editor.setTheme(c.getTheme());editor.setFontSize(c.getFontSize());$("#fog").remove();user&&$.post("back_login.php",{action:"EDITOR",theme:a,font:b}).done(function(){user.theme=a;user.font=b})})});$("#help").click(function(){$("body").append("<div id='fog'><div id='help-window'><div id='title'>Que tipo de ajuda voc\u00ea gostaria?</div><div id='cat-container'><div id='docs' class='categories'><img src='icon/document.png'><span>Leitura</span></div><div id='video' class='categories'><img src='icon/video.png'><span>V\u00eddeo</span></div><div id='tutorial' class='categories'><img src='icon/tutor.png'><span>Tutorial</span></div></div>");
$("#fog").hide().fadeIn();$("#fog").click(function(){$(this).remove()});$("#help-window #tutorial").click(function(){showTutorial()});$("#help-window #docs").click(function(a){a.stopPropagation();$(this).hasClass("selected")||($("#help-window .categories").removeClass("selected"),$(this).addClass("selected"),$("#help-window #subcat").remove(),$("#help-window").append("<div id='subcat'><a href='manual' class='button' target='_blank'>Manual da gladCode</a><a href='docs' class='button' target='_blank'>Refer\u00eancia das fun\u00e7\u00f5es</a></div>"),
$("#help-window #subcat").hide().slideDown())});$("#help-window #video").click(function(a){a.stopPropagation();$(this).hasClass("selected")||($("#help-window .categories").removeClass("selected"),$(this).addClass("selected"),$("#help-window #subcat").remove(),$("#help-window").append("<div id='subcat'><button class='video button' data-video='te1M98UDKiM'>Introdu\u00e7\u00e3o e conceitos</button><button class='video button' data-video='tjMjqQ14AS8'>Editor de gladiadores</button><button class='video button' data-video='Wrc-0_Kq-_4'>Programando gladiadores</button><button class='video button' data-video='5QQtfruq8_8'>Habilidades e efeitos</button></div>"),
$("#help-window #subcat").hide().slideDown(),$("#help-window .video.button").click(function(){$("#fog").remove();var a=$(this).data("video");$("body").append("<div id='fog' class='dark'><div id='video-container'><iframe width='100%' height='100%' src='https://www.youtube.com/embed/"+a+"' frameborder='0' allowfullscreen></iframe><div id='remove'></div></div></div>");$("#fog").hide().fadeIn();$("#fog #remove").click(function(){$("#fog").remove()})}))})});editor.on("change",function(){tested=saved=!1;
""!=$("#float-card .glad-preview").html()&&""!=editor.getValue()?$("#download").removeClass("disabled"):$("#download").addClass("disabled");1==tutoState&&showTutorial()})});
function setLoadGlad(){loadGlad={};var a=[],d;for(d in selected)a.push(d);loadGlad.skin=JSON.stringify(a);loadGlad.id=gladid;loadGlad.user=nick;loadGlad.name=$("#distribuicao #nome").val();loadGlad.vstr=$("#distribuicao .slider").eq(0).val();loadGlad.vagi=$("#distribuicao .slider").eq(1).val();loadGlad.vint=$("#distribuicao .slider").eq(2).val();loadGlad.code='setup(){\n\tsetName("'+loadGlad.name+'");\n\tsetSTR('+loadGlad.vstr+");\n\tsetAGI("+loadGlad.vagi+");\n\tsetINT("+loadGlad.vint+');\n\tsetSkin("'+
loadGlad.skin+'");\n\tsetUser("'+loadGlad.user+'");\n}\n\n'+editor.getValue()}function getGladFromFile(a){var d=$.Deferred();$.post("back_glad.php",{action:"FILE",filename:a}).done(function(a){a=JSON.parse(a);a.skin&&(a.skin=JSON.stringify(a.skin));return d.resolve(a)});return d.promise()}
function load_editor(){ace.require("ace/ext/language_tools");editor=ace.edit("code");editor.setTheme("ace/theme/dreamweaver");editor.setFontSize(18);editor.session.setMode("ace/mode/c_cpp");editor.getSession().setUseWrapMode(!0);editor.$blockScrolling=Infinity;editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0})}
var menus={body:["gender","shape","ears","eyes"],hair:["style","color","facial","bcolor"],cloth:["shirt","armor","legs","feet"],misc:["head","shoulder","hands","cape","belt"],equip:["melee","ranged","shield"]},canvas=document.createElement("canvas");canvas.setAttribute("width",192);canvas.setAttribute("height",192);var ctx=canvas.getContext("2d"),spritesheet=document.createElement("canvas");spritesheet.setAttribute("width",2496);spritesheet.setAttribute("height",4032);
var spritectx=spritesheet.getContext("2d"),lastcolor="black",direction=2,scale=1,animationOn=!1,selected={},imageIndex=[],parentTree=[],anim_num=0,move=[{name:"walk",sprites:9,line:8,image:"walk"},{name:"cast",sprites:7,line:0,image:"magic"},{name:"thrust",sprites:8,line:4,image:"thrust"},{name:"slash",sprites:6,line:12,image:"slash"},{name:"shoot",sprites:13,line:16,image:"arrows"}],moveEnum={walk:0,cast:1,thrust:2,slash:3,shoot:4};
function load_glad_generator(a){a.load("glad-create.html",function(){function a(c){return 0==c?0:a(c-1)+Math.ceil(c/6)}buildIndex();$(".img-button.sub").addClass("hidden");$("#middle-container").append(canvas);reload_reqs();$(".slider-container").on("touchstart mouseenter",function(){text=[{path:"sprite/images/strength.png",title:"For\u00e7a - STR",description:"For\u00e7a f\u00edsica e resist\u00eancia do gladiador.",list:[{path:"sprite/images/decapitation.png",description:"Dano f\u00edsico, o dano causado com armas corpo-a-corpo"},
{path:"sprite/images/healing.png",description:"Pontos de vida, respons\u00e1veis por manter o gladiador vivo"}]},{path:"sprite/images/agility.png",title:"Agilidade - AGI",description:"Agilidade, rapidez e destreza do gladiador.",list:[{path:"sprite/images/bullseye.png",description:"Precis\u00e3o, o dano causado com armas \u00e0 dist\u00e2ncia"},{path:"sprite/images/sprint.png",description:"Velocidade de movimento dentro da arena"},{path:"sprite/images/blades.png",description:"Velocidade de execu\u00e7\u00e3o de ataques"}]},
{path:"sprite/images/smart.png",title:"Intelig\u00eancia - INT",description:"Rapidez de racioc\u00ednio e Capacidade intelectual do gladiador.",list:[{path:"sprite/images/energy.png",description:"Poder m\u00e1gico, o dano causado com habilidades m\u00e1gicas"},{path:"sprite/images/3balls.png",description:"Velocidade de execu\u00e7\u00e3o de uma habilidade"},{path:"sprite/images/energise.png",description:"Pontos de habilidade, usados para lan\u00e7ar habilidades"}]}];index=$(".slider-container").index($(this));
$("#info #title img").attr("src",text[index].path);$("#info #title span").html(text[index].title);$("#info #body .fill").html(text[index].description);$("#info ul").html("");$.each(text[index].list,function(a,b){$("#info ul").append("<li><img src='"+b.path+"'><span>"+b.description+"</span></li>")})});$("#save-glad").click(function(){$("#distribuicao-container").css({display:"flex",height:$("#skin-container").outerHeight()});$("#skin-container").hide();var a=document.createElement("canvas");a.setAttribute("width",
64);a.setAttribute("height",64);a.getContext("2d").drawImage(canvas,64,64,64,64,0,0,64,64);$("#cv").html(a);tested=saved=!1});$("#get-code").click(function(){var a=$("#distribuicao #nome").val();if(2>=a.length||!a.match(/^[\w \u00c0-\u00fa]+?$/g))$("#distribuicao #nome").addClass("error"),$("#distribuicao #nome").focus();else{$("#distribuicao #nome").removeClass("error");pieces=[];$.each(selected,function(a,l){pieces.push(l.id)});var b=$("#distribuicao .slider-input").eq(0).val(),d=$("#distribuicao .slider-input").eq(1).val(),
l=$("#distribuicao .slider-input").eq(2).val();1==tutoState&&(tutoState=2,showTutorial());editor&&(""==editor.getValue()&&(editor.setValue("loop(){\n    //comportamento do gladiador\n}"),editor.gotoLine(1,0,!0)),editor.focus(),$("#save, #test").removeClass("disabled"),$("#fog-skin").hide(),$("#back").click(),$("#float-card .glad-preview").load("glad-card-template.html",function(){$("#float-card .glad-preview .info .glad span").html(a);$("#float-card .glad-preview .info .attr .str span").html(b);$("#float-card .glad-preview .info .attr .agi span").html(d);
$("#float-card .glad-preview .info .attr .int span").html(l);$(".delete-container, .code").remove();var c=document.createElement("canvas");c.setAttribute("width",64);c.setAttribute("height",64);c.getContext("2d").drawImage(canvas,64,64,64,64,0,0,64,64);$("#float-card .glad-preview .image").html(c);""!=$("#float-card .glad-preview").html()&&""!=editor.getValue()?$("#download").removeClass("disabled"):$("#download").addClass("disabled")}))}tested=saved=!1});$("#back").click(function(){$("#distribuicao-container").hide();
$("#skin-container").show()});$("#reset").click(function(){$(".img-button").removeClass("selected");$(".img-button .sub").addClass("hidden");$("#distribuicao #nome").val("");$("#distribuicao .slider").val(0).change();selected={};for(var a in images)images[a].default&&(selected[images[a].id]=images[a]);reload_reqs();$("#distribuicao-container").hide();$("#skin-container").show()});$(".img-button.cat").click(function(){$(this).hasClass("n-av")||($(".img-button.cat").removeClass("selected"),$(".img-button.sub").removeClass("selected"),
$(".img-button.sub").addClass("hidden"),$.each(menus[$(this).attr("id")],function(a,b){$("#"+b).removeClass("hidden")}),$(this).addClass("selected"),reload_reqs())});$(".img-button.sub").click(function(){$(this).hasClass("n-av")||($(".img-button.sub").removeClass("selected"),$(this).addClass("selected"),reload_reqs())});$("#turn").click(function(){direction=(direction+1)%4;draw()});$("#down-scale").click(function(){1<scale&&(scale-=.5);draw()});$("#up-scale").click(function(){3.5>scale&&(scale+=.5);
draw()});var b=0;$("#play-pause").click(function(){animationOn?(animationOn=!1,b=0,$(this).find("img").attr("src","sprite/images/play.png")):(animationOn=!0,$(this).find("img").attr("src","sprite/images/pause.png"));draw()});$("#animation").click(function(){var a={walk:!0,cast:!0,thrust:!1,slash:!1,shoot:!1};$.each(selected,function(c,b){b.move&&(a[b.move]=!0)});do anim_num=(anim_num+1)%move.length;while(!a[move[anim_num].name]);b=0;$(this).find("img").attr("src","sprite/images/"+move[anim_num].image+
".png")});setInterval(function(){ctx.clearRect(0,0,canvas.width,canvas.height);animationOn&&b++;b>=move[anim_num].sprites&&(b=0);h=direction+move[anim_num].line;ctx.drawImage(spritesheet,192*b,192*h,192,192,96-192*scale/2,96-192*scale/2-5,192*scale,192*scale)},100);$(document).on("input change","#distribuicao .slider",function(){$(this).parents(".slider-container").find(".slider-value").html(a($(this).val()));$(this).parents(".slider-container").find(".slider-input").val($(this).val());$("#get-code").prop("disabled",
"true");var c=0;$("#distribuicao .slider-value").each(function(){c+=parseInt($(this).html())});var b=$("#distribuicao #remaining span");b.html(50-c);50==c?($("#get-code").html("GERAR C\u00d3DIGO"),$("#get-code").removeProp("disabled"),b.css("color","#4caf50")):50<c?b.css("color","#f44336"):b.css("color","black")});$(".close").click(function(){$("#fog-skin").hide()});if(loadGlad){selected={};var e=!1;try{var f=JSON.parse(loadGlad.skin)}catch(c){e=!0,f=[]}for(var h in f)getImage(f[h])&&(selected[f[h]]=
getImage(f[h]));gladid=loadGlad.id;$("#distribuicao #nome").val(loadGlad.name);$("#distribuicao .slider").eq(0).val(loadGlad.vstr);$("#distribuicao .slider").eq(1).val(loadGlad.vagi);$("#distribuicao .slider").eq(2).val(loadGlad.vint);$("#distribuicao .slider").change();editor.setValue(decodeHTML(loadGlad.code));editor.gotoLine(1,0,!0);$("#get-code").click();saved=!0;e||fetchSpritesheet(JSON.stringify(f)).then(function(a){$("#float-card .image").html(getSpriteThumb(a,"walk","down"))})}})}
function draw(){function a(a){var b=["up","left","down","right"];return a.layer&&a.layer.default?a.layer[b[direction]]?a.layer[b[direction]]:a.layer.default:a.layer}var d=0,b=[],e;for(e in selected)b.push(selected[e]);b.sort(function(b,c){return a(b)-a(c)});spritectx.clearRect(0,0,spritesheet.width,spritesheet.height);var f=[];for(e=0;e<b.length;e++)""==b[e].path||b[e].png?d++:(f[e]=new Image,f[e].src="sprite/Universal-LPC-spritesheet/"+b[e].path,f[e].onload=function(){d++});interval=setInterval(function(){if(d==
b.length)for(clearInterval(interval),killLoadingBar(),e=0;e<b.length;e++)if(f[e])if(b[e].oversize){var a=move[moveEnum[b[e].move]].line,c=move[moveEnum[b[e].move]].sprites;for(k=0;4>k;k++)for(j=0;j<c;j++)spritectx.drawImage(f[e],192*j,192*k,192,192,192*j,192*a+192*k,192,192)}else for(k=0;21>k;k++)for(j=0;13>j;j++)spritectx.drawImage(f[e],64*j,64*k,64,64,64+192*j,64+192*k,64,64)},10)}
function reload_reqs(a){a||$("#right-container").html("");createLoadingBar();var d={};setTimeout(function(){var b=parentTree[$(".img-button.sub.selected").attr("id")];$.each(b,function(a,b){b=getImage(b);a=!0;if(Array.isArray(b.parent)){for(g=0;g<b.parent.length&&!$(".img-button#"+b.parent[g]).hasClass("selected");g++);g==b.parent.length&&(a=!1)}else $(".img-button#"+b.parent).hasClass("selected")||(a=!1);a&&(d[b.id]=b)});$.each(images,function(a,b){if(b.req)if(b.req.or){for(g=0;g<b.req.or.length&&
!selected[b.req.or[g]];g++);g==b.req.or.length&&(delete d[b.id],delete selected[b.id])}else if(b.req.and)for(g=0;g<b.req.and.length;g++){if(!selected[b.req.and[g]]){delete d[b.id];delete selected[b.id];break}}else if(b.req.not)for(g=0;g<b.req.not.length;g++){if(selected[b.req.not[g]]){delete d[b.id];delete selected[b.id];break}}else selected[b.req]||(delete d[b.id],delete selected[b.id])});var e=!1;$.each(selected,function(a,b){"shape"==b.parent&&(e=!0)});e||(selected.male?selected["male-light"]=
getImage("male-light"):selected["female-light"]=getImage("female-light"));if($("#style").hasClass("selected")){var f=lastcolor;$.each(selected,function(a,b){"color"==b.parent[1]&&(lastcolor=f=b.id.split("_")[1])});$.each(images,function(a,b){"color"==b.parent[1]&&($(this).attr("id").split("_")[1]==f?d[b.id]=b:delete d[b.id])})}$("#facial").hasClass("selected")&&(f=lastcolor,$.each(selected,function(a,b){"bcolor"==b.parent[1]&&(lastcolor=f=b.id.split("_")[1])}),$.each(images,function(a,b){"bcolor"==
b.parent[1]&&(b.id.split("_")[1]==f?d[b.id]=b:delete d[b.id])}));if($("#color").hasClass("selected")){var h;$.each(selected,function(a,b){"style"==b.parent[0]&&(h=b.id.split("_")[0])});$.each(images,function(a,b){"style"==b.parent[0]&&(b.id.split("_")[0]==h?d[b.id]=b:delete d[b.id])})}if($("#bcolor").hasClass("selected")){var c;$.each(selected,function(a,b){"facial"==b.parent[0]&&(c=b.id.split("_")[0])});$.each(images,function(a,b){"facial"==b.parent[0]&&(b.id.split("_")[0]==c?d[b.id]=b:delete d[b.id])})}$(".img-button.sub.n-av").removeClass("n-av");
(selected["male-orc"]||selected["male-red_orc"]||selected.skeleton||selected["female-orc"]||selected["female-red_orc"])&&$("#eyes, #ears").addClass("n-av");selected.hair_none&&$("#color").addClass("n-av");selected.facial_none&&$("#bcolor").addClass("n-av");(selected.male_chain||selected.female_chain)&&$("#shirt, #legs").addClass("n-av");$.each(selected,function(a,b){if(Array.isArray(b.block))for(g=0;g<b.block.length;g++)$("#"+b.block[g]).addClass("n-av");else $("#"+b.block).addClass("n-av");b.move&&
$(".img-button#"+b.parent).hasClass("selected")&&(anim_num=moveEnum[b.move],$("#animation").find("img").attr("src","sprite/images/"+move[anim_num].image+".png"));"none"==b.parent&&selected[b.id]&&delete selected[b.id];b.select&&(selected[b.select]=getImage(b.select))});$.each($(".img-button.sub.n-av"),function(){var a=parentTree[$(this).attr("id")],b;for(b in a)selected[a[b]]&&delete selected[a[b]]});if(!a)for(var g in d)load_assets(d[g]);draw()},1)}
function load_assets(a){var d=document.createElement("canvas");d.setAttribute("width",64);d.setAttribute("height",64);var b=d.getContext("2d"),e=a.path,f=new Image;f.src=a.png?"sprite/images/"+e:"sprite/Universal-LPC-spritesheet/"+e;f.onload=function(){try{var c=10,d=0,e=64;a.line&&(c=a.line);a.col&&(d=a.col);a.oversize&&(e=192);if(a.png)b.drawImage(f,0,0,a.width,a.height,0,0,64,64);else if(a.scale){var h=0,m=0;a.posx&&(h=a.posx);a.posy&&(m=a.posy);b.drawImage(f,d*e,c*e,e,e,e/2-a.scale*e/2+h,e/2-
a.scale*e/2+m,64*a.scale,64*a.scale)}else b.drawImage(f,d*e,c*e,e,e,0,-5,64,64)}catch(n){console.log(n)}};0==$(".img-button.item#"+a.id).length&&$("#right-container").append("<div class='img-button item' id='"+a.id+"'></div>");$(".img-button.item#"+a.id).append(d);a.default&&$(".img-button.item#"+a.id).addClass("selected");for(var h in selected)selected[h].id==a.id&&($(".img-button.item").removeClass("selected"),$(".img-button.item#"+a.id).addClass("selected"));$(".img-button.item#"+a.id).click(function(){var b=
[];Array.isArray(a.parent)?b=a.parent:b.push(a.parent);for(var d in selected){var e=[];Array.isArray(selected[d].parent)?e=selected[d].parent:e.push(selected[d].parent);for(var f in e)for(var h in b)e[f]==b[h]&&delete selected[d]}selected[a.id]=a;$(".img-button.item").removeClass("selected");$(this).addClass("selected");reload_reqs(!0)})}function getImage(a){return images[imageIndex[a]]}
function buildIndex(){for(i=0;i<images.length;i++){imageIndex[images[i].id]=i;if(images[i].parent)if(Array.isArray(images[i].parent))for(j in images[i].parent)parentTree[images[i].parent[j]]||(parentTree.push(images[i].parent[j]),parentTree[images[i].parent[j]]=[]),parentTree[images[i].parent[j]].push(images[i].id);else parentTree[images[i].parent]||(parentTree.push(images[i].parent),parentTree[images[i].parent]=[]),parentTree[images[i].parent].push(images[i].id);images[i].default&&(selected[images[i].id]=
images[i])}}function cloneCanvas(a){var d=document.createElement("canvas"),b=d.getContext("2d");d.width=a.width;d.height=a.height;b.drawImage(a,0,0);return d}function createLoadingBar(){0==$("#loadbar").length&&$("#middle-container").append("<div id='loadbar'><img src='sprite/images/loading.gif'></div>");$("#middle-container canvas").hide();$("#loadbar").show()}function killLoadingBar(){$("#loadbar").hide();$("#middle-container canvas").show()}
function download(a,d){var b=document.createElement("a");b.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(d));b.setAttribute("download",a);document.createEvent?(a=document.createEvent("MouseEvents"),a.initEvent("click",!0,!0),b.dispatchEvent(a)):b.click()}function setGladImage(a,d){fetchSpritesheet(d).then(function(b){$("#fog-glads .glad-preview .image").eq(a).html(getSpriteThumb(b,"walk","down"))})}window.onbeforeunload=function(){return saved?null:!0};
