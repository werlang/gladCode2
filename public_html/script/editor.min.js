var editor,fontsize=18,saved=!0,tested=!0,gladid,user,nick,hash,pieces,loadGlad=!1,wannaSave=!1,tutoState=0;
$(document).ready(function(){$.post("back_login.php",{action:"GET"}).done(function(b){"NULL"!=b&&(user=JSON.parse(b),$("#login").html(user.nome),"1"==user.tutor&&showTutorial(),b=new Image,b.src=user.foto,$("#profile-icon img").attr("src",b.src),b.onerror=function(){$("#profile-icon img").attr("src","data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=")})});$(".fog").hide();$("#fog-skin").fadeIn();$("#glad-code").length&&(loadGlad={id:$("#glad-code #idglad").html(),name:$("#glad-code #name").html(),
user:$("#glad-code #user").html(),code:$("#glad-code #code").html(),vstr:$("#glad-code #vstr").html(),vagi:$("#glad-code #vagi").html(),vint:$("#glad-code #vint").html(),skin:$("#glad-code #skin").html()},nick=$("#glad-code #user").html(),$("#glad-code").remove(),$(".fog").hide());$("#header-container").addClass("small");load_editor();editor.focus();$("#code").css("font-size",fontsize+"px");$("#float-card .glad-preview").click(function(){$("#skin").click()});load_glad_generator($("#fog-skin"));$("#panel-left-opener").click(function(){$(this).hasClass("open")?
($("#panel-left").width(0),$(this).removeClass("open")):($("#panel-left").width(65),$(this).addClass("open"))});$("#profile-icon").click(function(){user?window.location.href="profile.php":googleLogin().then(function(b){window.location.href="profile.php"})});$("#new").click(function(){saved?window.location.href="editor.php":showDialog("Deseja criar um novo gladiador e perder as altera\u00e7\u00f5es feitas no gladiador atual?",["Sim","N\u00e3o"]).then(function(b){"Sim"==b&&(window.location.href="editor.php")})});
$("#open").click(function(){if(!$(this).hasClass("disabled"))if(user){$("#fog-glads").fadeIn();$("#fog-glads .glad-preview").remove();$("#fog-glads #btn-glad-open").prop("disabled",!0);var b=$("<div id='template'></div>").load("glad-card-template.html",function(){});$.post("back_glad.php",{action:"GET"}).done(function(a){a=JSON.parse(a);for(var f in a)$("#fog-glads .glad-card-container").append("<div class='glad-preview'></div>");$("#fog-glads .glad-card-container .glad-preview").html(b);for(f in a)setGladImage(f,
a[f].skin),$("#fog-glads .glad-preview .info .glad span").eq(f).html(a[f].name),$("#fog-glads .glad-preview .info .attr .str span").eq(f).html(a[f].vstr),$("#fog-glads .glad-preview .info .attr .agi span").eq(f).html(a[f].vagi),$("#fog-glads .glad-preview .info .attr .int span").eq(f).html(a[f].vint),$("#fog-glads .glad-preview").eq(f).data("id",a[f].id),$("#fog-glads .glad-preview .delete").eq(f).click(function(){var a=$(this).parents(".glad-preview");showDialog("Deseja excluir o gladiador <span class='highlight'>"+
a.find(".glad span").html()+"</span>?",["Sim","N\u00e3o"]).then(function(b){"Sim"==b&&(a.fadeOut(function(){a.remove()}),$.post("back_glad.php",{action:"DELETE",id:a.data("id")}).done(function(a){}))})});$("#fog-glads .glad-preview .code .button").remove();$("#fog-glads .glad-preview").click(function(){$("#fog-glads #btn-glad-open").removeProp("disabled");$("#fog-glads .glad-preview").removeClass("selected");$(this).addClass("selected")});$("#fog-glads .glad-preview").dblclick(function(){$("#fog-glads #btn-glad-open").click()})})}else showDialog("Voc\u00ea precisa fazer LOGIN no sistema para visualizar seus gladiadores",
["Cancelar","LOGIN"]).then(function(a){"LOGIN"==a&&googleLogin().then(function(a){user=a.email;setLoadGlad();$("#login").html(a.nome).off().click(function(){window.location.href="profile.php"})})})});$("#fog-glads #btn-glad-cancel").click(function(){$("#fog-glads").hide()});$("#fog-glads #btn-glad-open").click(function(){if(saved){var a=$("#fog-glads .glad-preview.selected").data("id");window.location.href="editor.php?g="+a}else a=$("#fog-glads .glad-preview.selected .glad span").html(),showDialog("Deseja abrir o gladiador <span class='highlight'>"+
a+"</span> para edi\u00e7\u00e3o? Todas altera\u00e7\u00f5es no gladiador atual ser\u00e3o perdidas",["Sim","N\u00e3o"]).then(function(a){"Sim"==a&&(a=$("#fog-glads .glad-preview.selected").data("id"),window.location.href="editor.php?g="+a)})});$("#save").click(function(){if(!$(this).hasClass("disabled"))if(user)if(setLoadGlad(),tested){var a="INSERT";gladid&&(a="UPDATE");var d=$("#distribuicao #nome").val();$.post("../back_glad.php",{action:a,id:gladid,nome:d,vstr:$("#float-card .glad-preview .info .attr .str span").html(),
vagi:$("#float-card .glad-preview .info .attr .agi span").html(),vint:$("#float-card .glad-preview .info .attr .int span").html(),skin:JSON.stringify(pieces)}).done(function(b){-1!=b.search("LIMIT")?showMessage("Voc\u00ea n\u00e3o pode possuir mais de <span class='highlight'>"+JSON.parse(b).LIMIT+"</span> gladiadores simultaneamente. Aumente seu n\u00edvel de mestre para desbloquear mais gladiadores."):"EXISTS"==b?showMessage("O nome <span class='highlight'>"+d+"</span> j\u00e1 est\u00e1 sendo usado por um de seus gladiadores"):
"INVALID"==b?showMessage("CHEATER"):-1!=b.search("ID")&&(gladid=JSON.parse(b).ID,"INSERT"==a?showDialog("O gladiador <span class='highlight'>"+d+"</span> foi criado e gravado em seu perfil. Deseja inscrev\u00ea-lo para competir contra outros gladiadores?",["Sim","Agora n\u00e3o"]).then(function(a){"Sim"==a&&window.open("profile.php?t=battle")}):showMessage("Gladiador <span class='highlight'>"+d+"</span> gravado"),saved=!0)})}else showDialog("Voc\u00ea precisar testar o gladiador <span class='highlight'>"+
loadGlad.name+"</span> ao menos uma vez antes de salv\u00e1-lo. Deseja fazer isso agora?",["Sim","N\u00e3o"]).then(function(a){"Sim"==a&&($("#test").click(),wannaSave=!0)});else showDialog("Voc\u00ea precisa fazer LOGIN no sistema para salvar seu gladiador",["Cancelar","LOGIN"]).then(function(a){"LOGIN"==a&&googleLogin().then(function(a){user=a.email;setLoadGlad();$("#login").html(a.nome).off().click(function(){window.location.href="profile.php"})})})});$("#skin").click(function(){$("#fog-skin").fadeIn()});
$("#test").click(function(){function a(){if(2==tutoState)tutoState=3,showTutorial();else if(9==tutoState||10==tutoState||12==tutoState||14==tutoState||16==tutoState||18==tutoState||20==tutoState||22==tutoState)showTutorial();else if(setLoadGlad(),!$(this).hasClass("disabled")){$("#fog-battle").fadeIn();var a=$("#float-card .glad-preview .glad span").html();$("#fog-battle h3 span").html(a)}}var d=editor.getValue();-1!=d.search("setup()")?showDialog("A fun\u00e7\u00e3o <span class='highlight'>setup</span> s\u00f3 deve ser usada nos modos de batalha cl\u00e1ssicos (aqueles que voc\u00ea faz upload manual do c\u00f3digo). Posso remover este trecho para voc\u00ea?",
["N\u00c3O","Pode"]).then(function(b){"Pode"==b&&(editor.setValue(d.replace(/setup\(\)[\s\n]*?{[\w\W]*?}/g,"")),setTimeout(function(){a()},300))}):a()});var a={Wanderer:{difficulty:1,filename:"Wanderer"},Runner:{difficulty:1,filename:"Runner"},Blinker:{difficulty:1,filename:"Blinker"},Arch:{difficulty:2,filename:"Arch"},Patient:{difficulty:2,filename:"Patient"},Warrior:{difficulty:2,filename:"Warrior"},Mage:{difficulty:2,filename:"Mage"},Rogue:{difficulty:2,filename:"Rogue"},Archie:{difficulty:3,
filename:"Archie"},"War Maker":{difficulty:3,filename:"WarMaker"},Magnus:{difficulty:3,filename:"Magnus"},Rouge:{difficulty:3,filename:"Rouge"}},e=["","one","two","three"],d;for(d in a)$("#fog-battle #list").append("<div class='glad'><div class='name'></div><div class='diff'><div class='bar'></div><div class='bar'></div><div class='bar'></div></div></div>"),$("#fog-battle #list .glad").last().data("filename",a[d].filename),$("#fog-battle #list .glad .name").last().html(d),$("#fog-battle #list .glad .diff").last().addClass(e[a[d].difficulty]);
$("#fog-battle #list .glad").click(function(){var a="samples/gladbots/"+$(this).data("filename")+".c";if($(this).hasClass("selected"))$(this).removeClass("selected"),$("#fog-battle .glad-card-container").html("");else if(4>$("#fog-battle #list .glad.selected").length){$(this).addClass("selected");var d=$("<div id='template'></div>").load("glad-card-template.html",function(){$("#fog-battle .glad-card-container").html("<div class='glad-preview'></div>");$("#fog-battle .glad-card-container .glad-preview").html(d);
getGladFromFile(a).then(function(a){fetchSpritesheet(a.skin).then(function(a){$("#fog-battle .glad-preview .image").html(getSpriteThumb(a,"walk","down"))});$("#fog-battle .glad-preview .info .glad span").html(a.name);$("#fog-battle .glad-preview .info .attr .str span").html(a.vstr);$("#fog-battle .glad-preview .info .attr .agi span").html(a.vagi);$("#fog-battle .glad-preview .info .attr .int span").html(a.vint)});$("#fog-battle .glad-preview .delete").remove();$("#fog-battle .glad-preview .code").remove()})}if(0<
$("#fog-battle #list .glad.selected").length){var e=$("#fog-battle #list .glad.selected").length;$("#fog-battle #btn-battle").removeProp("disabled");$("#fog-battle #list-title span").html(e+" selecionados")}else $("#fog-battle #btn-battle").prop("disabled",!0),$("#fog-battle #list-title span").html("")});$("#fog-battle #btn-cancel").click(function(){$("#fog-battle").hide()});$("#fog-battle #btn-battle").click(function(){$("#fog-battle #btn-cancel").prop("disabled",!0);var b=new progressButton($(this),
["Executando batalha...","Aguardando resposta do servidor"]),d=[],e=0;$.each($("#fog-battle #list .glad.selected"),function(){var b="samples/gladbots/"+a[$(this).find(".name").html()].filename+".c";getGladFromFile(b).then(function(a){d.push(a.code);e++})});var l=setInterval(function(){if(e==$("#fog-battle #list .glad.selected").length){var a='setup(){\n\tsetName("'+loadGlad.name+'");\n\tsetSTR('+loadGlad.vstr+");\n\tsetAGI("+loadGlad.vagi+");\n\tsetINT("+loadGlad.vint+');\n\tsetSkin("'+JSON.stringify(pieces)+
'");\n\tsetUser("'+loadGlad.user+'");\n}\n\n';loadGlad.code=a+loadGlad.code;d.push(loadGlad.code);clearInterval(l);runSimulation({glads:d,savecode:!0,single:!0}).then(function(a){"ERROR"!=a&&(showDialog("Deseja visualizar a batalha?",["Sim","N\u00e3o"]).then(function(c){"Sim"==c?window.open("playback.php?log="+a):$.post("back_log.php",{action:"DELETE",hash:a});wannaSave&&(showDialog("Gladiador testado com sucesso. Deseja grav\u00e1-lo?",["Sim","N\u00e3o"]).then(function(a){"Sim"==a&&$("#save").click()}),
wannaSave=!1);4!=tutoState&&5!=tutoState&&6!=tutoState&&8!=tutoState&&11!=tutoState&&13!=tutoState&&15!=tutoState&&17!=tutoState&&19!=tutoState&&21!=tutoState&&23!=tutoState||showTutorial()}),tested=!0);b.kill();$("#fog-battle #btn-cancel").removeProp("disabled");$("#fog-battle").hide()})}},10)});$("#download").click(function(){if(!$(this).hasClass("disabled")){var a=$("#distribuicao #nome").val(),d=$("#float-card .glad-preview .attr .str span").html(),e=$("#float-card .glad-preview .attr .agi span").html(),
l=$("#float-card .glad-preview .attr .int span").html();showInput("Nome do arquivo:",a+".c").then(function(b){b&&$.post("back_skin.php",{action:"SAVE",skin:JSON.stringify(pieces)}).done(function(h){hash=h;download(b,'setup(){\n    setName("'+a+'");\n    setSTR('+d+");\n    setAGI("+e+");\n    setINT("+l+');\n    setSpritesheet("'+hash+'");\n}\n\n'+editor.getValue())})})}});$("#help").click(function(){$("body").append("<div id='fog'><div id='help-window'><div id='title'>Que tipo de ajuda voc\u00ea gostaria?</div><div id='cat-container'><div id='docs' class='categories'><img src='icon/document.png'><span>Leitura</span></div><div id='video' class='categories'><img src='icon/video.png'><span>V\u00eddeo</span></div><div id='tutorial' class='categories'><img src='icon/tutor.png'><span>Tutorial</span></div></div>");
$("#fog").hide().fadeIn();$("#fog").click(function(){$(this).remove()});$("#help-window #tutorial").click(function(){showTutorial()});$("#help-window #docs").click(function(a){a.stopPropagation();$(this).hasClass("selected")||($("#help-window .categories").removeClass("selected"),$(this).addClass("selected"),$("#help-window #subcat").remove(),$("#help-window").append("<div id='subcat'><a href='manual.php' class='button' target='_blank'>Manual da gladCode</a><a href='docs.php' class='button' target='_blank'>Refer\u00eancia das fun\u00e7\u00f5es</a></div>"),
$("#help-window #subcat").hide().slideDown())});$("#help-window #video").click(function(a){a.stopPropagation();$(this).hasClass("selected")||($("#help-window .categories").removeClass("selected"),$(this).addClass("selected"),$("#help-window #subcat").remove(),$("#help-window").append("<div id='subcat'><button class='video button' data-video='te1M98UDKiM'>Introdu\u00e7\u00e3o e conceitos</button><button class='video button' data-video='tjMjqQ14AS8'>Editor de gladiadores</button><button class='video button' data-video='Wrc-0_Kq-_4'>Programando gladiadores</button><button class='video button' data-video='5QQtfruq8_8'>Habilidades e efeitos</button></div>"),
$("#help-window #subcat").hide().slideDown(),$("#help-window .video.button").click(function(){$("#fog").remove();var a=$(this).data("video");$("body").append("<div id='fog' class='dark'><div id='video-container'><iframe width='100%' height='100%' src='https://www.youtube.com/embed/"+a+"' frameborder='0' allowfullscreen></iframe><div id='remove'></div></div></div>");$("#fog").hide().fadeIn();$("#fog #remove").click(function(){$("#fog").remove()})}))})});editor.on("change",function(){tested=saved=!1;
""!=$("#float-card .glad-preview").html()&&""!=editor.getValue()?$("#download").removeClass("disabled"):$("#download").addClass("disabled");1==tutoState&&showTutorial()})});
function setLoadGlad(){loadGlad={};var a=[],e;for(e in selected)a.push(e);loadGlad.skin=JSON.stringify(a);loadGlad.id=gladid;loadGlad.user=nick;loadGlad.name=$("#distribuicao #nome").val();loadGlad.vstr=$("#distribuicao .slider").eq(0).val();loadGlad.vagi=$("#distribuicao .slider").eq(1).val();loadGlad.vint=$("#distribuicao .slider").eq(2).val();loadGlad.code=editor.getValue()}
function getGladFromFile(a){var e=$.Deferred();$.post("back_glad.php",{action:"FILE",filename:a}).done(function(a){a=JSON.parse(a);a.skin&&(a.skin=JSON.stringify(a.skin));return e.resolve(a)});return e.promise()}
function load_editor(){ace.require("ace/ext/language_tools");editor=ace.edit("code");editor.setTheme("ace/theme/dreamweaver");editor.session.setMode("ace/mode/c_cpp");editor.getSession().setUseWrapMode(!0);editor.$blockScrolling=Infinity;editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0})}
var menus={body:["gender","shape","ears","eyes"],hair:["style","color","facial","bcolor"],cloth:["shirt","armor","legs","feet"],misc:["head","shoulder","hands","cape","belt"],equip:["melee","ranged","shield"]},canvas=document.createElement("canvas");canvas.setAttribute("width",192);canvas.setAttribute("height",192);var ctx=canvas.getContext("2d"),spritesheet=document.createElement("canvas");spritesheet.setAttribute("width",2496);spritesheet.setAttribute("height",4032);
var spritectx=spritesheet.getContext("2d"),lastcolor="black",direction=2,scale=1,animationOn=!1,selected={},imageIndex=[],parentTree=[],anim_num=0,move=[{name:"walk",sprites:9,line:8,image:"walk"},{name:"cast",sprites:7,line:0,image:"magic"},{name:"thrust",sprites:8,line:4,image:"thrust"},{name:"slash",sprites:6,line:12,image:"slash"},{name:"shoot",sprites:13,line:16,image:"arrows"}],moveEnum={walk:0,cast:1,thrust:2,slash:3,shoot:4};
function load_glad_generator(a){a.load("glad-create.html",function(){function a(b){return 0==b?0:a(b-1)+Math.ceil(b/3)}buildIndex();$(".img-button.sub").addClass("hidden");$("#middle-container").append(canvas);reload_reqs();$(".slider-container").on("touchstart mouseenter",function(){text=[{path:"sprite/images/strength.png",title:"For\u00e7a - STR",description:"For\u00e7a f\u00edsica e resist\u00eancia do gladiador.",list:[{path:"sprite/images/decapitation.png",description:"Dano corpo-a-corpo causado em gladiadores inimigos"},
{path:"sprite/images/healing.png",description:"Pontos de vida, respons\u00e1veis por manter o gladiador vivo"}]},{path:"sprite/images/agility.png",title:"Agilidade - AGI",description:"Agilidade, rapidez e destreza do gladiador.",list:[{path:"sprite/images/bullseye.png",description:"Dano \u00e0 dist\u00e2ncia causado em gladiadores inimigos"},{path:"sprite/images/sprint.png",description:"Velocidade de movimento dentro da arena"},{path:"sprite/images/blades.png",description:"Velocidade de execu\u00e7\u00e3o de ataques"}]},
{path:"sprite/images/smart.png",title:"Intelig\u00eancia - INT",description:"Rapidez de racioc\u00ednio e Capacidade intelectual do gladiador.",list:[{path:"sprite/images/3balls.png",description:"Velocidade de execu\u00e7\u00e3o de uma habilidade"},{path:"sprite/images/energy.png",description:"Pontos de habilidade, usados para lan\u00e7ar habilidades"},{path:"sprite/images/energise.png",description:"Regenera\u00e7\u00e3o dos pontos de habilidade"}]}];index=$(".slider-container").index($(this));$("#info #title img").attr("src",
text[index].path);$("#info #title span").html(text[index].title);$("#info #body .fill").html(text[index].description);$("#info ul").html("");$.each(text[index].list,function(a,b){$("#info ul").append("<li><img src='"+b.path+"'><span>"+b.description+"</span></li>")})});$("#save-glad").click(function(){$("#distribuicao-container").css({display:"flex",height:$("#skin-container").outerHeight()});$("#skin-container").hide();var a=document.createElement("canvas");a.setAttribute("width",64);a.setAttribute("height",
64);a.getContext("2d").drawImage(canvas,64,64,64,64,0,0,64,64);$("#cv").html(a);tested=saved=!1});$("#get-code").click(function(){var a=$("#distribuicao #nome").val();if(2>=a.length||!a.match(/^[\w \u00c0-\u00fa]+?$/g))$("#distribuicao #nome").addClass("error"),$("#distribuicao #nome").focus();else{$("#distribuicao #nome").removeClass("error");pieces=[];$.each(selected,function(a,c){pieces.push(c.id)});var b=$("#distribuicao .slider-input").eq(0).val(),d=$("#distribuicao .slider-input").eq(1).val(),
c=$("#distribuicao .slider-input").eq(2).val();1==tutoState&&(tutoState=2,showTutorial());editor&&(""==editor.getValue()&&(editor.setValue("loop(){\n    //comportamento do gladiador\n}"),editor.gotoLine(1,0,!0)),editor.focus(),$("#save, #test").removeClass("disabled"),$("#fog-skin").hide(),$("#back").click(),$("#float-card .glad-preview").load("glad-card-template.html",function(){$("#float-card .glad-preview .info .glad span").html(a);$("#float-card .glad-preview .info .attr .str span").html(b);$("#float-card .glad-preview .info .attr .agi span").html(d);
$("#float-card .glad-preview .info .attr .int span").html(c);$(".delete-container, .code").remove();var e=document.createElement("canvas");e.setAttribute("width",64);e.setAttribute("height",64);e.getContext("2d").drawImage(canvas,64,64,64,64,0,0,64,64);$("#float-card .glad-preview .image").html(e);""!=$("#float-card .glad-preview").html()&&""!=editor.getValue()?$("#download").removeClass("disabled"):$("#download").addClass("disabled")}))}tested=saved=!1});$("#back").click(function(){$("#distribuicao-container").hide();
$("#skin-container").show()});$("#reset").click(function(){$(".img-button").removeClass("selected");$(".img-button .sub").addClass("hidden");$("#distribuicao #nome").val("");$("#distribuicao .slider").val(0).change();selected={};for(var a in images)images[a]["default"]&&(selected[images[a].id]=images[a]);reload_reqs();$("#distribuicao-container").hide();$("#skin-container").show()});$(".img-button.cat").click(function(){$(this).hasClass("n-av")||($(".img-button.cat").removeClass("selected"),$(".img-button.sub").removeClass("selected"),
$(".img-button.sub").addClass("hidden"),$.each(menus[$(this).attr("id")],function(a,b){$("#"+b).removeClass("hidden")}),$(this).addClass("selected"),reload_reqs())});$(".img-button.sub").click(function(){$(this).hasClass("n-av")||($(".img-button.sub").removeClass("selected"),$(this).addClass("selected"),reload_reqs())});$("#turn").click(function(){direction=(direction+1)%4;draw()});$("#down-scale").click(function(){1<scale&&(scale-=.5);draw()});$("#up-scale").click(function(){3.5>scale&&(scale+=.5);
draw()});var d=0;$("#play-pause").click(function(){animationOn?(animationOn=!1,d=0,$(this).find("img").attr("src","sprite/images/play.png")):(animationOn=!0,$(this).find("img").attr("src","sprite/images/pause.png"));draw()});$("#animation").click(function(){var a={walk:!0,cast:!0,thrust:!1,slash:!1,shoot:!1};$.each(selected,function(b,d){d.move&&(a[d.move]=!0)});do anim_num=(anim_num+1)%move.length;while(!a[move[anim_num].name]);d=0;$(this).find("img").attr("src","sprite/images/"+move[anim_num].image+
".png")});setInterval(function(){ctx.clearRect(0,0,canvas.width,canvas.height);animationOn&&d++;d>=move[anim_num].sprites&&(d=0);f=direction+move[anim_num].line;ctx.drawImage(spritesheet,192*d,192*f,192,192,96-192*scale/2,96-192*scale/2-5,192*scale,192*scale)},100);$(document).on("input change","#distribuicao .slider",function(){$(this).parents(".slider-container").find(".slider-value").html(a($(this).val()));$(this).parents(".slider-container").find(".slider-input").val($(this).val());$("#get-code").prop("disabled",
"true");var b=0;$("#distribuicao .slider-value").each(function(){b+=parseInt($(this).html())});var d=$("#distribuicao #remaining span");d.html(25-b);25==b?($("#get-code").html("GERAR C\u00d3DIGO"),$("#get-code").removeProp("disabled"),d.css("color","#4caf50")):25<b?d.css("color","#f44336"):d.css("color","black")});$(".close").click(function(){$("#fog-skin").hide()});if(loadGlad){selected={};var b=!1;try{var g=JSON.parse(loadGlad.skin)}catch(l){b=!0,g=[]}for(var f in g)getImage(g[f])&&(selected[g[f]]=
getImage(g[f]));gladid=loadGlad.id;$("#distribuicao #nome").val(loadGlad.name);$("#distribuicao .slider").eq(0).val(loadGlad.vstr);$("#distribuicao .slider").eq(1).val(loadGlad.vagi);$("#distribuicao .slider").eq(2).val(loadGlad.vint);$("#distribuicao .slider").change();editor.setValue(decodeHTML(loadGlad.code));editor.gotoLine(1,0,!0);$("#get-code").click();saved=!0;b||fetchSpritesheet(JSON.stringify(g)).then(function(a){$("#float-card .image").html(getSpriteThumb(a,"walk","down"))})}})}
function draw(){function a(a){var b=["up","left","down","right"];return a.layer&&a.layer["default"]?a.layer[b[direction]]?a.layer[b[direction]]:a.layer["default"]:a.layer}var e=0,d=[],b;for(b in selected)d.push(selected[b]);d.sort(function(b,d){return a(b)-a(d)});spritectx.clearRect(0,0,spritesheet.width,spritesheet.height);var g=[];for(b=0;b<d.length;b++)""==d[b].path||d[b].png?e++:(g[b]=new Image,g[b].src="sprite/Universal-LPC-spritesheet/"+d[b].path,g[b].onload=function(){e++});interval=setInterval(function(){if(e==
d.length)for(clearInterval(interval),killLoadingBar(),b=0;b<d.length;b++)if(g[b])if(d[b].oversize){var a=move[moveEnum[d[b].move]].line,l=move[moveEnum[d[b].move]].sprites;for(k=0;4>k;k++)for(j=0;j<l;j++)spritectx.drawImage(g[b],192*j,192*k,192,192,192*j,192*a+192*k,192,192)}else for(k=0;21>k;k++)for(j=0;13>j;j++)spritectx.drawImage(g[b],64*j,64*k,64,64,64+192*j,64+192*k,64,64)},10)}
function reload_reqs(a){a||$("#right-container").html("");createLoadingBar();var e={};setTimeout(function(){var d=parentTree[$(".img-button.sub.selected").attr("id")];$.each(d,function(a,c){c=getImage(c);var b=!0;if(Array.isArray(c.parent)){for(h=0;h<c.parent.length&&!$(".img-button#"+c.parent[h]).hasClass("selected");h++);h==c.parent.length&&(b=!1)}else $(".img-button#"+c.parent).hasClass("selected")||(b=!1);b&&(e[c.id]=c)});$.each(images,function(a,c){if(c.req)if(c.req.or){for(h=0;h<c.req.or.length&&
!selected[c.req.or[h]];h++);h==c.req.or.length&&(delete e[c.id],delete selected[c.id])}else if(c.req.and)for(h=0;h<c.req.and.length;h++){if(!selected[c.req.and[h]]){delete e[c.id];delete selected[c.id];break}}else if(c.req.not)for(h=0;h<c.req.not.length;h++){if(selected[c.req.not[h]]){delete e[c.id];delete selected[c.id];break}}else selected[c.req]||(delete e[c.id],delete selected[c.id])});var b=!1;$.each(selected,function(a,c){"shape"==c.parent&&(b=!0)});b||(selected.male?selected["male-light"]=
getImage("male-light"):selected["female-light"]=getImage("female-light"));if($("#style").hasClass("selected")){var g=lastcolor;$.each(selected,function(a,c){"color"==c.parent[1]&&(lastcolor=g=c.id.split("_")[1])});$.each(images,function(a,c){"color"==c.parent[1]&&($(this).attr("id").split("_")[1]==g?e[c.id]=c:delete e[c.id])})}$("#facial").hasClass("selected")&&(g=lastcolor,$.each(selected,function(a,c){"bcolor"==c.parent[1]&&(lastcolor=g=c.id.split("_")[1])}),$.each(images,function(a,c){"bcolor"==
c.parent[1]&&(c.id.split("_")[1]==g?e[c.id]=c:delete e[c.id])}));if($("#color").hasClass("selected")){var f;$.each(selected,function(a,c){"style"==c.parent[0]&&(f=c.id.split("_")[0])});$.each(images,function(a,c){"style"==c.parent[0]&&(c.id.split("_")[0]==f?e[c.id]=c:delete e[c.id])})}if($("#bcolor").hasClass("selected")){var l;$.each(selected,function(a,c){"facial"==c.parent[0]&&(l=c.id.split("_")[0])});$.each(images,function(a,c){"facial"==c.parent[0]&&(c.id.split("_")[0]==l?e[c.id]=c:delete e[c.id])})}$(".img-button.sub.n-av").removeClass("n-av");
(selected["male-orc"]||selected["male-red_orc"]||selected.skeleton||selected["female-orc"]||selected["female-red_orc"])&&$("#eyes, #ears").addClass("n-av");selected.hair_none&&$("#color").addClass("n-av");selected.facial_none&&$("#bcolor").addClass("n-av");(selected.male_chain||selected.female_chain)&&$("#shirt, #legs").addClass("n-av");$.each(selected,function(a,c){if(Array.isArray(c.block))for(h=0;h<c.block.length;h++)$("#"+c.block[h]).addClass("n-av");else $("#"+c.block).addClass("n-av");c.move&&
$(".img-button#"+c.parent).hasClass("selected")&&(anim_num=moveEnum[c.move],$("#animation").find("img").attr("src","sprite/images/"+move[anim_num].image+".png"));"none"==c.parent&&selected[c.id]&&delete selected[c.id];c.select&&(selected[c.select]=getImage(c.select))});$.each($(".img-button.sub.n-av"),function(){var a=parentTree[$(this).attr("id")],c;for(c in a)selected[a[c]]&&delete selected[a[c]]});if(!a)for(var h in e)load_assets(e[h]);draw()},1)}
function load_assets(a){var e=document.createElement("canvas");e.setAttribute("width",64);e.setAttribute("height",64);var d=e.getContext("2d"),b=a.path,g=new Image;g.src=a.png?"sprite/images/"+b:"sprite/Universal-LPC-spritesheet/"+b;g.onload=function(){try{var b=10,e=0,f=64;a.line&&(b=a.line);a.col&&(e=a.col);a.oversize&&(f=192);if(a.png)d.drawImage(g,0,0,a.width,a.height,0,0,64,64);else if(a.scale){var c=0,m=0;a.posx&&(c=a.posx);a.posy&&(m=a.posy);d.drawImage(g,e*f,b*f,f,f,f/2-a.scale*f/2+c,f/2-
a.scale*f/2+m,64*a.scale,64*a.scale)}else d.drawImage(g,e*f,b*f,f,f,0,-5,64,64)}catch(n){console.log(n)}};0==$(".img-button.item#"+a.id).length&&$("#right-container").append("<div class='img-button item' id='"+a.id+"'></div>");$(".img-button.item#"+a.id).append(e);a["default"]&&$(".img-button.item#"+a.id).addClass("selected");for(var f in selected)selected[f].id==a.id&&($(".img-button.item").removeClass("selected"),$(".img-button.item#"+a.id).addClass("selected"));$(".img-button.item#"+a.id).click(function(){var b=
[];Array.isArray(a.parent)?b=a.parent:b.push(a.parent);for(var d in selected){var e=[];Array.isArray(selected[d].parent)?e=selected[d].parent:e.push(selected[d].parent);for(var c in e)for(var f in b)e[c]==b[f]&&delete selected[d]}selected[a.id]=a;$(".img-button.item").removeClass("selected");$(this).addClass("selected");reload_reqs(!0)})}function getImage(a){return images[imageIndex[a]]}
function buildIndex(){for(i=0;i<images.length;i++){imageIndex[images[i].id]=i;if(images[i].parent)if(Array.isArray(images[i].parent))for(j in images[i].parent)parentTree[images[i].parent[j]]||(parentTree.push(images[i].parent[j]),parentTree[images[i].parent[j]]=[]),parentTree[images[i].parent[j]].push(images[i].id);else parentTree[images[i].parent]||(parentTree.push(images[i].parent),parentTree[images[i].parent]=[]),parentTree[images[i].parent].push(images[i].id);images[i]["default"]&&(selected[images[i].id]=
images[i])}}function cloneCanvas(a){var e=document.createElement("canvas"),d=e.getContext("2d");e.width=a.width;e.height=a.height;d.drawImage(a,0,0);return e}function createLoadingBar(){0==$("#loadbar").length&&$("#middle-container").append("<div id='loadbar'><img src='sprite/images/loading.gif'></div>");$("#middle-container canvas").hide();$("#loadbar").show()}function killLoadingBar(){$("#loadbar").hide();$("#middle-container canvas").show()}
function download(a,e){var d=document.createElement("a");d.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e));d.setAttribute("download",a);if(document.createEvent){var b=document.createEvent("MouseEvents");b.initEvent("click",!0,!0);d.dispatchEvent(b)}else d.click()}function setGladImage(a,e){fetchSpritesheet(e).then(function(d){$("#fog-glads .glad-preview .image").eq(a).html(getSpriteThumb(d,"walk","down"))})};