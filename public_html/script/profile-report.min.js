$(document).ready(async function(){let a=["Batalhas","Duelos","Favoritos"];var e={pages:{limit:10,battles:{name:"Batalhas",offset:0},duels:{name:"Duelos",offset:0},favorites:{name:"Favoritos",offset:0}},init:function(){$("#report-container #tab-container .tab").click(async t=>{let s=$(t.currentTarget),l=!0;$("#report-container #tab-container .tab.selected").text()==s.text()&&(l=!1),$("#report-container #tab-container .tab").removeClass("selected"),s.addClass("selected");let i=this.getId(a[s.index(".tab")]),n=1==$("#report-container #unread input:checked").length;e.fetch({id:i,offset:this.pages[i].offset,dummy:l,unread:n})})},getId:function(a){for(let e in this.pages)if(this.pages[e].name==a)return e;return!1},fetch:async function({id:a="battles",limit:e=this.pages.limit,offset:t=0,unread:s=!1,dummy:l=!0}){translator.translate(["Oponente","Mestre","Visualizar batalha","Guardar nos favoritos","Tirar dos favoritos","Comentário"]).then(async()=>{if(this.pages[a].offset=t,$("#report-container #unread").hide(),"battles"==a){if($("#report-container #unread").show(),l){$("#bhist-container .table").html(`<div class='row head'><div class='cell'>${translator.getTranslated("Gladiador")}</div><div class='cell reward'>${translator.getTranslated("Renome")}</div><div class='cell time'>${translator.getTranslated("Data")}</div></div>`);for(let a=0;a<e;a++)$("#bhist-container .table").append("<div class='row dummy'>\n                            <div class='cell favorite'><span class='dummy-text'><i class='far fa-star'></i></span></div>\n                            <div class='cell glad'><span class='dummy-text'>GLADIATOR</span></div>\n                            <div class='cell reward'><span class='dummy-text'>+00.0</span></div>\n                            <div class='cell time'><span class='dummy-text'>0 TEMPO</span></div>\n                        </div>")}$("#report-container .page-nav button").prop("disabled",!0);let i=await post("back_report.php",{action:"GET",offset:t,read:!0,unread_only:s});if("SUCCESS"==i.status){if(l||$("#bhist-container .table").html(`<div class='row head'><div class='cell'>${translator.getTranslated("Gladiador")}</div><div class='cell reward'>${translator.getTranslated("Renome")}</div><div class='cell time'>${translator.getTranslated("Data")}</div></div>`),$("#report-container .table .row").not(".head").remove(),this.pages[a].total=i.total,i.total<=t&&i.total>0)return void this.fetch({id:a,offset:0});for(let a=0;a<e;a++)if(0==i.total&&0==a)$("#bhist-container .table").append(`<div class='row'>\n                                <div class='cell'><h3>${translator.getTranslated("Nenhuma batalha para mostrar",dom=!0)}</h3></div>\n                            </div>`);else if(t+a<i.total){let e=i.reports[a],t={class:"far",title:translator.getTranslated("Guardar nos favoritos",dom=!1)};e.favorite&&(t={class:"fas",title:translator.getTranslated("Tirar dos favoritos",dom=!1)});let s="";"0"==e.isread&&(s="unread");let l={class:"",value:`${parseFloat(e.reward).toFixed(1)}`};parseFloat(e.reward)<0?l.class="red":parseFloat(e.reward)>0&&(l.class="green",l.value=`+${l.value}`);let n="";e.expired||(n=`<div class='playback' title='${translator.getTranslated("Visualizar batalha",dom=!1)}'>\n                                    <a target='_blank' href='play/${e.hash}'><img src='icon/eye.png'></a>\n                                </div>`),$("#bhist-container .table").append(`<div class='row ${s}'>\n                                <div class='cell favorite' title='${t.title}'><i class='${t.class} fa-star'></i></div>\n                                <div class='cell glad'>${e.gladiator}</div>\n                                <div class='cell reward ${l.class}'>${l.value}</div>\n                                <div class='cell time' title='${getMessageTime(e.time)}'>${getMessageTime(e.time,{short:!0})}</div>\n                                ${n}\n                            </div>`),$("#bhist-container .favorite").last().data("id",e.id)}else $("#bhist-container .table").append("<div class='row'>\n                                <div class='cell favorite'></div>\n                                <div class='cell glad'></div>\n                                <div class='cell reward'></div>\n                                <div class='cell time'></div>\n                            </div>");$("#bhist-container .favorite").click(function(){function a(a,e,t){$.post("back_report.php",{action:"FAVORITE",favorite:e,id:a,comment:t}).done(function(a){})}var e=$(this).data("id");if($(this).find("i").hasClass("fas"))$(this).find("i").removeClass("fas").addClass("far").attr("title",translator.getTranslated("Guardar nos favoritos",dom=!1)),a(e,!1,"");else{var t=$(this);new Message({message:"Informe um comentário sobre esta batalha",buttons:{ok:"OK",cancel:"CANCEL"},input:{placeholder:"Comentário..."}}).show().click("ok",s=>{t.find("i").removeClass("far").addClass("fas").attr("title",translator.getTranslated("Tirar dos favoritos",dom=!1)),a(e,!0,s.input)})}})}}if("favorites"==a){if(l){$("#bhist-container .table").html(`<div class='row head'>\n                        <div class='cell'>${translator.getTranslated("Gladiador")}</div>\n                        <div class='cell comment'>${translator.getTranslated("Comentário")}</div>\n                        <div class='cell time'>${translator.getTranslated("Data")}</div>\n                    </div>`);for(let a=0;a<e;a++)$("#bhist-container .table").append("<div class='row dummy'>\n                            <div class='cell favorite'><span class='dummy-text'><i class='fas fa-star'></i></span></div>\n                            <div class='cell glad'><span class='dummy-text'>GLADIADOR</span></div>\n                            <div class='cell comment'><span class='dummy-text'>COMENTÁRIO DE EXEMPLO</span></div>\n                            <div class='cell time'><span class='dummy-text'>0 TEMPO</span></div>\n                        </div>")}$("#report-container .page-nav button").prop("disabled",!0);let s=await post("back_report.php",{action:"GET",offset:t,favorites:!0});if("SUCCESS"==s.status){if(l||$("#bhist-container .table").html(`<div class='row head'>\n                            <div class='cell'>${translator.getTranslated("Gladiador")}</div>\n                            <div class='cell comment'>${translator.getTranslated("Comentário")}</div>\n                            <div class='cell time'>${translator.getTranslated("Data")}</div>\n                        </div>`),$("#report-container .table .row").not(".head").remove(),this.pages[a].total=s.total,s.total<=t&&s.total>0)return void this.fetch({id:a,offset:0});for(let a=0;a<e;a++)if(0==s.total&&0==a)$("#bhist-container .table").append("<div class='row'>\n                                <div class='cell'><h3>Selecione suas batalhas favoritas para aparecer nesta tabela. Assim você também as protege de serem apagadas quando ficarem muito antigas</h3></div>\n                            </div>");else if(t+a<s.total){let e=s.reports[a],t={class:"far",title:translator.getTranslated("Guardar nos favoritos",dom=!1)};e.favorite&&(t={class:"fas",title:translator.getTranslated("Tirar dos favoritos",dom=!1)}),$("#bhist-container .table").append(`<div class='row'>\n                                <div class='cell favorite' title='${t.title}'><i class='${t.class} fa-star'></i></div>\n                                <div class='cell glad'>${e.gladiator}</div>\n                                <div class='cell comment'>${e.comment}</div>\n                                <div class='cell time' title='${getMessageTime(e.time)}'>${getMessageTime(e.time,{short:!0})}</div>\n                                <div class='playback' title='${translator.getTranslated("Visualizar batalha",dom=!1)}'>\n                                    <a target='_blank' href='play/${e.hash}'><img src='icon/eye.png'></a>\n                                </div>\n                            </div>`),$("#bhist-container .favorite").last().data("id",e.id)}else $("#bhist-container .table").append("<div class='row'>\n                                <div class='cell favorite'></div>\n                                <div class='cell glad'></div>\n                                <div class='cell comment'></div>\n                                <div class='cell time'></div>\n                            </div>");$("#bhist-container .favorite").click(a=>{var e=$(a.currentTarget),t=e.data("id");new Message({message:"Remover esta batalha dos favoritos?",buttons:{yes:"Sim",no:"Não"}}).show().click("yes",async()=>{e.parent().remove(),await post("back_report.php",{action:"FAVORITE",favorite:!1,id:t,comment:""}),this.fetch({id:"favorites",offset:this.pages.favorites.offset})})})}}if("duels"==a){if(l){$("#bhist-container .table").html(`<div class='row head'><div class='cell'>${translator.getTranslated("Gladiador")}</div><div class='cell'>${translator.getTranslated("Oponente")}</div><div class='cell'>${translator.getTranslated("Mestre")}</div><div class='cell time'>${translator.getTranslated("Data")}</div></div>`);for(let a=0;a<e;a++)$("#bhist-container .table").append("<div class='row dummy'>\n                            <div class='cell glad'><span class='dummy-text'>GLADIADOR</span></div>\n                            <div class='cell enemy'><span class='dummy-text'>GLADIADOR</span></div>\n                            <div class='cell'><span class='dummy-text'>USUÁRIO</span></div>\n                            <div class='cell time'><span class='dummy-text'>0 TEMPO</span></div>\n                        </div>")}$("#report-container .page-nav button").prop("disabled",!0);let s=await post("back_duel.php",{action:"REPORT",offset:t});if("SUCCESS"==s.status){if(l||$("#bhist-container .table").html(`<div class='row head'><div class='cell'>${translator.getTranslated("Gladiador")}</div><div class='cell'>${translator.getTranslated("Oponente")}</div><div class='cell'>${translator.getTranslated("Mestre")}</div><div class='cell time'>${translator.getTranslated("Data")}</div></div>`),$("#report-container .table .row").not(".head").remove(),this.pages[a].total=s.total,s.total<=t&&s.total>0)return void this.fetch({id:a,offset:0});for(let a=0;a<e;a++)if(0==s.total&&0==a)$("#bhist-container .table").append("<div class='row'>\n                                <div class='cell'><h3>Você ainda não possui duelos</h3></div>\n                            </div>");else if(t+a<s.total){let e=s.duels[a],t="";"0"!=e.isread&&(e.enemy||e.log)||(t="unread");let l={me:{class:"",value:e.glad},enemy:{class:"",value:e.enemy}};e.glad||(l.me={class:"forgotten",value:"Gladiador Esquecido"});let i=`<div class='playback' title='${translator.getTranslated("Visualizar batalha",dom=!1)}'>\n                                <a target='_blank' href='play/${e.log}'><img src='icon/eye.png'></a>\n                            </div>`;e.enemy||(e.log?l.enemy={class:"forgotten",value:"Gladiador Esquecido"}:(l.enemy.value="???",i="<div class='remove' title='Cancelar desafio'>X</div>")),$("#bhist-container .table").append(`<div class='row ${t}'>\n                                <div class='cell glad ${l.me.class}'>${l.me.value}</div>\n                                <div class='cell enemy ${l.enemy.class}'>${l.enemy.value}</div>\n                                <div class='cell'>${e.user}</div>\n                                <div class='cell time' title='${getMessageTime(e.time)}'>${getMessageTime(e.time,{short:!0})}</div>\n                                ${i}\n                            </div>`),$("#bhist-container .row").last().data("id",e.id),$("#bhist-container .table .row").last().find(".remove").click(async a=>{let e=$(a.currentTarget);var t=e.parents(".row").data("id");await post("back_duel.php",{action:"DELETE",id:t}),new Message({message:"Desafio cancelado"}).show(),this.fetch({id:"duels",offset:this.pages.duels.offset})})}else $("#bhist-container .table").append("<div class='row'>\n                                <div class='cell glad'></div>\n                                <div class='cell enemy'></div>\n                                <div class='cell'></div>\n                                <div class='cell time'></div>\n                            </div>")}}$("#report-container .page-nav span").eq(0).html(0==this.pages[a].total?0:t+1),$("#report-container .page-nav span").eq(1).html(Math.min(t+e,this.pages[a].total)),$("#report-container .page-nav span").eq(2).html(this.pages[a].total),t>0&&$("#report-container #prev").removeAttr("disabled"),t+e<this.pages[a].total&&$("#report-container #next").removeAttr("disabled")})}};e.pages.next=function({unread:t=!1}){let s=e.getId(a[$("#report-container .tab.selected").index(".tab")]);if(s){let a=e.pages[s].offset+e.pages.limit;t&&(a=0),e.fetch({id:s,offset:a,unread:t})}},e.pages.prev=function({unread:t=!1}){let s=e.getId(a[$("#report-container .tab.selected").index(".tab")]);if(s){let a=e.pages[s].offset-e.pages.limit;t&&(a=0),e.fetch({id:s,offset:a,unread:t})}},$("#menu #report").click(async function(){$("#report-container .tab.selected").click()}),$("#report-container #prev").click(function(){let a=1==$("#report-container #unread input:checked").length;e.pages.prev({unread:a})}),$("#report-container #next").click(function(){let a=1==$("#report-container #unread input:checked").length;e.pages.next({unread:a})}),$("#report-container #unread input").click(function(){let t=1==$(this).filter(":checked").length,s=e.getId(a[$("#report-container .tab.selected").index(".tab")]);if("battles"==s){let a=e.pages[s].offset;t&&(a=0),e.fetch({id:s,offset:a,unread:t})}}),e.init()});