var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,c,b){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(c.call(b,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in b||(b[e]={});b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};
$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,c){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:c})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(b){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(b||"")+"_"+c++,b)}var c=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,d={next:function(){if(b<a.length){var e=b++;return{value:c(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
var startloop=!1,simRec=[],json={},hashes,names,newindex=[],steps=[],timestep=0,pausesim=!0,stepIncrement=1,endsim,exportjson,tries;
$(document).ready(function(){function a(a){var b=0;!0===a&&(b=1);1<Object.keys(c).length&&$(".dz-preview.error").length==b?$("#b-battle").removeAttr("disabled"):$("#b-battle").attr("disabled")||$("#b-battle").attr("disabled",!0)}$("#canvas-container").hide();$("#footer-wrapper").addClass("white");$("#preview-container").sortable({axis:"y",scroll:!1});$("#dz-add").droppable({accept:".dz-preview",drop:function(a,b){$(b.draggable).trigger("drop")}});var c=[],b=new Dropzone("#code-box",{url:"back_upload.php",
paramName:"file",maxFilesize:1,maxFiles:5,clickable:"#code-box",createImageThumbnails:!1,addRemoveLinks:!0,acceptedFiles:".c,.cpp",dictFileTooBig:"O arquivo \u00e9 muito grande ({{filesize}}MB). Tamanho m\u00e1ximo {{maxFilesize}}MB.",dictInvalidFileType:"Voc\u00ea s\u00f3 pode enviar c\u00f3digos escritos na linguagem C (extens\u00f5es .c e .cpp).",dictCancelUpload:"Cancelar envio",dictUploadCanceled:"Envio cancelado",dictRemoveFile:"Remover arquivo",dictMaxFilesExceeded:"Voc\u00ea s\u00f3 pode enviar at\u00e9 {{maxFiles}} arquivos",
previewTemplate:"<div class='dz-preview' title='Arraste o gladiador para remov\u00ea-lo da batalha'></div>",accept:function(a,b){b()},init:function(){this.on("addedfile",function(a){$("#preview-container").append($(a.previewElement))})},success:function(f,d){var e=f.upload.uuid;c[e]=filter_response(f,d);$(f.previewElement).on("drop",function(){b.removeFile(f)});c[e].error?(create_errorPreview($(f.previewElement),f,c[e].error),a()):$(f.previewElement).load("../dz-preview-template.html",function(){$(".dz-preview").index($(this));
$(this).find(".name span").html(c[e].file.name);$(this).find(".size span").html(c[e].file.size);$(this).find(".glad span").html(c[e].name);$(this).find(".str span").html(c[e].STR);$(this).find(".agi span").html(c[e].AGI);$(this).find(".int span").html(c[e].INT);appendCanvas($(this).find(".image"),c[e].code);a();$(this).find(".rem").click(function(){b.removeFile(f)})})},error:function(a,c){var d=[];d.message=c;d.link=null;create_errorPreview($(a.previewElement),a,d);$(a.previewElement).on("drop",function(){b.removeFile(a)})},
removedfile:function(b){delete c[b.upload.uuid];$(b.previewElement).remove();$(b.previewElement).hasClass("error")?a(!0):a()}});$("#dz-add").click(function(){$(".dz-clickable").click()});$("#b-battle").click(function(a){var b=new progressButton($(this),["Executando batalha...","Aguardando resposta do servidor"]),d=[],e=0,f;for(f in c)getGladFromCode(c[f].code).then(function(a){d.push(a);e++});var g=setInterval(function(){e==Object.keys(c).length&&(clearInterval(g),runSimulation(d).then(function(a){"ERROR"==
a?b.kill():$.post("back_log.php",{action:"SAVE",log:JSON.stringify(a),single:!0}).done(function(a){showMessage("Batalha conclu\u00edda. Clique para visualizar").then(function(){window.open("https://gladcode.tk/playback.php?log="+a)});b.kill()})}))},10)});var d=4,e=[-10,-5,-2,-1,1,2,5,10];$("#back-step").click(function(){pausesim?(0<stepIncrement?stepIncrement=-1:0<timestep&&(stepIncrement*=1.15),timestep+=Math.round(stepIncrement),$("#fowd-step .speed").html(""),$("#back-step .speed").html(Math.round(stepIncrement))):
(0<d&&d--,stepIncrement=e[d],3>=d?($("#fowd-step .speed").html(""),$("#back-step .speed").html(e[d]+"x")):($("#back-step .speed").html(""),$("#fowd-step .speed").html(e[d]+"x")))});$("#fowd-step").click(function(){pausesim?(0>stepIncrement?stepIncrement=1:timestep<$("#time").slider("option","max")-1&&(stepIncrement*=1.15),timestep+=Math.round(stepIncrement),$("#back-step .speed").html(""),$("#fowd-step .speed").html("+"+Math.round(stepIncrement))):(d<e.length-1&&d++,stepIncrement=e[d],3>=d?($("#fowd-step .speed").html(""),
$("#back-step .speed").html(e[d]+"x")):($("#back-step .speed").html(""),$("#fowd-step .speed").html(e[d]+"x")))});$("#pause").click(function(){stepIncrement=1;d=4;pausesim?(pausesim=!1,$("#pause #img-play").hide(),$("#pause #img-pause").show(),$("#back-step .speed").html("-1x"),$("#fowd-step .speed").html("1x")):(pausesim=!0,$("#pause #img-pause").hide(),$("#pause #img-play").show(),stepIncrement=1,d=4,$("#back-step .speed").html("-1"),$("#fowd-step .speed").html("+1"))});$("#fullscreen").click(function(){if(document.fullscreenElement&&
null!==document.fullscreenElement||document.webkitFullscreenElement&&null!==document.webkitFullscreenElement||document.mozFullScreenElement&&null!==document.mozFullScreenElement||document.msFullscreenElement&&null!==document.msFullscreenElement)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen();else{var a=document.getElementById("canvas-container");
a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()}});$("#time").slider({range:"min",min:0,max:0,value:timestep,create:function(a,b){$(this).append("<div class='ui-slider-time'></div>")},change:function(a,b){a=Math.floor(b.value/600);b=Math.floor(b.value/10)%60;10>b&&(b="0"+b);b=a+":"+b;$(this).find(".ui-slider-time").html(b);$(this).find(".ui-slider-time").css("left",
$(this).find(".ui-slider-handle").css("left"))},slide:function(a,b){timestep=b.value}});$("#plogin").click(function(){googleLogin().then(function(a){window.location.href="https://gladcode.tk/profile.php"})})});$(window).resize(function(){resize()});
function resize(){$(window).height()>$(window).width()?$("#canvas-div canvas").css({"max-width":"100%","max-height":$("#canvas-div canvas").width()/screenRatio}):$("#canvas-div canvas").css({"max-height":"100%","max-width":$("#canvas-div canvas").height()*screenRatio})}function appendCanvas(a,c){getGladFromCode(c).then(function(b){fetchSpritesheet(JSON.parse(b.skin)).then(function(b){a.append(getSpriteThumb(b,"walk","down"))})})}
function getGladFromCode(a){var c=$.Deferred();$.post("back_glad.php",{action:"FILE",code:a}).done(function(a){a=JSON.parse(a);a.skin&&(a.skin=JSON.stringify(a.skin));return c.resolve(a)});return c.promise()}
function filter_response(a,c){c=c.replace(/(\/\/[\w\W]*?\n)/g,"//comment\n");c=c.replace(/(\/\*[\w\W]*?\*\/)/g,"//comment\n");var b=[];b.code=c;b.file=a;a=[];if(/setName\([\w\W]*?\);|mudaNome\([\w\W]*?\);/g.exec(c))if(/setName\("([\w \u00c0-\u00fa]{3,20}?)"\);|mudaNome\("([\w \u00c0-\u00fa]{3,20}?)"\);/g.exec(c))if(/setSTR\([\w\W]*?\);|mudaFOR\([\w\W]*?\);/g.exec(c))if(/setSTR\((\d{1,2})\);|mudaFOR\((\d{1,2})\);/g.exec(c))if(/setAGI\([\w\W]*?\);|mudaAGI\([\w\W]*?\);/g.exec(c))if(/setAGI\((\d{1,2})\);|mudaAGI\((\d{1,2})\);/g.exec(c)){if(/setINT\([\w\W]*?\);|mudaINT\([\w\W]*?\);/g.exec(c)){if(/setINT\((\d{1,2})\);|mudaINT\((\d{1,2})\);/g.exec(c))return b.name=/setName\("([\w \u00c0-\u00fa]+?)"\);|mudaNome\("([\w \u00c0-\u00fa]+?)"\);/g.exec(c),
b.STR=/setSTR\((\d{1,2})\);|mudaFOR\((\d{1,2})\);/g.exec(c),b.AGI=/setAGI\((\d{1,2})\);|mudaAGI\((\d{1,2})\);/g.exec(c),b.INT=/setINT\((\d{1,2})\);|mudaINT\((\d{1,2})\);/g.exec(c),b.name[1]?b.name=b.name[1]:b.name[2]&&(b.name=b.name[2]),b.STR[1]?b.STR=b.STR[1]:b.STR[2]&&(b.STR=b.STR[2]),b.AGI[1]?b.AGI=b.AGI[1]:b.AGI[2]&&(b.AGI=b.AGI[2]),b.INT[1]?b.INT=b.INT[1]:b.INT[2]&&(b.INT=b.INT[2]),/setSpritesheet\("(\w{32})"\);|mudaAparencia\("(\w{32})"\);/g.exec(c)?(b.sprite=/setSpritesheet\("(\w{32})"\);|mudaAparencia\("(\w{32})"\);/g.exec(c),
b.sprite[1]?b.sprite=b.sprite[1]:b.sprite[2]&&(b.sprite=b.sprite[2])):b.sprite="",console.log(b),25!=calcPointCost(b.STR)+calcPointCost(b.AGI)+calcPointCost(b.INT)&&(a.message="O somat\u00f3rio do custo dos pontos de atributos do gladiador \u00e9 diferente de 25.",a.link="https://gladcode.tk/manual.php#nav-atrib",b.error=a),b;a.message="A intelig\u00eancia do gladiador precisa ser um n\u00famero inteiro entre 0 e 10."}else a.message="Fun\u00e7\u00e3o setINT (intelig\u00eancia do gladiador) n\u00e3o encontrada ou com erro.";
a.link="https://gladcode.tk/function.php?f=setint"}else a.message="A agilidade do gladiador precisa ser um n\u00famero inteiro entre 0 e 10.",a.link="https://gladcode.tk/function.php?f=setagi";else a.message="Fun\u00e7\u00e3o setAGI (agilidade do gladiador) n\u00e3o encontrada ou com erro.",a.link="https://gladcode.tk/function.php?f=setagi";else a.message="A for\u00e7a do gladiador precisa ser um n\u00famero inteiro entre 0 e 10.",a.link="https://gladcode.tk/function.php?f=setstr";else a.message=
"Fun\u00e7\u00e3o setSTR (for\u00e7a do gladiador) n\u00e3o encontrada ou com erro.",a.link="https://gladcode.tk/function.php?f=setstr";else a.message="O nome do gladiador precisa ser composto de caracteres alfanum\u00e9ricos e possuir tamanho entre 3 e 20.",a.link="https://gladcode.tk/function.php?f=setname";else a.message="Fun\u00e7\u00e3o setName (nome do gladiador) n\u00e3o encontrada ou com erro.",a.link="https://gladcode.tk/function.php?f=setname";b.error=a;return b}
function create_errorPreview(a,c,b){a.addClass("error");a.html("<div class='row file'><div class='name'>Arquivo:<span></span></div><div class='size'>Tamanho:<span></span>B</div></div><div class='row message'>Erro:<span></span></div><div class='row link'>Para saber mais acesse:<span></span></div>");a.find(".message span").html(b.message);b.link?a.find(".link span").html("<a target='_blank' href='"+b.link+"'>"+b.link+"</a>"):a.find(".link").remove();a.find(".name span").html(c.name);a.find(".size span").html(c.size)}
function calcPointCost(a){a=parseInt(a);return 0==a?0:Math.ceil(a/3)+calcPointCost(a-1)};
